[{"title":"å®‰è£…æ“ä½œç³»ç»ŸåŠå¸¸ç”¨è½¯ä»¶","url":"/2025/12/22/å®‰è£…æ“ä½œç³»ç»ŸåŠå¸¸ç”¨è½¯ä»¶/","content":"\n\n\n## å®‰è£…æ“ä½œç³»ç»ŸåŠå¸¸ç”¨è½¯ä»¶\n\n### å¯åŠ¨ç›˜\n\nBitLocker å¤‡ä»½å¯†é’¥è§£å¯†ï¼Œé˜²æ­¢ç³»ç»Ÿå®‰è£…åˆ°ä¸€åŠéœ€è¦è§£å¯†\n\n#### Win11\n\nåœ¨windowså®˜ç½‘ä¸‹è½½\n\n https://www.microsoft.com/en-us/software-download/windows11\n\nCreate Windows 11 Installation Media æˆ–è€… Disk Image\n\n#### å¾®PEå·¥å…·ç®±\n\nå¾®PEå·¥å…·ç®±V2.3 ä¸‹è½½åå¯ä»¥å¯¼å‡ºISO\n\nhttps://www.wepe.com.cn/download.html\n\n#### Ventoy\n\nå¤šç³»ç»Ÿå¯åŠ¨Uç›˜\n\nåªéœ€è¦æŠŠ ISO/WIM/IMG/VHD(x)/EFI ç­‰ç±»å‹çš„æ–‡ä»¶ç›´æ¥æ‹·è´åˆ°Uç›˜é‡Œé¢å°±å¯ä»¥å¯åŠ¨äº†\n\n### æƒ æ™®BIOSè®¾ç½®\n\nå…³é—­ HP é›»è…¦ - Secure Boot (Windows) https://support.hp.com/tw-zh/document/ish_6930261-7044609-16\n\né€‰æ‹©å¾®PEå¯åŠ¨å¤±è´¥ï¼Œå¯åŠ¨åˆ°ä¸€åŠå¡ä½ã€‚win11æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚\n\nwin11 å®‰è£…æ—¶é€‰æ‹©å®Œæ•´ç‰ˆï¼ˆç¼ºå°‘mediaç»„ä»¶çš„è¯æ‘„åƒå¤´ç”¨ä¸äº† è§£å†³[é“¾æ¥](https://support.microsoft.com/en-us/topic/media-feature-pack-list-for-windows-n-editions-c1c6fffa-d052-8338-7a79-a4bb980a700a)ï¼‰\n\n\n\n## åº”ç”¨è½¯ä»¶\n\ndukto storeå•†åº—ä¸‹è½½\n\nv2rayN https://github.com/2dust/v2rayN\n\né…ç½®æ–‡ä»¶é€šè¿‡ dukto å‰ªè´´æ¿å¯¼å…¥ï¼Œå¼€å¯Tunå…¨å±€ä»£ç†æ¨¡å¼ è®¾ç½®å¼€æœºè‡ªå¯ å¯åŠ¨åéšè—çª—å£\n\nChrome\n\nZeroOmega https://chromewebstore.google.com/detail/proxy-switchyomega-3-zero/pfnededegaaopdmhkdmcofjmoldfiped\n\nhttps://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt \n\nVimium\n\nnotepad++ https://notepad-plus-plus.org/downloads/\n\nå–æ¶ˆ Backup Remember current session for next launch\n\nnextai-translator https://github.com/nextai-translator/nextai-translator?tab=readme-ov-file\n\nhttps://github.com/nextai-translator/nextai-translator/blob/main/CLIP-EXTENSIONS-CN.md\n\nrustdesk https://github.com/rustdesk/rustdesk é…ç½®æ–‡ä»¶åœ¨æ‰‹æœºé€šè¿‡duktoå‘é€\n\nmobaxterm Home Edition https://mobaxterm.mobatek.net/download.html\n\nMotrix https://github.com/agalwood/Motrix ï¼ˆç£åŠ›é“¾å»ºè®®å¼€ä»£ç†ï¼‰\n\nepic https://store.epicgames.com/en-US\n\ntypora https://github.com/ydsuper/Typora_Free_Download [ä½¿ç”¨æ–¹æ³•](https://www.cnblogs.com/chen2ha/p/18568057)\n\nSumatra PDF https://www.sumatrapdfreader.org/free-pdf-reader\n\nVisual Studio 2026 and VSCode https://visualstudio.microsoft.com/downloads/\n\nqt6 https://download.qt.io/official_releases/online_installers/ \n\n```cmd\nqt-online-installer-windows-x64-online.exe --mirror https://mirrors.ustc.edu.cn/qtproject/\n```\n\nç™»å½• è‡ªå®šä¹‰\n\n```\nQt/\nâ”‚\nâ”œâ”€â”€ Qt 6.x.x/\nâ”‚   â”œâ”€â”€ MSVC 2022 64-bit\nâ”‚   â””â”€â”€ Additional Libraries\nâ”‚       â”œâ”€â”€ Qt Image Formats\nâ”‚       â”œâ”€â”€ Qt Serial Port\nâ”‚       â””â”€â”€ Qt WebSockets\nâ”œâ”€â”€ Build Tools/\nâ”‚   â”œâ”€â”€ Qt installer Framework x.x\nâ”‚   â”œâ”€â”€ CMake x.x\nâ”‚   â””â”€â”€ Ninja x.x\n\nQtCreator/\nâ”‚\nâ”œâ”€â”€ Qt Creator x.x\nâ”œâ”€â”€ CDB Debugger Support\nâ””â”€â”€ Debug Symbols\n```\n\nç»´æŠ¤\n\n```cmd\nMaintenanceTool.exe --mirror https://mirrors.ustc.edu.cn/qtproject/\n```\n\n\n\nSOLIDWORKS ä¸‹è½½ã€å®‰è£…æ•™ç¨‹ï¼ˆSW2025ç­‰å„ç‰ˆæœ¬ä¸ç”¨ç™¾åº¦äº‘é«˜é€Ÿä¸‹è½½ï¼‰ https://zhuanlan.zhihu.com/p/572643562\n\nSolidWorks2020è¯¦ç»†æ­¥éª¤å®‰è£…æ•™ç¨‹ï¼ˆé™„åºåˆ—å·ï¼‰ https://zhuanlan.zhihu.com/p/357370405\n\nå®‰è£…solidworksçš„æ—¶å€™äº§å“é€‰æ‹©å„æ¨¡å—æ€ä¹ˆé€‰ï¼Ÿ https://www.zzzsolidworks.com/solidworkswtj/1363.html\n\næ’ä»¶å·¥å…·ç®± é›¶ä»¶åº“\n"},{"title":"é€šè¿‡uvç®¡ç†pythoné¡¹ç›®ç®¡ç†","url":"/2025/12/22/é€šè¿‡uvç®¡ç†pythoné¡¹ç›®ç®¡ç†/","content":"\n## çº¯æ‰‹å·¥ç®¡ç†é¡¹ç›®\nåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­\n\nåˆ›å»ºpythonè¿è¡Œç¯å¢ƒ\n```python\npython -m venv .venv\n```\n\næ¿€æ´»ç¯å¢ƒ\n```python\nsource .venv/bin/activate\n```\n\nç¼–è¾‘é¡¹ç›®ç®¡ç†æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¾èµ–å£°æ˜\n```python\nedit pyproject.toml\n```\n\nå®‰è£…ä¾èµ– å¹¶æŠŠè‡ªèº«å®‰è£…åˆ°ä¾èµ–ä¸­ï¼Œå¹¶åˆ›å»ºæºç çš„é“¾æ¥\n```python\npip install -e .\n```\n\nå¦‚æœä½¿ç”¨`pip install .`ä¼šæŠŠé¡¹ç›®æ‰“åŒ…æˆä¸€ä¸ªæ ‡å‡†è½¯ä»¶åŒ…å¹¶å®‰è£…è¿™ä¸ªè½¯ä»¶åŒ…ï¼Œä½†è¿™æ ·ä¼šé€ æˆ .venv ä¸­å’Œé¡¹ç›®ä¸­éƒ½æœ‰ä¸€ä»½é¡¹ç›®æºä»£ç ï¼Œæ‰€ä»¥è¦åŠ  -e é€‰é¡¹ã€‚\n\nä¼ ç»Ÿæ–¹å¼è¿è¡Œä»£ç \n\n```python\nsource .venv/bin/activate\npython main.py\n```\n\nå¯¼å‡ºé¡¹ç›®ä¸­å®‰è£…çš„åŒ…ï¼ˆä¼šå¯¼å‡ºç›´æ¥å’Œé—´æ¥ä¾èµ–åŒ…ï¼Œå¾ˆéš¾ç®¡ç†å’Œç»´æŠ¤ï¼‰\n\n```bash\npip frzzeen > requirements.txt\n```\n\n\n\n## ä½¿ç”¨uvæŒ‡ä»¤\n\nç¼–è¾‘pyproject.toml åŸºæœ¬ä¿¡æ¯ï¼ˆä»…éœ€åŒ…å«é¡¹ç›®åç§°å’Œç‰ˆæœ¬å·ï¼‰\n```toml\n[project]\nname = \"uv_test\"\nversion = \"0.1.0\"\n```\n\nä¸‹é¢çš„ä»£ç ä¼šå°†åŒ…ä¿¡æ¯åŠ å…¥ dependencies åˆ—è¡¨ï¼Œæ£€æŸ¥å¹¶è‡ªåŠ¨åˆ›å»º `.venv`è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶å°†è½¯ä»¶åŒ…å’Œä¾èµ–å®‰è£…åˆ°è™šæ‹Ÿç¯å¢ƒ\n```python\nuv add flask\n```\n\nå¦‚æœæ˜¯åˆ«äººçš„é¡¹ç›®ï¼Œåªéœ€è¦æ‰§è¡Œä¸‹é¢çš„ä»£ç å³å¯è‡ªåŠ¨è¯»å– `pyproject.toml` å¹¶é…ç½®å¥½ç¯å¢ƒ\n```python\nuv sync\n```\n\nuv è¿è¡Œä»£ç ï¼ˆåœ¨è™šæ‹Ÿç¯å¢ƒä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç ï¼‰\n```python\nuv run main.py\n```\n\n\n\n## ä¸“é—¨å­¦ä¹ ä½¿ç”¨uv\n\nhttps://youtu.be/aVXs8lb7i9U?si=zoLFH2cVCGGLH8II\n\nè¦è®©ä¸€æ®µç¨‹åºè¿è¡Œéœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š\n\n* ç¡®å®šPythonçš„ç‰ˆæœ¬ \n* è§£å†³ä¾èµ–\n\n### pythonç‰ˆæœ¬å‘¢\n\næŸ¥çœ‹uv æ”¯æŒçš„pythonç‰ˆæœ¬\n\n```bash\nuv python list\n```\n\nå®‰è£…éœ€è¦çš„ç‰ˆæœ¬\n\n```bash\nuv python install cpython-3.12\n```\n\nä½¿ç”¨æŒ‡å®špythonç‰ˆæœ¬è¿è¡Œè„šæœ¬\n\n```bash\nuv run -p 3.12 main.py\n```\n\nå¦‚æœä½¿ç”¨äº¤äº’ç‰ˆæœ¬\n\n```bash\nuv run -p 3.12 python\n```\n\n\n\n### ä¾èµ–\n\nç›´æ¥åˆ›å»ºç¤ºä¾‹å·¥ç¨‹\n\n```bash\nuv init -p 3.13\n```\n\nå¯ä»¥ç›´æ¥åœ¨.python-version æ–‡ä»¶ä¸­ä¿®æ”¹pythonçš„ç‰ˆæœ¬ï¼Œä¹Ÿå¯åœ¨ pyproject.toml ä¸­å®šä¹‰ `requires-python = \">=3.10,<3.13\"`\n\nå®‰è£…æŒ‡å®šçš„ä¾èµ–åŒ…ï¼Œæ­¤æ—¶uvä¸ä»…ä¼šä¸‹è½½åº“ä¹Ÿä¼šä¸ºå·¥ç¨‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ .venv\n\n```bash\nuv add flask\n```\n\nå¯ä»¥åœ¨vscodeå³ä¸‹è§’é€‰æ‹©æˆ‘ä»¬çš„è™šæ‹Ÿç¯å¢ƒï¼Œvscodeä¸­çš„é”™è¯¯ä¹Ÿæ¶ˆå¤±äº†ã€‚\n\nè¿è¡Œè„šæœ¬\n\n```\nuv run main.py\n```\n\næ‰“å°ä¾èµ–æ ‘\n\n```\nuv tree\n```\n\n### æ£€æŸ¥å·¥å…·\n\nä½¿ç”¨ ruff æ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒ\n\nå®‰è£…æ–¹å¼1ï¼š\n\n```\nuv add ruff --dev\n```\n\n`--dev` æ˜¯æŒ‡åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œä¸è¦æ‰“åŒ…åˆ°è½¯ä»¶ä¸­\n\nä½¿ç”¨ï¼š\n\n```\nruff check\n```\n\nåˆ é™¤ä¾èµ–æˆ–è½¯ä»¶åŒ…\n\n```\nuv remove ruff --dev\n```\n\n\n\næ–¹å¼2ï¼š\n\n```\nuv tool install ruff\n```\n\nå°† ruff å®‰è£…åˆ°ç³»ç»Ÿä¸­ ï¼ˆæŸ¥çœ‹è·¯å¾„ which ruffï¼‰\n\næŸ¥çœ‹å·²ç»å®‰è£…çš„å·¥å…·\n\n```\nuv tool list\n```\n\n\n\n### æ‰“åŒ…\n\nå°†é¡¹ç›®æ‰“åŒ…æˆä¸€ä¸ªå¯ä»¥è¿è¡Œçš„è„šæœ¬\n\nåœ¨ `pyproject.toml` ä¸­åŠ å…¥ä¸€ä¸ª  `project.scripts` å®šä¹‰ `è„šæœ¬åç§° = è„šæœ¬:å‡½æ•°å`\n\n```\n[project.scripts]\nai = â€œai:mainâ€\n```\n\nè¿è¡Œæ‰“åŒ…å‘½ä»¤ï¼ŒæŠŠæ•´ä¸ªå·¥ç¨‹æ‰“åŒ…æˆ .whl æ–‡ä»¶\n\n```\nuv build\n```\n\nwhl æ–‡ä»¶å°±å¯ä»¥å‘å¸ƒåˆ°è½¯ä»¶ä»“åº“è®©åˆ«äººä½¿ç”¨\n\n```\nuv tool install xxx\næˆ–è€…\nuv add xxx\n```\n\næœ¬åœ°å®‰è£…\n\n```\nuv tool install dist/test-0.1.0-py3-none-any.whl\n```\n\nç°åœ¨å³å¯ç›´æ¥åœ¨ç»ˆç«¯ä½¿ç”¨è„šæœ¬åç§°è¿è¡Œè½¯ä»¶äº†\n\n```\nai xxx\n```\n\n\n\n### å…¶ä»–å·¥å…·\n\nä½¿ç”¨ uv tool å®‰è£…çš„è„šæœ¬éƒ½æ‹¥æœ‰è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒï¼Œä¸ä¾èµ–å¼€å‘ç¯å¢ƒæˆ–è€…ç³»ç»Ÿç¯å¢ƒ\n\nuv tool run ruff ä¹Ÿå¯ä»¥ä½¿ç”¨ uvx ruff\n\nå•å…ƒæµ‹è¯• pytest \n\nmock åº“\n\n\n","tags":["Python"]},{"title":"tasmotaæ¥å…¥thingsboard","url":"/2025/09/03/tasmotaæ¥å…¥thingsboard/","content":"\n## æ¶æ„\n\nå‚è€ƒé“¾æ¥ï¼šhttps://thingsboard.io/docs/iot-gateway/what-is-iot-gateway/\n\næƒ³è¦å°†tasmotaæ¥å…¥thingsboardéœ€è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š\n\ntasmota -> mqtt broker -> IoT Gateway -> thingsboard \n\n## å®‰è£…æµç¨‹\n\nä¸»è¦å‚è€ƒå®˜ç½‘æ•™ç¨‹ï¼šhttps://thingsboard.io/docs/iot-gateway/getting-started/\n\n### å‰æœŸå‡†å¤‡å·¥ä½œ\n\nå®‰è£… Docker\n\nå®‰è£… thingsboard\n\n### å¯¼å…¥ MyGetway ç®¡ç†é¡µé¢\n\næ•™ç¨‹ `Prerequisites` å°èŠ‚ä¸‹è½½ä¸¤ä¸ª jsonæ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§ [Import gateway widgets bundle and dashboard](https://thingsboard.io/docs/iot-gateway/getting-started/#optional-import-gateway-widgets-bundle-and-dashboard) å¯¼å…¥ thingsboardã€‚\n\næŒ‰ç…§æ•™ç¨‹åœ¨ Dashboards ä¸­åˆ›å»º  MyGateway å¹¶è¿›å…¥è¯¦æƒ…é¡µï¼Œç‚¹å‡» Launch command æŒ‰é’®ã€‚\n\n<img src=\"image-20250902215700716.png\" alt=\"image-20250902215700716\" style=\"zoom:50%;\" />\n\n<img src=\"image-20250902215824743.png\" alt=\"image-20250902215824743\" style=\"zoom:80%;\" />\n\nå¦‚æœä½ å’Œæˆ‘ä¸€æ ·æ²¡æœ‰å†…å®¹ï¼Œä¸è¦ç€æ€¥æ¢ä¸ªåœ°æ–¹æ‰“å¼€ï¼šEntities/Gateways/My Gateway/Launch command\n\n### å®‰è£… Gateway å’Œ mosquitto\n\nç»§ç»­æŒ‰ç…§æ•™ç¨‹é€šè¿‡ docker å®‰è£… tb-gateway\n\n`Step 3. Add new connector` ä¸­æˆ‘ä»¬é€‰æ‹© MQTT è¿æ¥æ–¹å¼ã€‚é€šè¿‡dockerå®‰è£…mosquitto ï¼ˆå®‰è£…å¥½çš„ mosquitto ä¸ç”¨è´¦å·å¯†ç éªŒè¯ï¼‰\n\n`Setup connector` å°èŠ‚ä¸­ Host å¡«å†™ä¸»æœºçš„å…¬ç½‘IPæˆ–è€… `127.0.0.1`ï¼› Port å¡«å†™ 1884ï¼Œå› ä¸º1883è¢« thingsboard å ç”¨äº†ï¼Œæ‰€ä»¥å®‰è£… mosquitto çš„dockeræŒ‡ä»¤ä½¿ç”¨çš„æ˜¯ `docker run -it -p 1884:1884 thingsboard/tb-gw-mqtt-broker:latest`ã€‚\n\nç»§ç»­æŒ‰ç…§æ•™ç¨‹æ“ä½œ\n\n### Add mapping ï¼ˆè§£ç ä¿¡æ¯ï¼‰\n\nè§£ç  tasmota é€šè¿‡mqtt æ¶ˆæ¯å‘é€åˆ° mosquitto çš„æ¶ˆæ¯ã€‚\n\n<img src=\"image-20250902222537779.png\" alt=\"image-20250902222537779\" style=\"zoom:50%;\" />\n\nç°å–å…¶ä¸­éƒ¨åˆ†ä½œä»¥è¯´æ˜ï¼š\n\n<img src=\"image-20250902222832240.png\" alt=\"image-20250902222832240\" style=\"zoom:50%;\" />\n\ntele/+/STATE: + æ˜¯è®¾å¤‡åæ­¤éƒ¨åˆ†æ˜¯å¯å˜çš„\n\nNameï¼š è®¾å¤‡åç§°ï¼Œæ˜¯ä» Topic ä¸­é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ `(?<=tele/)(.*?)(?=/STATE)` å–å‡ºæ¥çš„ã€‚ä¾‹å¦‚ä¸»é¢˜æ˜¯ï¼štele/tasmota_0BF5D0/STATE ï¼Œç»è¿‡æ­£åˆ™è¡¨è¾¾å¼å–å‡ºè®¾å¤‡åç§° tasmota_0BF5D0ã€‚\n\nAttributes:  è§£ç å±æ€§ï¼ˆä¸ç»å¸¸å˜çš„ï¼‰ï¼Œè§£ç é€»è¾‘å‚è€ƒé¡µé¢å†…éƒ¨çš„å¸®åŠ©æ–‡æ¡£ã€‚\n\nTime seriesï¼šæ—¶é—´åºåˆ—ï¼ˆç»å¸¸å‘ç”Ÿå˜åŒ–çš„ï¼‰\n\n<img src=\"image-20250902223327548.png\" alt=\"image-20250902223327548\" style=\"zoom:50%;\" />\n\n### Requests mapping ï¼ˆå‘é€æ§åˆ¶æŒ‡ä»¤ï¼‰\n\n<img src=\"image-20250902223654940.png\" alt=\"image-20250902223654940\" style=\"zoom:50%;\" />\n\nå¯ä»¥åœ¨ğŸ”’ä¸­æµ‹è¯•æ§åˆ¶æŒ‡ä»¤ï¼Œå»ºè®®ä½¿ç”¨ç±»ä¼¼ MQTT-Explorer è¿™ç§è°ƒè¯•è½¯ä»¶è§‚å¯ŸæŒ‡ä»¤å‘é€å’Œå“åº”æƒ…å†µã€‚\n\n<img src=\"image-20250902223818723.png\" alt=\"image-20250902223818723\" style=\"zoom:50%;\" />\n\nPower1 æŒ‡çš„æ˜¯ tasmota è®¾ç½®ä¸º Relay 1 çš„å¼•è„šã€‚RPC command å‘å¯¹åº”çš„ä¸»é¢˜å‘é€æ¶ˆæ¯ã€‚\n\n### tasmota è”ç½‘ è®¾ç½®mqttå‚æ•°\n\ntasmota è®¾ç½®å®Œæˆåï¼Œä½¿ç”¨ MQTT-Explorer è¿æ¥åˆ° mosquittoï¼Œè§‚å¯Ÿæ˜¯å¦æˆåŠŸä¸ŠæŠ¥ä¸»é¢˜ã€‚\n\nå†ä» thingsboard èœå• Entities/Devices æŸ¥çœ‹æ˜¯å¦æœ‰è‡ªåŠ¨æ·»åŠ çš„è®¾å¤‡ã€‚ç‚¹å‡»è®¾å¤‡ï¼Œå¦‚ tasmota_0BF5D0 æŸ¥çœ‹ Attributes é¡µï¼Œæ£€æŸ¥æ•°æ®è§£ææ˜¯å¦æ­£å¸¸ã€‚\n\n![image-20250902225143340](image-20250902225143340.png)\n\n### thingsboard ç•Œé¢æ˜¾ç¤ºå’ŒæŒ‰é’®å‘é€æ§åˆ¶æŒ‡ä»¤\n\nä½¿ç”¨ Attributes card æ˜¾ç¤ºçŠ¶æ€ï¼ŒåˆæœŸæµ‹è¯• Type è¯·é€‰æ‹© Deviceï¼Œåé¢è®¾ç½®å¤šäº†éœ€è¦åšæˆç±»ä¼¼æ¨¡æ¿çš„æ—¶å€™å†é€‰æ‹© Entityã€‚\n\n![image-20250902225610092](image-20250902225610092.png)\n\nä½¿ç”¨ RPC Button å‘é€æ§åˆ¶æŒ‡ä»¤\n\nçº¢è‰²ç®­å¤´çš„åœ°æ–¹ä»»æ„ï¼Œåªå½±å“æŒ‰é’®æ˜¾ç¤ºæ–‡æœ¬\n\n<img src=\"image-20250902225855402.png\" alt=\"image-20250902225855402\" style=\"zoom:50%;\" />\n","tags":["IoT thingsboard tasmota"]},{"title":"linuxç³»ç»Ÿè¿›ç¨‹ç®¡ç†systemd","url":"/2025/07/27/linuxç³»ç»Ÿè¿›ç¨‹ç®¡ç†systemd/","content":"\nè§†é¢‘ https://youtu.be/y5E98mjcZfc?si=i5-pACE_PS9Nq1jM\n\n## ä»‹ç»\n\nsystemd ä½œä¸º init è¿›ç¨‹ï¼Œå…¶ä»–è¿›ç¨‹æ˜¯ä»–çš„å­è¿›ç¨‹\n\nsystemctl æ˜¯systemd çš„ç®¡ç†å·¥å…·\n\n## å¸¸ç”¨å‘½ä»¤\n\n`htop` æŒ‰ t é”®å¯ä»¥æ ‘çŠ¶è§†å›¾æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨\n\n`pstree -p` å¯ä»¥æ ‘çŠ¶è§†å›¾æŸ¥çœ‹åˆ—è¡¨\n\n`systemctl list-unit` åˆ†ç±»æŸ¥çœ‹å½“å‰ç³»ç»Ÿå®šä¹‰çš„ç³»ç»Ÿunit (device mount path service socket timer)\n\nè¦å…·ä½“æŸ¥çœ‹å…¶ä¸­æŸä¸€ä¸ªunit çš„çŠ¶æ€ï¼Œä¾‹å¦‚ï¼š`systemctl status sshd.service` ä¾‹å¦‚ï¼šsystemctl status dnf-makecache.timer\n\nåœæ­¢ `systemctl stop chronyd.service`\n\nå¯åŠ¨ `systemctl start chronyd.service`\n\nå¼€æœºè‡ªå¯ `systemctl enable chronyd`\n\nç¦ç”¨è‡ªå¯ `systemctl disable chronyd`\n\n## systemd unit é…ç½®æ–‡ä»¶\n\næŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­å­˜åœ¨çš„é…ç½®æ–‡ä»¶ systemctl list-unit-files\n\næŸ¥çœ‹æ–‡ä»¶è·¯å¾„å’Œå†…å®¹ systemctl cat chronyd.service\n\nä¿®æ”¹é…ç½®æ–‡ä»¶ systemctl edit chronyd.service é€€å‡ºçš„æ—¶å€™å¦‚æœæœ‰é”™è¯¯ä¼šæœ‰æç¤ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡vim nano\n\n/etc/systemd/system         è‡ªå®šä¹‰çš„\n\n/lib/systemd/system          ç³»ç»Ÿ\n\n/usr/lib/systemd/system   ç”¨æˆ·å®‰è£…è½¯ä»¶äº§ç”Ÿçš„\n\n### service\n\nç¼–å†™é…ç½®æ–‡ä»¶ man 5 systemd.service å†…éƒ¨è¿˜æœ‰ examples\n\nåŒ…å«ä¸‰ä¸ªéƒ¨åˆ† [Unit] [Install] [Service]\n\n`vim /etc/systemd/system/hello-world.service`\n\n```bash\n[Unit]\nDescription=Hello Wrold\n\n[Service]\nExecStart=/usr/bin/python3 /root/hello-world.py\n\n[Install]\nWantedBy=multi-user.target\n```\n\n`cat hello-world.py`\n\n```python\nimport logging\nimport time\n\nlogging.basicConfig(format='Date-Time ï¼š %(asctime)s : Line No. : %(lineno)d - %(message)s', \\\n                   Level = logging.DEBUG)\nwhile True:\n    logging.debug(\"A Debug Logging Message\")\n    time.sleep(10)\n```\n\n`systemctl status hello-world`  å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœåŠ¡ éœ€è¦ä½¿ç”¨ `systemctl daemon-reload`\n\n`systemctl start hello-world` å¼€å§‹æ‰§è¡Œ status æŸ¥çœ‹çŠ¶æ€\n\nsystemctl å¯ä»¥æŸ¥çœ‹çš„æ—¥å¿—ä¸å¤šï¼Œå¯ä»¥ä½¿ç”¨ `journalctl -u hello-world.service`\n\n### timer\n\n`systemctl list-timers`\n\n`man 5 systemd.timer`\n\nåŒ…å«ä¸‰ä¸ªéƒ¨åˆ† [Unit] [Install] [Timer]\n\ncat hello-world.timer\n\n```bash\n[Unit]\nDescription=My Service Timer\n\n[Timer]\nOnUnitActiveSec=1min\nUnit=hello-world.service\n\n[Install]\nWantedBy=timers.target\n```\n\næ¯éš”ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€ä¸‹ hello-world.service çš„å†…å®¹\n\nhello-world.py å–æ¶ˆå¾ªç¯\n\n```bash\nimport logging\nimport time\n\nlogging.basicConfig(format='Date-Time ï¼š %(asctime)s : Line No. : %(lineno)d - %(message)s', \\\n                   Level = logging.DEBUG)\nlogging.debug(\"A Debug Logging Message\")\n```\n\n`journalctl -u hello-world.service` æŸ¥çœ‹æ—¥å¿—æ ¸æ¯éš”ä¸€åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ã€‚","tags":["linux"]},{"title":"micropythonä¸Šä¼ æ–‡ä»¶","url":"/2025/04/16/micropythonä¸Šä¼ æ–‡ä»¶/","content":"\nmicropython ä½¿ç”¨ openmv çš„ requests åº“ä¸Šä¼ æ–‡ä»¶\n\n## é—®é¢˜\n\næ ¹æ® microptyhon å®˜æ–¹ requests åº“ä¸­æè¿°ï¼Œå¹¶ä¸æ”¯æŒä¸Šä¼ æ–‡ä»¶ã€‚\n\n- File upload is not supported.\n\n## æŸ¥æ‰¾å…¶ä»–åº“\n\nä»æ­¤é“¾æ¥æœ€ä¸‹æ–¹å¾—åˆ° openmvçš„åº“å·²ç»æ”¯æŒä¸Šä¼ æ–‡ä»¶ https://forums.openmv.io/t/send-files-to-google-storage/8338\n\nopenmv urequestsåº“\n\næ–‡æ¡£ï¼šhttps://docs.openmv.io/library/urequests.html\n\næºç ï¼šhttps://github.com/openmv/openmv/blob/master/scripts/libraries/requests.py\n\n\n\n![1744529612789](1744529612789.png)\n\néƒ¨åˆ†æºç ï¼š\n\n```python\n        if files is not None:\n            data = bytearray()\n            boundary = b\"37a4bcce91521f74142f1868e328a6b9\"\n            s.write(b\"Content-Type: multipart/form-data; boundary=%s\\r\\n\" % (boundary))\n            for name, fileobj in files.items():\n                data += b\"--%s\\r\\n\" % (boundary)\n                data += b'Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"\\r\\n\\r\\n' % (\n                    name,\n                    fileobj[0],\n                )\n                data += fileobj[1].read()\n                data += b\"\\r\\n\"\n            data += b\"\\r\\n--%s--\\r\\n\" % (boundary)\n\n        if data:\n            s.write(b\"Content-Length: %d\\r\\n\\r\\n\" % len(data))\n            s.write(data)\n        else:\n            s.write(b\"\\r\\n\")\n```\n\nå¯ä»¥çœ‹åˆ°å‡½æ•°ä¼šæ ¹æ®ç”¨æˆ·ä¼ å…¥fileså‚æ•°ï¼Œå°†æ•°æ®å†™å…¥åˆ°dataå˜é‡ï¼Œå†é€šè¿‡ socket.writeå‡½æ•°å‘é€å‡ºå»ã€‚\n\n\n\n## æ­å»ºè°ƒè¯•ç¯å¢ƒ\n\n### python + fastapi ä½œä¸ºæ–‡ä»¶æœåŠ¡å™¨ã€‚\n\nå¢åŠ äº†å­˜å‚¨åŠŸèƒ½ ï¼Œæ–¹ä¾¿éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ã€‚\n\n```python\n# https://fastapi.tiangolo.com/zh/tutorial/request-files/#file_1\n# http://127.0.0.1:8000/docs å¯åœ¨çº¿æµ‹è¯•\n\nimport shutil\nfrom pathlib import Path\nimport uvicorn\nfrom fastapi import FastAPI, File, UploadFile\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(file: bytes = File(description=\"A file read as bytes\")):\n    return {\"file_size\": len(file)}\n\n\n@app.post(\"/uploadfile/\")\nasync def create_upload_file(\n    file: UploadFile = File(description=\"A file read as UploadFile\"),\n):\n    print(file.filename)\n    p = Path('.')\n    with open(p/file.filename, \"wb\") as buffer:\n        shutil.copyfileobj(file.file, buffer)\n    return {\"filename\": file.filename}\n\nif __name__ == '__main__':\n    uvicorn.run(app, host=\"0.0.0.0\", port=int(\"8000\"))\n```\n\n\n\n### postman å‘ fastapi ä¼ è¾“æ–‡ä»¶\n\néªŒè¯ fastapi æ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚åªæ˜¯ä¸ºäº†æ‰¾é—®é¢˜ï¼Œæ­£å¸¸å¼€å‘å¯è·³è¿‡ã€‚\n\n\n\n![1744530177421](1744530177421.png)\n\næ³¨æ„ï¼šåœ¨ file å•å…ƒæ ¼å³ä¾§ï¼Œå°† Text åˆ‡æ¢ä¸º File å¹¶é€‰ä¸­ä¸€ä¸ªæ–‡ä»¶ã€‚å»ºè®®åˆæœŸé€‰æ‹©ç®€å•çš„æ–‡æœ¬æ–‡æ¡£ã€‚\n\n![1744530218116](1744530218116.png)\n\n\n\n### postman å‘ç½‘ç»œè°ƒè¯•åŠ©æ‰‹å‘é€æ–‡ä»¶\n\nä¸ºäº†ç›´è§‚çš„çœ‹åˆ°å‘é€çš„æ‰€æœ‰æ•°æ®ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚è¿™ä¸ªæ­¥éª¤ä¹Ÿåªæ˜¯ä¸ºäº†æ‰¾é—®é¢˜ï¼Œæ­£å¸¸å¼€å‘å¯è·³è¿‡ã€‚\n\n![1744536371222](1744536371222.png)\n\n\n\n### OpenMV çš„ requests åº“å‘é€æ–‡ä»¶\n\næ—¢ç„¶åŸç‰ˆä¸æ”¯æŒï¼Œå°±ç”¨ OpenMV çš„åº“ã€‚\n\nä½¿ç”¨ OpenMV çš„ requests åº“å‘ fastapi å‘é€æ–‡æœ¬æ–‡ä»¶ï¼Œfastapiæç¤ºé”™è¯¯  \"POST /uploadfile/ HTTP/1.0\" 422 Unprocessable Entityã€‚\n\nä½†æ˜¯ postman å´å¯ä»¥å’Œ fastapi æ­£å¸¸é…åˆã€‚æ­¤æ—¶å°±éœ€è¦æ‰¾åˆ°ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ã€‚éœ€è¦ OpenMV çš„ requests åº“ä¹Ÿå‘ç½‘ç»œè°ƒè¯•åŠ©æ‰‹å‘é€åŒä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¯¹æ¯” postman çš„ç½‘ç»œåŠ©æ‰‹æ•°æ®ï¼Œå‘ç°å°‘ä¸€è¡Œ `Content-Type: text/plain`ã€‚åº“ä¸­å¢åŠ ç›¸å…³çš„ä»£ç ï¼Œå†å»å’Œfastapi é€šè®¯ï¼Œå¯ä»¥æ­£å¸¸ä¸Šä¼ æ–‡ä»¶ã€‚\n\næµ‹è¯•å‡½æ•°ï¼š\n\n```python\ndef upload_img(url, f_path, f_name, f_type):\n    pic_size = 0\n    try:\n        p = f_path+f_name\n        with open(p, 'rb') as file_handle:\n\n            print(p, \"read finish\")\n            files = {f_type: (f_name, file_handle)}\n\n            print(\"upload file...\")\n            r = up_requests.request('POST', url, files=files)\n            if r.status_code == 200:\n                print(\"upload success\")\n            else:\n                print(\"upload failed\")\n    except UnicodeError as e:\n        print(\"Unicode error:\", e)\n    except Exception as e:\n        print(\"HTTP request error:\", e)\n```\n\nä¿®æ”¹åçš„ requests åº“\n\n```python\n# The MIT License (MIT)\n#\n# Copyright (c) 2013, 2014 micropython-lib contributors\n#\n# Permission is hereby granted, free of charge, to any person obtaining a copy\n# of this software and associated documentation files (the \"Software\"), to deal\n# in the Software without restriction, including without limitation the rights\n# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n# copies of the Software, and to permit persons to whom the Software is\n# furnished to do so, subject to the following conditions:\n#\n# The above copyright notice and this permission notice shall be included in\n# all copies or substantial portions of the Software.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n# THE SOFTWARE.\n\n# Source: improved version of micropython-lib's requests.\n# Some useful links for future updates:\n# https://www.w3.org/TR/html401/interact/forms.html#h-17.13.4\n# https://docs.python-requests.org/en/master/\n\nimport socket\nimport binascii\n\n\nclass Response:\n    def __init__(self, code, reason, headers=None, content=None):\n        self.encoding = \"utf-8\"\n        self._content = content\n        self._headers = headers\n        self.reason = reason\n        self.status_code = code\n\n    @property\n    def headers(self):\n        return str(self._headers, self.encoding)\n\n    @property\n    def content(self):\n        return str(self._content, self.encoding)\n\n    def json(self):\n        import json\n\n        return json.loads(self._content)\n\n\ndef readline(s):\n    l = bytearray()\n    while True:\n        try:\n            l += s.read(1)\n            if l[-1] == b\"\\n\":\n                break\n        except:\n            break\n    return l\n\n\ndef socket_readall(s):\n    buf = b\"\"\n    while True:\n        recv = b\"\"\n        try:\n            recv = s.recv(1)\n        except:\n            pass\n        if len(recv) == 0:\n            break\n        buf += recv\n    return buf\n\n\ndef request(method, url, data=None, json=None, files=None, headers={}, auth=None, stream=None):\n    try:\n        proto, dummy, host, path = url.split(\"/\", 3)\n    except ValueError:\n        proto, dummy, host = url.split(\"/\", 2)\n        path = \"\"\n    if proto == \"http:\":\n        port = 80\n    elif proto == \"https:\":\n        import ssl\n\n        port = 443\n    else:\n        raise ValueError(\"Unsupported protocol: \" + proto)\n\n    if \":\" in host:\n        host, port = host.split(\":\", 1)\n        port = int(port)\n\n    if auth:\n        headers[\"Authorization\"] = b\"Basic %s\" % (\n            binascii.b2a_base64(\"%s:%s\" % (auth[0], auth[1]))[0:-1]\n        )\n\n    resp_code = 0\n    resp_reason = None\n    resp_headers = []\n\n    ai = socket.getaddrinfo(host, port)[0]\n    s = socket.socket(ai[0], ai[1], ai[2])\n    try:\n        s.connect(ai[-1])\n        s.settimeout(5.0)\n        if proto == \"https:\":\n            s = ssl.wrap_socket(s, server_hostname=host)\n\n        s.write(b\"%s /%s HTTP/1.0\\r\\n\" % (method, path))\n\n        if \"Host\" not in headers:\n            s.write(b\"Host: %s\\r\\n\" % host)\n\n        # Iterate over keys to avoid tuple alloc\n        for k in headers:\n            s.write(k)\n            s.write(b\": \")\n            s.write(headers[k])\n            s.write(b\"\\r\\n\")\n\n        if json is not None:\n            import json\n\n            data = json.dumps(json)\n            s.write(b\"Content-Type: application/json\\r\\n\")\n\n        if files is not None:\n            data = bytearray()\n            boundary = b\"37a4bcce91521f74142f1868e328a6b9\"\n            s.write(b\"Content-Type: multipart/form-data; boundary=%s\\r\\n\" % (boundary))\n            for filetype, fileobj in files.items():\n                data += b\"--%s\\r\\n\" % (boundary)\n                data += b'Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"\\r\\n' % (\n                    'file',\n                    fileobj[0]\n                )\n                data += b'Content-Type: %s\\r\\n\\r\\n' % (filetype)\n                data += fileobj[1].read()\n                data += b\"\\r\\n\"\n            data += b\"\\r\\n--%s--\\r\\n\" % (boundary)\n\n        if data:\n            s.write(b\"Content-Length: %d\\r\\n\\r\\n\" % len(data))\n            s.write(data)\n        else:\n            s.write(b\"\\r\\n\")\n\n        response = socket_readall(s).split(b\"\\r\\n\")\n        while response:\n            l = response.pop(0).strip()\n            if not l or l == b\"\\r\\n\":\n                break\n            if l.startswith(b\"Transfer-Encoding:\"):\n                if b\"chunked\" in l:\n                    raise ValueError(\"Unsupported \" + l)\n            elif l.startswith(b\"Location:\") and not 200 <= status <= 299:\n                raise NotImplementedError(\"Redirects not yet supported\")\n            if \"HTTPS\" in l or \"HTTP\" in l:\n                sline = l.split(None, 2)\n                resp_code = int(sline[1])\n                resp_reason = sline[2].decode().rstrip() if len(sline) > 2 else \"\"\n                continue\n            resp_headers.append(l)\n        resp_headers = b\"\\r\\n\".join(resp_headers)\n        content = b\"\\r\\n\".join(response)\n    except OSError:\n        raise\n    finally:\n        s.close()\n\n    return Response(resp_code, resp_reason, resp_headers, content)\n\n\ndef head(url, **kw):\n    return request(\"HEAD\", url, **kw)\n\n\ndef get(url, **kw):\n    return request(\"GET\", url, **kw)\n\n\ndef post(url, **kw):\n    return request(\"POST\", url, **kw)\n\n\ndef put(url, **kw):\n    return request(\"PUT\", url, **kw)\n\n\ndef patch(url, **kw):\n    return request(\"PATCH\", url, **kw)\n\n\ndef delete(url, **kw):\n    return request(\"DELETE\", url, **kw)\n```\n\n\n\n## å…¶ä»–\n\nOpenMV çš„åº“ä¸‹è½½æ–‡ä»¶åŠŸèƒ½ä¸èƒ½ç”¨ã€‚\n\nç°åœ¨æ˜¯ micropython åº“ä¸‹è½½æ–‡ä»¶ï¼ŒOpenMVçš„åº“ä¸Šä¼ æ–‡ä»¶ã€‚\n","tags":["micropython"]},{"title":"micropythonä¸‹è½½æ–‡ä»¶","url":"/2025/04/16/micropythonä¸‹è½½æ–‡ä»¶/","content":"\n## micropython ä½¿ç”¨ requests åº“ä¸‹è½½æ–‡ä»¶\n\nåº“æºç ï¼š[requests github](https://github.com/micropython/micropython-lib/blob/master/python-ecosys/requests/requests/__init__.py)\n\nsocket ä¸­æ–‡æ–‡æ¡£ï¼šhttp://micropython.86x.net/en/latet/library/socket.html\n\nsocket è‹±æ–‡æ–‡æ¡£ï¼šhttps://docs.micropython.org/en/latest/library/socket.html\n\n### æœ¬åœ°HTTPæœåŠ¡å™¨\n\nå¯åŠ¨ç”¨äºæµ‹è¯•çš„ç®€å•æœ¬åœ°HTTPæœåŠ¡å™¨ï¼š https://www.cnblogs.com/shengshengwang/p/17939492\n\n```python\npython -m http.server\n```\n\nè¿è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œé»˜è®¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œç›‘å¬åœ¨æœ¬åœ°çš„ 8000 ç«¯å£ã€‚å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® http://localhost:8000 æ¥æŸ¥çœ‹å½“å‰ç›®å½•çš„æ–‡ä»¶åˆ—è¡¨ã€‚ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç«¯å£å· `python -m http.server 8888`\n\n\n### é—®é¢˜\n\nä¸‹é¢æ˜¯ requests åº“çš„ content å±æ€§çš„å®ç°ï¼Œä¼šé€šè¿‡ socket åº“çš„ read() å‡½æ•°å°†æ•°æ®ä¸€æ¬¡æ€§å…¨éƒ¨å»è¯»åˆ° self._cached å˜é‡ï¼Œä¹Ÿå°±æ˜¯å†…å­˜ä¸­ã€‚è¿™ç§æ–¹å¼åœ¨è¯»å–å°æ–‡ä»¶æ—¶æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ–‡ä»¶ä½“ç§¯ç¨å¤§ä¸€äº›åå°±ä¼šå‡ºç°**å“åº”ç¼“æ…¢**ï¼Œä¸¥é‡çš„è¯ä¼š**çˆ†å†…å­˜**çš„æƒ…å†µï¼Œæ¯•ç«Ÿè¿è¡Œ micropython çš„åµŒå…¥å¼è®¾å¤‡èµ„æºéƒ½æ¯”è¾ƒç´§å¼ ã€‚\n\n```python\n@property\ndef content(self):\n    if self._cached is None:\n        try:\n            self._cached = self.raw.read()\n            finally:\n                self.raw.close()\n                self.raw = None\n                return self._cached\n```\n\n### è§£å†³\n\nå‚è€ƒ python requests åº“çš„ç”¨æ³•ï¼Œé“¾æ¥ï¼šhttps://www.cnblogs.com/hls-code/p/15012629.html\n\næµå¼ä¸‹è½½èƒ½æ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯ micropython çš„ requests åº“å¹¶æ²¡æœ‰ `iter_content()` å‡½æ•°çš„å®ç°ã€‚\n\né€šè¿‡å¾ªç¯ï¼Œæ¯æ¬¡è¯»å–ä¸€å®šé‡çš„æ•°æ®æ˜¯å¦å¯è¡Œï¼Ÿä»£ç å¦‚ä¸‹ï¼š\n\n```\nurl = \"http://xx.xxx.xxx.xxx:8888/yolov8n_224.kmodel\"\nr = libs.requests.get(url, stream=True)\nif r.status_code == 200:\n\tprint(\"Downloading file...\")\n\twith open('/sdcard/yolov8n_224.kmodel', 'wb') as pic_file:  # ä¿å­˜æ–‡ä»¶\n\t\twhile True:\n\t\t\tchunk = r.raw.recv(1024*20)\n\t\t\tif not chunk:\n\t\t\t\tbreak\n\t\t\tpic_file.write(chunk)\n\t\t\tpic_size += len(chunk)\n\t\t\tprint(pic_size)\n\tprint(\"Downloading finish\")\nr.close()\n```\n\næç¤ºï¼šåœ¨å¼€å‘æ¿è¿è¡Œä»£ç æ—¶æ³¨æ„å°† xxx æ›¿æ¢ä¸º http æœåŠ¡å™¨çš„ ipï¼Œè€Œä¸æ˜¯127.0.0.1 æˆ–è€… localhostï¼›æ£€æŸ¥æ‹‰å–å’Œå­˜å‚¨çš„æ–‡ä»¶åç§°å’Œè·¯å¾„ã€‚\n\n### å…¶ä»–\n\n1. read()  æœ€åä¸€åŒ…æ•°æ®ä¸¢å¤±ã€‚\n\n   ä½¿ç”¨ r.raw.read(1024) å‘ç°æœ€åä¸€åŒ…æ•°æ®æ€»æ˜¯æ”¶ä¸åˆ°ï¼ŒæŸ¥çœ‹ socket æ–‡æ¡£ `socket.read([size])` æœ‰ä¸€æ®µè¯´æ˜\n\n   *This function tries to read as much data as requested (no â€œshort readsâ€). This may be not possible with non-blocking socket though, and then less data will be returned.* \n\n   **æ²¡æœ‰çŸ­è¯»**ï¼šå³ä¸ä¼šè¿”å›â€œçŸ­è¯»å–â€ï¼ˆå³å°‘äºè¯·æ±‚å­—èŠ‚æ•°çš„æ•°æ®ï¼‰ é€ æˆæœ€åä¸€åŒ…æ•°æ®ä¸¢å¤±ã€‚\n\n2. content()  éå¸¸æ…¢\n\n\n```python\nwith open('/sdcard/6.bmp', 'wb') as pic_file:  # ä¿å­˜æ–‡ä»¶\n    pic_file.write(r.content)\n```\n\n\n\n### å®Œæ•´ç¤ºä¾‹\n\n```python\nimport network,time\nfrom machine import Pin\nimport libs.requests\n\n#WIFIè¿æ¥å‡½æ•°\ndef WIFI_Connect():\n\n    WIFI_LED=Pin(52, Pin.OUT) #åˆå§‹åŒ–WIFIæŒ‡ç¤ºç¯\n\n    wlan = network.WLAN(network.STA_IF) #STAæ¨¡å¼\n    wlan.active(True)                   #æ¿€æ´»æ¥å£\n    start_time=time.time()              #è®°å½•æ—¶é—´åšè¶…æ—¶åˆ¤æ–­\n\n    if not wlan.isconnected():\n        print('connecting to network...')\n        for i in range(3): #é‡å¤è¿æ¥3æ¬¡\n            #è¾“å…¥WIFIè´¦å·å¯†ç ï¼ˆä»…æ”¯æŒ2.4Gä¿¡å·ï¼‰, è¿æ¥è¶…è¿‡5ç§’ä¸ºè¶…æ—¶\n            wlan.connect('xxxxx', 'xxxx')\n            if wlan.isconnected(): #è¿æ¥æˆåŠŸ\n                break\n\n    if wlan.isconnected(): #è¿æ¥æˆåŠŸ\n        #LEDè“ç¯ç‚¹äº®\n        WIFI_LED.value(1)\n\n        #ç­‰å¾…è·å–IPåœ°å€\n        while wlan.ifconfig()[0] == '0.0.0.0':\n            pass\n\n        #ä¸²å£æ‰“å°ä¿¡æ¯\n        print('network information:', wlan.ifconfig())\n        return True\n\n    else: #è¿æ¥å¤±è´¥\n\n        #LEDé—ªçƒ3æ¬¡æç¤º\n        for i in range(3):\n            WIFI_LED.value(1)\n            time.sleep_ms(300)\n            WIFI_LED.value(0)\n            time.sleep_ms(300)\n\n        wlan.active(False)\n\n        return False\n\n\ndef DownloadFile():\n    pic_size = 0\n    try:\n        url = \"http://192.168.1.100:8888/6.bmp\"\n        r = libs.requests.get(url, timeout=None, stream=True)\n        if r.status_code == 200:\n            print(\"Downloading file...\")\n            with open('/sdcard/6.bmp', 'wb') as pic_file:  # ä¿å­˜æ–‡ä»¶\n#                pic_file.write(r.content)  # éå¸¸æ…¢\n                while True:\n#                    chunk = r.raw.read(1024*20)  # æ²¡æœ‰çŸ­è¯» å³ä¸ä¼šè¿”å›â€œçŸ­è¯»å–â€ï¼ˆå³å°‘äºè¯·æ±‚å­—èŠ‚æ•°çš„æ•°æ®ï¼‰ é€ æˆä¸¢æœ€åä¸€åŒ…æ•°æ®\n                    chunk = r.raw.recv(1024*20)\n                    if not chunk:\n                        break\n                    pic_file.write(chunk)\n                    pic_size += len(chunk)\n                    print(pic_size)\n            print(\"Downloading finish\")\n        r.close()\n    except UnicodeError as e:\n        print(\"Unicode error:\", e)\n    except Exception as e:\n        print(\"HTTP request error:\", e)\n\n\nWIFI_Connect()\nDownloadFile()\n```\n\nä¿®æ”¹ wifi æ–‡ä»¶å å’Œå­˜å‚¨è·¯å¾„","tags":["micropython"]},{"title":"sstvæ¥æ”¶æŒ‡å—","url":"/2025/04/12/sstvæ¥æ”¶æŒ‡å—/","content":"\n## åŸºç¡€çŸ¥è¯†\n\nSSTV çš„å‘é€ï¼Œç®€å•æ¥è¯´å°±æ˜¯å°†å›¾ç‰‡ç¼–ç æˆéŸ³é¢‘ï¼Œä½¿ç”¨ç”µå°å°†æ­¤éŸ³é¢‘å‘é€å‡ºå»ã€‚è¿™ä¸ªå’Œæˆ‘ä»¬ç”¨æ‰‹å°é€šè”æ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯å–Šå‡ºå»çš„ä¸æ˜¯CQï¼Œè€Œæ˜¯æ ¹æ®ç‰¹å®šåè®®å°†å›¾ç‰‡è½¬æˆçš„éŸ³é¢‘ã€‚SSTV Mode éå¸¸å¤šï¼ŒISSå¸¸ç”¨çš„æ˜¯PD120æ¨¡å¼FMè°ƒåˆ¶æ–¹å¼ã€‚\n\nSSTVæ¥æ”¶ï¼Œå°±æ˜¯ä¸Šé¢çš„åå‘æµç¨‹ã€‚æ‰‹å°æ¥æ”¶æ— çº¿ç”µä¿¡å·å¹¶è½¬ä¸ºéŸ³é¢‘ï¼Œä½¿ç”¨è½¯ä»¶è§£ç æ­¤éŸ³é¢‘å°±å¾—åˆ°äº†å›¾ç‰‡ã€‚æ‰€ä»¥æœ‰å¾ˆå¤šäººä½¿ç”¨æ‰‹å°ï¼Œé…åˆæ‰‹æœºè½¯ä»¶æ¥æ”¶SSTVå›¾ç‰‡ã€‚è®°å¾—**å…³é—­é™å™ª**åŠŸèƒ½ï¼Œä¸ç„¶å¼±ä¿¡å·ç”µå°éƒ½ä¸å¸¦å“çš„ã€‚\n\næ­¤ç½‘ç«™ https://amsat-uk.org/beginners/iss-sstv/SSTV åŒ…å«æ•™ç¨‹å’Œæµ‹è¯•éŸ³é¢‘æ–‡ä»¶ã€‚å»ºè®®æå‰å¬ä¸€ä¸‹å£°éŸ³å’Œæµ‹è¯•ä¸€ä¸‹è½¯ä»¶ã€‚\n\n\n\næç¤ºï¼š\n\nsdrè½¯ä»¶æ¥æ”¶ç«¯å¯ä»¥ä½¿ç”¨ NFM æ¨¡å¼ å¸¦å®½12kHz\n\nSDRuno Ex control ä¸­çš„ AFC åŠŸèƒ½å¯ä»¥å®ç°é¢‘ç‡è¿½è¸ªï¼Œ æ³¨æ„è¦åœ¨å‡ºç°é¢‘è°±å¹¶ä¸”é€‰ä¸­é¢‘ç‡åå†å¼€å¯ï¼Œå¼€æ—©äº†ä¼šè·‘åã€‚\n\nSDRuno mem panel å¯ä»¥é¢„å…ˆå­˜å‚¨é¢‘ç‡å’Œæ¨¡å¼ã€‚å®ç°å¿«é€Ÿåˆ‡æ¢ã€‚\n\næ¥æ”¶æ—¶å¯å…ˆå°†è§£æå‡ºçš„å£°éŸ³å­˜å‚¨ä¸ºéŸ³é¢‘æ–‡ä»¶ï¼Œé˜²æ­¢å› ä¸ºSSTVè§£ç è½¯ä»¶è®¾ç½®é”™è¯¯è€Œé”™å¤±è‰¯æœºã€‚\n\n\n\nARISS ï¼ˆå›½é™…ç©ºé—´ç«™ï¼‰2024å¹´å…¶ä¸­ä¸€æ¬¡æ´»åŠ¨å…¬å¸ƒçš„æ¥æ”¶å‚æ•°ï¼š \n\n145.8MHz FM\n\nPD120 mode 2minutes on, 2minutes off\n\nè€Œ2025å¹´åˆä½¿ç”¨ 437.550MHzï¼Œç›¸æ¯”145.8MHzé¢‘ç‡é«˜äº†ï¼Œå¤šæ™®å‹’é¢‘ç§»å½±å“ä¹Ÿå°±æ›´å¤§äº†ã€‚\n\n### ç¡¬ä»¶å‡†å¤‡\n\nsdrè¿æ¥å¤©çº¿å’Œç”µè„‘\n\næ³¨æ„ï¼šç¬”è®°æœ¬æœ€å¥½ä½¿ç”¨å†…éƒ¨ç”µæ± ä¾›ç”µï¼Œéƒ¨åˆ†ç¬¬ä¸‰æ–¹ç”µæºä¸åˆæ ¼ä¼šå½±å“å°„é¢‘ä¿¡å·\n\n\n\n## æ–¹å¼ä¸€ï¼šSDRangel è®°å½•IQæ•°æ® + åæœŸè§£æ\n\n### å½•åˆ¶\n\n1. æ‰“å¼€è½¯ä»¶ï¼Œå…³é—­Workspacesä¸­ä¹‹å‰çš„å†…å®¹ã€‚\n\n2. Add Rx deviceï¼Œé€‰æ‹©è‡ªå·±çš„ SDR è®¾å¤‡ã€‚![image-20250216142208905](image-20250216142208905.png)\n\n3. Add Channels é€‰æ‹©å¢åŠ  File Sinkã€‚\n\n   ![image-20250216142347574](image-20250216142347574.png)\n\n4. ç‚¹å‡» File Sink çª—å£ä¸­çš„**æ‰“å¼€æ–‡ä»¶å›¾æ ‡**ï¼Œè®¾ç½®æ–‡ä»¶å­˜å‚¨ä½ç½®å’Œæ–‡ä»¶åï¼Œè½¯ä»¶ä¼šåœ¨æ–‡ä»¶ååé¢è¡¥å……æ—¥æœŸå’Œæ—¶é—´ç­‰ä¿¡æ¯ã€‚\n\n   ![image-20250216142538221](image-20250216142538221.png)\n\n5. ç‚¹å‡» SDR æ§åˆ¶çª—å£ï¼ˆä¾‹å¦‚æ­¤å¤„çš„SDRPlayV3 ï¼‰çš„**å¼€å§‹æŒ‰é’®**ï¼ŒSDR å¼€å§‹é‡‡é›†æ•°æ®ï¼Œé¢‘è°±å›¾ä¹Ÿå¼€å§‹åˆ·æ–°ã€‚\n\n6. ç‚¹å‡»File Sink çª—å£çš„**å½•åˆ¶å›¾æ ‡**å¼€å§‹å­˜å‚¨é‡‡é›†æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°å½•åˆ¶æ—¶é•¿å’Œæ–‡ä»¶å¤§å°ã€‚\n\n   ![image-20250216143018011](image-20250216143018011.png)\n\n7. Add Channels å¢åŠ  FM è§£ç åŠŸèƒ½ï¼Œæ–¹ä¾¿ç›‘å¬ä¿¡å·çŠ¶æ€ã€‚æ³¨æ„ï¼šéœ€è¦å°†Sqæ‹‰åˆ°æœ€ä½ï¼Œè¿™æ ·å°±ä¸ä¼šé”™è¿‡è¾ƒå¼±ä¿¡å·ã€‚\n\n   ![image-20250216203958452](image-20250216203958452.png)\n\n   ![image-20250216204220860](image-20250216204220860.png)\n\n   8. æ‰“å¼€Black Cat SSTV æˆ–è€… RX-SSTV è½¯ä»¶ï¼Œç”¨äºå°†éŸ³é¢‘è§£ç ä¸ºå›¾ç‰‡ã€‚\n   9. å«æ˜Ÿè¿‡å¢ƒï¼Œåœæ­¢å½•åˆ¶æ–‡ä»¶ï¼Œå…³é—­SDRè½¯ä»¶ã€‚å¦‚æœ SSTV è½¯ä»¶æ¥æ”¶æ­£ç¡®ï¼Œè¯·ç¨ç­‰ï¼Œåº”ä¸ºéƒ¨åˆ†è½¯ä»¶ä¼šé‡æ–°åŒæ­¥å’Œå­˜å‚¨å›¾ç‰‡ã€‚\n\n   å¦‚æœå¯¹åœ¨æ¥æ”¶è¿‡ç¨‹ä¸­å‡ºç°è¯¯æ“ä½œï¼ˆä¾‹å¦‚ SSTVè½¯ä»¶æ²¡è®¾ç½®æ­£ç¡®ï¼Œæˆ–è€…è§£ç é¢‘ç‡æœ‰åå·®ï¼‰é€ æˆå›¾ç‰‡æ¥æ”¶ä¸å®Œæ•´ï¼Œå¯ç”¨ File Sink ä¸­å­˜å‚¨çš„æ–‡ä»¶é‡æ–°è§£ç ã€‚\n\n### è§£æ\n\nå¦‚æœåœ¨æ¥æ”¶è¿‡ç¨‹ä¸­å‡ºç°è¯¯æ“ä½œï¼Œå³å¯ä½¿ç”¨å½•åˆ¶çš„IQæ–‡ä»¶æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•é‡æ–°è¿›è¡Œè§£ç ã€‚\n\n1. Select sampling device é€‰æ‹©FileInput\n2. Add Chanels é€‰æ‹©Broadcast FM Demodulate æˆ– WFM Demodulator è§£ç å‡ºéŸ³é¢‘\n3. æ‰“å¼€Black Cat SSTV æˆ–è€… RX-SSTV è½¯ä»¶ï¼Œç”¨äºå°†éŸ³é¢‘è§£ç ä¸ºå›¾ç‰‡\n\n![image-20250216194500761](image-20250216194500761.png)\n\n\n\n4. æˆ‘çš„ç”µè„‘éº¦å…‹é£æ•ˆæœä¸å¥½ï¼Œç”¨çš„æ‰‹æœºappï¼š**Robot36**\n\n   ![20250412_190536](20250412_190536.png)\n\n\n\n## æ–¹å¼äºŒ ä½¿ç”¨ SDRuno\n\nå‚è€ƒæ•™ç¨‹ https://youtu.be/j7b2HGLwAmo?si=d76Qe5rAOLYQhTg8","tags":["HAM SSTV"]},{"title":"hexoå†™æ–‡æ¡£æµç¨‹","url":"/2025/02/22/hexoå†™æ–‡æ¡£æµç¨‹/","content":"\nè¿œç¨‹masteråˆ†æ”¯å­˜å‚¨hexoå¤„ç†åçš„æ–‡ä»¶ï¼Œç”¨äºè®©github-pagesæ˜¾ç¤ºç½‘é¡µã€‚\n\nåˆ†æ”¯hexoç”¨æ¥å­˜å‚¨åŸå§‹æ–‡æ¡£\n\n\n\n## Hexo\n\næ–°å»ºæ–‡æ¡£ï¼š\n\n```bash\nhexo new xxx\n```\n\næœ¬åœ°æœåŠ¡å™¨é¢„è§ˆï¼š\n\n```bash\nhexo s\n```\n\nå¦‚æœ hexo å®‰è£…åœ¨è¿œç¨‹æœåŠ¡å™¨éœ€ä½¿ç”¨ ip:4000 è®¿é—®\n\néƒ¨ç½²åˆ°github\n\n```bash\nhexo d\n```\n\næ¸…é™¤æœ¬åœ°ç¼“å­˜ï¼š\n\n```bash\nhexo clean\n```\n\n\n\n## æ¨é€æºæ–‡æ¡£\n\n```bash\ngit add .\ngit commit -m \"xxx\"\ngit push origin hexo\n```\n\n","tags":["hexo"]},{"title":"ç”µé‡è¡¨PZEM-004T-V30å¢åŠ LCD1602æ˜¾ç¤ºå±","url":"/2025/02/22/ç”µé‡è¡¨PZEM-004T-V30å¢åŠ LCD1602æ˜¾ç¤ºå±/","content":"\n## ç¡¬ä»¶\n\nESP32S2\n\nPZEM-004T-V3.0\n\nLCD1602 I2Cç‰ˆ\n\n\n\n## å›ºä»¶\n\nå‚è€ƒé“¾æ¥ï¼šhttps://tasmota.github.io/docs/PZEM-0XX/#pzem-004\n\næ•´ä¸ªæµç¨‹å‚è€ƒé“¾æ¥ä¸­å·²ç»è¯´çš„å¾ˆè¯¦ç»†äº†ã€‚ä¸‹é¢æˆ‘ä»…å¯¹è‡ªå·±æ“ä½œè¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜åšä¸€ä¸‹è®°å½•ã€‚\n\n\n\næˆ‘ä½¿ç”¨çš„ PZEM-004T-V3.0 ï¼ˆå’Œ PZEM-004T-V1.0æœ‰ä¸€äº›åŒºåˆ«ï¼Œæ¯”å¦‚é€šè®¯åè®®ä¸é€šç”¨ï¼‰ã€‚å®˜æ–¹å›ºä»¶æ”¯æŒ004Tï¼Œä¸è¿‡æˆ‘å°†æ¥æ”¶å¼•è„šé…ç½®ä¸º PZEM016 Rx å°±èƒ½è¯»å–åˆ° 004T-V3.0 ç‰ˆæœ¬äº†ã€‚\n\n\n\nç”µé‡æ¨¡å—ä¸€ä¸‹å°±æ”¯æŒäº†ï¼Œéº»çƒ¦çš„æ˜¯LCD1602ï¼Œå›ºä»¶ä¸æ”¯æŒéœ€è¦è‡ªå·±ç¼–è¯‘ã€‚æµç¨‹å¦‚ä¸‹ï¼š\n\n1. å®‰è£… VSCodeï¼Œé…ç½®ä»£ç†å‚è€ƒhttps://www.aahgo.com/post/328.html ä¸ç„¶åç»­æ“ä½œæœ‰ç‚¹æ…¢ã€‚æˆ‘åªåšäº†å‰åŠéƒ¨åˆ†\n\n2. å®‰è£… PlatformIO æ’ä»¶\n\n3. ä¸‹è½½ [Tasmota]( https://github.com/arendst/Tasmota/tree/master) Releasesç‰ˆçš„æºä»£ç  Source code(zip) ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨é€šè¿‡gitæŒ‡ä»¤æ‹‰ä¸‹æ¥ã€‚å†ä½¿ç”¨ VSCode æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹\n\n4. åœ¨ Tasmota å­æ–‡ä»¶å¤¹ä¸­æ–°å»º***user_config_override.h***æ–‡ä»¶ï¼Œå°† [é“¾æ¥](https://pastebin.com/WkfyKYnh) ä¸­çš„æ–‡ä»¶å†…å®¹æ‹·è´è¿›å»ã€‚ `Tasmota-xx.x.x\\tasmota\\user_config_override.h` \n\n5. å°† `platformio_override_sample.ini `é‡å‘½åä¸º `platformio_override.ini` å°† default_envs = å®ä¿®æ”¹ä¸ºè‡ªå·±çš„èŠ¯ç‰‡ã€‚\n\n6. ç‚¹å‡»çŠ¶æ€æ  `Switch PlatformIO Project Environment` ä¿®æ”¹ä¸ºè‡ªå·±çš„èŠ¯ç‰‡(æˆ‘çš„æ˜¯esp32s2)ï¼Œå†ç‚¹å‡»Buildï¼ŒUploadã€‚\n\n   ![image-20250222153333839](image-20250222153333839.png)\n\n7. ä½¿èŠ¯ç‰‡è¿›å…¥ä¸‹è½½æ¨¡å¼ã€‚ï¼ˆESP32 éœ€è¦ æŒ‰ä¸‹IO0  æŒ‰ä¸‹EN æŠ¬èµ·EN æŠ¬èµ·IO0ï¼‰\n\n8. å›ºä»¶ä¸‹è½½å®Œæˆ\n\n\n\n## é…ç½®\n\n1. æ¥å…¥èŠ¯ç‰‡APçƒ­ç‚¹ï¼Œæ‰“å¼€æµè§ˆå™¨ `192.168.4.1`ï¼Œæ¥å…¥è·¯ç”±å™¨ï¼Œè®°ä½æˆåŠŸæ˜¾ç¤ºçš„IPã€‚\n2. æµè§ˆå™¨æ‰“å¼€è¿”å›çš„ IPï¼Œè¿›å…¥é…ç½®é¡µé¢æ ¹æ®ç¡¬ä»¶æ¥çº¿é…ç½® I2C å’Œ PTEM çš„å¼•è„š![image-20250222154531643](image-20250222154531643.png)\n   ![image-20250222154635208](image-20250222154635208.png)\n3. æµè§ˆå™¨æ‰“å¼€ Console è¾“å…¥ä¸‹é¢çš„æŒ‡ä»¤ï¼š\n  4. `I2CScan` æŸ¥çœ‹è¿”å›å€¼\n  5. `DeviceAddress XXX` è®¾ç½®LCD1602çš„åœ°å€ã€‚å¦‚ `DeviceAddress 27`\n  6. `TelePeriod 10` è®¾ç½®æ˜¾ç¤ºåˆ·æ–°çš„æ—¶é—´é—´éš”ã€‚æœ€å°10s\n  7. `DisplayModel 1` å’Œ `DisplayModel 0`\n  8. æ–°å¢ä¸€æ¡Ruleï¼š `Rule1 ON Tele-ENERGY#Power DO DisplayText [z] [x1y0]%value%W ENDON ON Tele-ENERGY#Today DO DisplayText [x8y0]%value%Wh ENDON ON Tele-ENERGY#Voltage DO DisplayText [x1y1]%value%V ENDON ON Tele-ENERGY#Current DO DisplayText [x8y1]%value%A ENDON`\n  9. å¯ç”¨ `Rule1 1`\n10. æ­¤æ—¶LCDå±å› è¯¥æœ‰æ˜¾ç¤ºäº†ï¼Œå¹³ä¸”æ•°æ®å·²10ç§’é—´éš”å¼€å§‹æ›´æ–°ã€‚å¦‚æœå±å¹•æ²¡æœ‰æ˜¾ç¤ºï¼Œç¬¬ä¸€ä»”ç»†çœ‹ï¼Œç¬¬äºŒæ—‹è½¬ç”µä½å™¨è°ƒé«˜å¯¹æ¯”åº¦ï¼ˆå¯ä»¥å…ˆè°ƒæ•´å°†é»‘æ¡†éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œæœ‰å­—ç¬¦æ˜¾ç¤ºåå†è°ƒå›å»ï¼‰\n11. WEBç•Œé¢ä¼šå‡ºç°ä¸€ä¸ªæŒ‰é’®ï¼Œç”¨äºå¼€å…³LCDèƒŒå…‰\n12. è®¾ç½®mqttåœ°å€ï¼ŒHome Assistant ä¼šè‡ªåŠ¨å¢åŠ å’Œæ˜¾ç¤ºç›¸å…³æ•°æ®ã€‚\n\n\n\n![image-20250222161131089](image-20250222161131089.png)\n\n![image-20250222161153176](image-20250222161153176.png)","tags":["SmartHome"]},{"title":"PZEM-004T-V30ç”µé‡è¡¨ä½¿ç”¨è¯´æ˜","url":"/2025/02/22/PZEM-004T-V30ç”µé‡è¡¨ä½¿ç”¨è¯´æ˜/","content":"\n## ç¡¬ä»¶\n\nESP32-S2-MINI-1 https://www.studiopieters.nl/esp32-s2-pinout/\n\n![ESP32-S2 - Pinout](ESP32-S2-Mini_Internal.png)\n\n\n\nIO15: DS18B20\n\nIO17: ESP32 U1TXD       PZEM-004T Rx\n\nIO18: ESP32 U1RXD       PZEM-004T Tx\n\n## é…ç½®\n\n![image-20250219230826411](image-20250219230826411.png)\n\n![image-20250221230123523](image-20250221230123523.png)\n\n\n\n## ç»“æœ\n\n![image-20250219230759645](image-20250219230759645.png)","tags":["SmartHome"]},{"title":"æ™ºèƒ½æ’åº§SE-341Aåˆ·æœºè¯´æ˜","url":"/2025/02/22/æ™ºèƒ½æ’åº§SE-341Aåˆ·æœºè¯´æ˜/","content":"\næ‹†æœº+æ¨¡å—è¯´æ˜\n\nå‚è€ƒé“¾æ¥ https://templates.blakadder.com/lenovo_ZG38C03025.html\n\n## æ‹†æœº\n\n![Insides](lenovo_ZG38C03025_2.webp)\n\n\n\nç„Šæ¥åˆ·æœºçº¿\n\n![TYWE3S](TYWE3S.png)\n\n## tasmota åˆ·æœº\n\nåœ¨çº¿åˆ·æœºé“¾æ¥ https://tasmota.github.io/install/\n\nå»ºè®®æ¸…é™¤åŸæ¥çš„å›ºä»¶\n\n\n\n## tasmota é…ç½®\n\nå‚è€ƒé“¾æ¥ https://post.smzdm.com/p/a6pgp2ko/\n\n![ä¸­å›½ç§»åŠ¨å’Œå®¶äº²MC010æ™ºèƒ½æ’åº§åˆ·tasmotaæ¥å…¥HA](65eca4ecb06b37997.jpg)","tags":["SmartHome"]},{"title":"ISSå›½é™…ç©ºé—´ç«™SSTVä¸»é¢˜æ´»åŠ¨2024å¹´11æœˆ","url":"/2024/11/16/ISSå›½é™…ç©ºé—´ç«™SSTVä¸»é¢˜æ´»åŠ¨2024å¹´11æœˆ/","content":"\n## è½¯ç¡¬ä»¶\n\n* è‡ªåˆ¶å››è‡‚èºæ—‹å¤©çº¿\n* mirisdr\n* SDRuno\n* Black Cat SSTV\n\n## 2024å¹´11æœˆ14æ—¥\n\n![20211114-1](20241114-121008-PD120.jpg)\n\n## 2024å¹´11æœˆ16æ—¥\n\n![20241116-1](20241116-103359-PD120.jpg)\n\n![20241116-2](20241116-103605-PD120.jpg)\n","tags":["HAM SSTV"]},{"title":"PyBind11åº”ç”¨","url":"/2024/11/01/PyBind11åº”ç”¨/","content":"\n## é—®é¢˜\n\nç½‘ä¸Šæ€å²šæ¿€å…‰é›·è¾¾çš„åº”ç”¨æ•™ç¨‹ä¸€ä¸Šæ¥å°±æ˜¯åŸºäºROS2ç³»ç»Ÿçš„ã€‚è¿™ç§æ–¹æ³•å¯ä»¥é€šè¿‡GUIæ–¹å¼æŸ¥çœ‹æµ‹è¯•æ•°æ®ï¼Œç›´è§‚åˆå¼ºå¤§ã€‚\n\nä½†æ˜¯å¦‚æœæƒ³ç¯å¢ƒå’Œä¾èµ–ç®€å•ä¸€ç‚¹ï¼Œç¡¬ä»¶èµ„æºå ç”¨å°‘ä¸€ç‚¹ï¼Œå¯ä»¥ç”¨æ€å²šæä¾›çš„SDKã€‚[SDK](https://github.com/slamtec/rplidar_sdk)æ˜¯ä»¥æŒC++æºä»£ç çš„æ–¹å¼æä¾›çš„ï¼Œè‡ªå¸¦ä¾‹ç¨‹ã€‚\n\né¡¹ç›®éœ€è¦pythonè¯»å–çš„é›·è¾¾æ•°æ®ã€‚ä¸€å¼€å§‹æ˜¯ç”±dockerä¸­çš„ROS2ä½œä¸ºæ•°æ®å¤„ç†å’Œé€šè®¯çš„ä¸­è½¬ç«™ã€‚ä½†å‘ç°å ç”¨èµ„æºå¤šï¼Œæ“ä½œæœ‰ç‚¹å¤æ‚ã€‚\n\nè½¬è€Œè€ƒè™‘pythonç›´æ¥è°ƒç”¨sdk, ç”±äºå¤´æ–‡ä»¶éå¸¸å¤šctypesæ–¹å¼æ²¡æ€ä¹ˆå°è¯•å°±æ”¾å¼ƒäº†ã€‚ä¸­é€”ç”¨qt6è°ƒsdkç„¶åé€šè¿‡UDPä¼ ç»™pythonï¼Œè™½ç„¶æ•°æ®é€šäº†ï¼Œä½†éƒ¨ç½²å¾—äº¤å‰ç¼–è¯‘è¿˜å¾—ä¾èµ–qt6. æ€§èƒ½ä¹Ÿæœ‰æŸå¤±ã€‚\n\næœ€åå°±ç”¨åˆ°ä¸»è§’ pybind11 (blogä¸­æœç´¢ **PyBind11ç®€æ˜æ•™ç¨‹**) å’Œ [å¤–è§‚è®¾è®¡æ¨¡å¼](https://en.wikipedia.org/wiki/Facade_pattern) *å®ç° python è°ƒç”¨ cpp çš„ sdk*\n\n## å·¥ç¨‹ç›®å½•\n\n```bash\nâ”œâ”€â”€ build\nâ”œâ”€â”€ CMakeLists.txt\nâ”œâ”€â”€ main.cpp\nâ”œâ”€â”€ mylib.h\nâ”œâ”€â”€ pywrap.cpp\nâ”œâ”€â”€ readme.md\nâ”œâ”€â”€ sdk\nâ”‚Â Â  â”œâ”€â”€ CMakeLists.txt\nâ”‚Â Â  â”œâ”€â”€ include\nâ”‚Â Â  â””â”€â”€ src\nâ””â”€â”€ test.py\n```\n\n## å°è£…SDK\n\nå¤–è§‚è®¾è®¡æ¨¡å¼ç®€å•æ¥è¯´å°±æ˜¯æŠŠé›¶æ•£å¤æ‚çš„SDKæ ¹æ®ä½¿ç”¨æµç¨‹åšä¸€ä¸ªæŠ½è±¡å’Œå°è£…ã€‚\n\nè®©åˆ«äººè°ƒç”¨çš„æ—¶å€™ä¸å†å…³æ³¨æµç¨‹å’Œæ“ä½œä¸Šçš„æŠ€æœ¯ç»†èŠ‚ã€‚\n\næ¯”å¦‚æ­¤å¤„çš„mylib.h (å¦‚æœå°†ç±»çš„å®ç°åˆ†å¼€å†™é“å•ç‹¬çš„å¦‚mylib.cppæ–‡ä»¶ä¸­ï¼Œpythonè°ƒç”¨çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œå¥½åƒæ˜¯CPPç¼–è¯‘å™¨ç»™å‡½æ•°åå¢åŠ äº†ä¸€äº›ä¿¡æ¯ã€‚)\n\næ³¨æ„ï¼š\n* æœ¬é¡¹ç›®ä»…ç”¨çš„ä¸²å£ï¼Œç½‘ç»œé€šè®¯æ–¹å¼å·²è¢«çœç•¥ï¼Œå¦‚æœ‰éœ€è¦è¯·å‚è€ƒSDKä¾‹ç¨‹\n* ç”±äºudevå·²ç»å°†é›·è¾¾ä¸²å£æ˜ å°„ä¸º \"/dev/rplidar\" æ³¢ç‰¹ç‡100000 è¯·è‡ªè¡Œä¿®æ”¹ã€‚\n\n```hpp\n#ifndef __MY_RADAR\n#define __MY_RADAR\n\n#include <iostream>\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <string.h>\n\n#include <vector>\n#include <pybind11/pybind11.h>\n#include <pybind11/stl.h> // åŒ…å« STL æ”¯æŒ\nnamespace py = pybind11;\n\n#include \"sl_lidar.h\"\n#include \"sl_lidar_driver.h\"\n#ifndef _countof\n#define _countof(_Array) (int)(sizeof(_Array) / sizeof(_Array[0]))\n#endif\n\n#ifdef _WIN32\n#include <Windows.h>\n#define delay(x)   ::Sleep(x)\n#else\n#include <unistd.h>\nstatic inline void delay(sl_word_size_t ms) {\n    while (ms >= 1000) {\n        usleep(1000 * 1000);\n        ms -= 1000;\n    };\n    if (ms != 0)\n        usleep(ms * 1000);\n}\n#endif\n\nusing namespace sl;\n\n\nclass MyClass {\n\npublic:    \n    MyClass(int com)\n    {\n        IChannel* _channel;\n        sl_result     op_result;\n\n        std::cout << \"init\" << std::endl;\n\n        drv = *createLidarDriver();\n        if (!drv) {\n            fprintf(stderr, \"insufficent memory, exit\\n\");\n            exit(-2);\n        }\n        sl_lidar_response_device_info_t devinfo;\n        bool connectSuccess = false;\n\n        _channel = (*createSerialPortChannel(\"/dev/rplidar\", 1000000));\n        if (SL_IS_OK((drv)->connect(_channel))) {\n            op_result = drv->getDeviceInfo(devinfo);\n\n            if (SL_IS_OK(op_result))\n            {\n                connectSuccess = true;\n            }\n            else {\n                delete drv;\n                drv = NULL;\n            }\n        }\n\n        if (!connectSuccess) {\n            fprintf(stderr, \"Error, cannot bind to the specified serial port.\\n\");\n\n            goto on_finished;\n        }\n\n        printf(\"SLAMTEC LIDAR S/N: \");\n        for (int pos = 0; pos < 16; ++pos) {\n            printf(\"%02X\", devinfo.serialnum[pos]);\n        }\n\n        printf(\"\\n\"\n            \"Firmware Ver: %d.%02d\\n\"\n            \"Hardware Rev: %d\\n\"\n            , devinfo.firmware_version >> 8\n            , devinfo.firmware_version & 0xFF\n            , (int)devinfo.hardware_version);\n\n        // check health...\n        if (!checkSLAMTECLIDARHealth(drv)) {\n            goto on_finished;\n        }\n\n        drv->setMotorSpeed();\n        drv->startScan(0, 1);\n\n    on_finished:\n        return;\n    };\n\n    ~MyClass() {\n        std::cout << \"uninit\" << std::endl;\n        drv->stop();\n        delay(200);\n        if (drv) {\n            drv->setMotorSpeed(0);\n            delete drv;\n            drv = NULL;\n        }\n    };\n\n    void run(void) {\n        std::cout << \"run\" << std::endl;\n        if (drv) {\n            sl_lidar_response_measurement_node_hq_t nodes[8192];\n            size_t   count = _countof(nodes);\n\n            sl_result op_result = drv->grabScanDataHq(nodes, count);\n\n            if (SL_IS_OK(op_result)) {\n                drv->ascendScanData(nodes, count);\n                if (data_angle.size() != count)\n                {\n                    data_angle.resize(count);\n                    data_dist.resize(count);\n                    data_quality.resize(count);\n                }\n\n                for (int pos = 0; pos < (int)count; ++pos) {\n                    // printf(\"%s theta: %03.2f Dist: %08.2f Q: %d \\n\",\n                    //     (nodes[pos].flag & SL_LIDAR_RESP_HQ_FLAG_SYNCBIT) ? \"S \" : \"  \",\n                    //     (nodes[pos].angle_z_q14 * 90.f) / 16384.f,\n                    //     nodes[pos].dist_mm_q2 / 4.0f,\n                    //     nodes[pos].quality >> SL_LIDAR_RESP_MEASUREMENT_QUALITY_SHIFT);\n                    data_angle.at(pos) = (nodes[pos].angle_z_q14 * 90.f) / 16384.f;\n                    data_dist.at(pos) = nodes[pos].dist_mm_q2 / 4.0f;\n                    data_quality.at(pos) = nodes[pos].quality >> SL_LIDAR_RESP_MEASUREMENT_QUALITY_SHIFT;\n                }\n            }\n        }\n    };\n\n    const std::vector<double>& get_angle() const { return data_angle;}\n    const std::vector<double>& get_dist() const { return data_dist;}\n    const std::vector<int>& get_quality() const { return data_quality;}\n\nprivate:\n    std::vector<double> data_angle;\n    std::vector<double> data_dist;\n    std::vector<int>    data_quality;\n\n    ILidarDriver* drv;\n\n    bool checkSLAMTECLIDARHealth(ILidarDriver* drv)\n    {\n        sl_result     op_result;\n        sl_lidar_response_device_health_t healthinfo;\n\n        op_result = drv->getHealth(healthinfo);\n        if (SL_IS_OK(op_result)) { // the macro IS_OK is the preperred way to judge whether the operation is succeed.\n            printf(\"SLAMTEC Lidar health status : %d\\n\", healthinfo.status);\n            if (healthinfo.status == SL_LIDAR_STATUS_ERROR) {\n                fprintf(stderr, \"Error, slamtec lidar internal error detected. Please reboot the device to retry.\\n\");\n                // enable the following code if you want slamtec lidar to be reboot by software\n                // drv->reset();\n                return false;\n            }\n            else {\n                return true;\n            }\n\n        }\n        else {\n            fprintf(stderr, \"Error, cannot retrieve the lidar health code: %x\\n\", op_result);\n            return false;\n        }\n    }\n};\n\n\n#endif\n```\n\nè™½ç„¶å†…å®¹å¾ˆå¤šï¼Œä½†å¯¹äº python ä¸Šå±‚è°ƒç”¨æ–¹æ¥è®²ã€‚å°±åªæœ‰\n\n* æ„é€ å‡½æ•°ï¼šé›·è¾¾åˆå§‹åŒ–ï¼Œå®Œæˆå‡†å¤‡å·¥ä½œ\n* runå‡½æ•°ï¼šä¸²å£å°†é›·è¾¾æ•°æ®ä¿å­˜åˆ°ç§æœ‰å˜é‡\n* get_angle/get_dist/data_qualityç­‰æ•°æ®ä¼ é€’å‡½æ•°ï¼šä»ç§æœ‰å˜é‡å°†æ•°æ®ä¼ é€’ç»™python\n* ææ„å‡½æ•°ï¼šå…³é—­é›·è¾¾é‡Šæ”¾èµ„æº\n\nè¿™ä¹Ÿæ˜¯ä¸Šé¢æåˆ°çš„ **å¤–è§‚è®¾è®¡æ¨¡å¼**\n\n## åˆ›å»º python åŒ…è£…å™¨æ‰€éœ€çš„å†…å®¹\n\nç…§çŒ«ç”»è™å®ç°çš„ pywrap.cpp æ–‡ä»¶\n\n```cpp\n#include <pybind11/pybind11.h>\n#include \"mylib.h\"\n\nnamespace py = pybind11;\nconstexpr auto byref = py::return_value_policy::reference_internal;\n\nPYBIND11_MODULE(MyLib, m) {\n    m.doc() = \"optional module docstring\";\n\n    py::class_<MyClass>(m, \"MyClass\")\n    .def(py::init<int>())\n    .def(\"run\", &MyClass::run, py::call_guard<py::gil_scoped_release>())\n    .def(\"get_angle\", &MyClass::get_angle)\n    .def(\"get_dist\", &MyClass::get_dist)\n    .def(\"get_quality\", &MyClass::get_quality)\n    ;\n}\n```\n\n## å‰æœŸè°ƒè¯•\n\næ­¤æ–‡ä»¶ä»…ç”¨äºå‰æœŸéªŒè¯åº“æ–‡ä»¶åŠŸèƒ½æ˜¯å¦æ­£å¸¸\n\nmain.cpp\n\n```cpp\n#include <stdio.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <string.h>\n\n#include \"sl_lidar.h\" \n#include \"sl_lidar_driver.h\"\n\n#include \"mylib.h\"\n\n\nint main(int argc, const char* argv[]) {\n    MyClass radar(1);\n    radar.run();\n    return 0;\n}\n```\n\n## ç¼–è¯‘ç”Ÿæˆåº“æ–‡ä»¶\n\nå®‰è£… pybind11ã€‚å®‰è£…æ–¹å¼é™¤äº†ä¸‹é¢ï¼Œè¿˜æœ‰ pip å’Œ conda ç­‰\n\n```bash\nsudo apt install pybind11-dev\n```\n\nå°† sdk å’Œ pybing11 æ•™ç¨‹ä¸­çš„ cmake æ–‡ä»¶ç»“åˆåˆ°ä¸€èµ·ï¼ˆæ³¨æ„pybind11_DIR æ–‡ä»¶ç›®å½•æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µä¿®æ”¹ï¼‰\n\n```cmake\ncmake_minimum_required(VERSION 3.10)\n\nproject(MyLib)\n\nset(CMAKE_CXX_STANDARD 11)\nset(PYBIND11_PYTHON_VERSION 3.6)\nset(CMAKE_CXX_FLAGS \"-Wall -Wextra -fPIC\")\n\nset(pybind11_DIR \"/usr/local/lib/python3.6/dist-packages/pybind11/share/cmake/pybind11\")\nfind_package(pybind11 REQUIRED)\nfind_package(Threads REQUIRED)\n\n# é™æ€åº“ç”Ÿæˆçš„è·¯å¾„\nset(LIB_PATH ${CMAKE_CURRENT_SOURCE_DIR}/lib)\n# ç¬¬ä¸‰æ–¹åº“å¤´æ–‡ä»¶è·¯å¾„\nlist(APPEND HEAD_PATH ${CMAKE_CURRENT_SOURCE_DIR}/sdk/include)\nlist(APPEND HEAD_PATH ${CMAKE_CURRENT_SOURCE_DIR}/sdk/src)\n# é™æ€åº“çš„åå­—\nset(RADRA_LIB \"rplidar_driver\")\n\n# æ·»åŠ å­ç›®å½•\nadd_subdirectory(sdk)\n\ninclude_directories(${HEAD_PATH})\n\nlink_directories(${LIB_PATH})\n# link_libraries(${RPLIDAR_LIB})\n\npybind11_add_module(${PROJECT_NAME} pywrap.cpp)\n\n# exe å‰æœŸç¼–å†™main.cppè°ƒåº“è°ƒè¯•åŠŸèƒ½ï¼Œåé¢ç”Ÿæˆåº“ä¾›pythonè°ƒç”¨ï¼ˆexe å’Œ so ä¸èƒ½åŒæ—¶å¯ç”¨ï¼‰\n# file(GLOB SRC_LIST ${CMAKE_CURRENT_SOURCE_DIR}/*.cpp)\n# add_executable(app ${SRC_LIST})\n# target_link_libraries(app ${RADRA_LIB} Threads::Threads)\n\n# so\ntarget_compile_definitions(${PROJECT_NAME} PRIVATE VERSION_INFO=${EXAMPLE_VERSION_INFO})\ntarget_include_directories(${PROJECT_NAME} PRIVATE ${PYBIND11_INCLUDE_DIRS})\ntarget_link_libraries(${PROJECT_NAME} PRIVATE ${RADRA_LIB} Threads::Threads)\n```\n\nç¼–è¯‘åº“\n\n```bash\nmkdir build\ncd build\ncmake ..\nmake\n```\n\né¡ºåˆ©çš„è¯ä¼šç”Ÿæˆç±»ä¼¼ `MyLib.cpython-36m-aarch64-linux-gnu.so` æ–‡ä»¶\n\n## python è°ƒç”¨\n\ntest.py\n```python\nimport sys\nimport numpy as np\nsys.path.append(\"build/\")\nfrom MyLib import MyClass\n\nradar = MyClass(1)\n\nwhile True:\n    radar.run()\n    l_angle = radar.get_angle()\n    l_dist = radar.get_dist()\n    l_quality = radar.get_quality()\n    print(l_angle)\n```\n\næµ‹è¯•\n\n```bash\npython3 test.py\n```\nå¯ä»¥æŒ‰ `Ctrl+C` åœæ­¢","tags":["Python C/C++"]},{"title":"OhMyZsh_powerlevel10kå¿«é€Ÿæ‰“é€ å¥½çœ‹å¥½ç”¨çš„Terminal","url":"/2024/10/26/OhMyZsh-powerlevel10kå¿«é€Ÿæ‰“é€ å¥½çœ‹å¥½ç”¨çš„Terminal/","content":"\n[åŸå¸–](https://holychung.medium.com/%E5%88%86%E4%BA%AB-oh-my-zsh-powerlevel10k-%E5%BF%AB%E9%80%9F%E6%89%93%E9%80%A0%E5%A5%BD%E7%9C%8B%E5%A5%BD%E7%94%A8%E7%9A%84-command-line-%E7%92%B0%E5%A2%83-f66846117921)\n\n## å‰æƒ…æè¦\n\næ­¤ç¯‡æ˜¯ä»¥ ubuntu 20.04 ä½œç‚ºç¯„ä¾‹ï¼ŒåŒæ™‚ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨ macã€windows WSL ç•¶ä¸­ï¼Œç¨å¾®æœƒæœ‰ä¸€é»ä¸åŒçš„è¨­å®šå¯ä»¥åƒè€ƒ [My_Terminal_Theme](https://github.com/Holychung/My_Terminal_Theme)\n\n![æœ€çµ‚æˆæœ](pic1.gif)\n\n## å®‰è£ã€è¨­å®šæ–¹å¼\n\nç¸½å…±æœ‰ä»¥ä¸‹æ­¥é©Ÿï¼š\n\n* å®‰è£ zsh\n* å®‰è£ oh-my-zsh\n* å®‰è£ zsh theme: powerlevel10k\n* å®‰è£ zsh å¥½ç”¨ plugins\n* å®‰è£ powerline font\n* ä¿®æ”¹ powerlevel10k è¨­å®š\n* ä¿®æ”¹ terminal çš„ color scheme\n* å›ºå®šæŒ‡ä»¤åˆ—åœ¨çµ‚ç«¯æ©Ÿåº•éƒ¨\n\né¦–å…ˆï¼Œå¦‚æœ ubuntu ç³»çµ±æ˜¯å‰›çŒå®Œï¼Œå»ºè­°åˆ©ç”¨ä¸‹é¢å…©æ­¥é©Ÿå…ˆæ›´æ–°ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯èˆŠç©å®¶ç›´æ¥è·³éé€™ä¸€æ­¥é©Ÿé€²å…¥ zsh åŸºæœ¬å®‰è£å³å¯ã€‚\n\n```bash\nsudo apt-get update\nsudo apt-get upgrade\n```\n\né †ä¾¿æŠŠä¸€äº›å¥—ä»¶è£ä¸€ä¸‹ã€‚\n\n```bash\nsudo apt install vim curl git\n```\n\n## å®‰è£ zsh\n\n```bash\nsudo apt install zsh\n```\n\nå¦‚æœè£å¥½äº†å¯ä»¥ç”¨é€™å€‹æŒ‡ä»¤æŸ¥çœ‹ã€‚\n\n```bash\ncat /etc/shells\n```\n\næ›´æ› login shellï¼Œè¦è¨˜å¾— logout æ‰æœƒç”Ÿæ•ˆã€‚\n\n```bash\nchsh -s $(which zsh)\n```\n\n## å®‰è£ oh-my-zsh\n\n[ohmyzsh github](https://github.com/ohmyzsh/ohmyzsh)\n\n```bash\nwget https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh\nsh install.sh\n```\n\n## å®‰è£ zsh theme: powerlevel10k\n\n[powerlevel10k github](https://github.com/romkatv/powerlevel10k?tab=readme-ov-file#meslo-nerd-font-patched-for-powerlevel10k)\n\nOh My Zsh å®‰è£ powerlevel10kã€‚\n\n```bash\ngit clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k\n```\n\nå®‰è£å¥½å¾Œè¦ä¿®æ”¹ zsh è¨­å®šæª” .zshrcï¼Œå…ˆæŠŠä¸»é¡Œæ›æˆå‰›å‰›å®‰è£çš„ powerlevel10k\n\n```vim\nZSH_THEME=\"powerlevel10k/powerlevel10k\"\n```\n\nç„¶å¾Œä¸‹é€™å€‹æŒ‡ä»¤ã€‚\n\n```bash\nsource ~/.zshrc\n```\n\nå¯ä»¥å»å° prompt åšåŸºæœ¬çš„è¨­å®šï¼ŒåŒ…å« prompt style ç­‰ã€‚\n\n```bash\np10k configure\n```\n\n## å®‰è£å­—å‹\n\nPowerlevel10k æ¨è–¦ä½¿ç”¨ Meslo Nerd Fontã€‚\n\n* [MesloLGS NF Regular.ttf](https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Regular.ttf)\n* [MesloLGS NF Bold.ttf](https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Bold.ttf)\n* [MesloLGS NF Italic.ttf](https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Italic.ttf)\n* [MesloLGS NF Bold Italic.ttf](https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Bold%20Italic.ttf)\n\nä¸‹è¼‰å¥½å¾Œï¼Œä¿®æ”¹ GNOME Terminal (the default Ubuntu terminal) æ­¥é©Ÿå¦‚ä¸‹ã€‚\n`Open Terminal` â†’ `Preferences` and click on the selected profile under Profiles. Check Custom font under `Text Appearance` and select `MesloLGS NF Regular`.\n\nå¦‚æœæ˜¯ xfce4 åŒå‡»å­—ä½“æ–‡ä»¶æ²¡æœ‰å®‰è£…é€‰é¡¹æ—¶ï¼Œéœ€å®‰è£…[font-manager](https://askmeaboutlinux.com/2023/10/04/how-to-add-fonts-on-the-xfce-desktop-in-linux/) \n\n```bash\nsudo apt-get install thunar-font-manager\nfont-manager\n```\n\n![Terminal Settings](TerminalSettings.jpg)\n\n## å®‰è£ zsh å¥½ç”¨ plugins\n\n* [zsh-completions](https://github.com/zsh-users/zsh-completions)\n* [zsh-autosuggestions](https://github.com/zsh-users/zsh-autosuggestions)\n* [zsh-syntax-highlighting](https://github.com/zsh-users/zsh-syntax-highlighting)\n\nè£å¥½å¾Œä¿®æ”¹ .zshrc æŠŠ plugins åŠ åˆ°è¨­å®šæª”ã€‚\n\n```vim\nplugins=(\ngit\nzsh-completions \nzsh-autosuggestions \nzsh-syntax-highlighting\n)\n```\n\nç«‹å³ç”Ÿæ•ˆã€‚\n\n```bash\nsource ~/.zshrc\n```\n\n## ä¿®æ”¹ powerlevel10k è¨­å®š\n\nè¨­å®šæª” `.p10k.zsh`ï¼Œä¿®æ”¹å®Œè¦ä¸‹ `source ~/.p10k.zsh`ã€‚\n\né€™é‚Šæˆ‘åªç°¡å–®ä»‹ç´¹å…©å€‹æˆ‘æœ‰ä¿®æ”¹çš„æ±è¥¿ï¼Œå…¶ä»–ä¹Ÿæ˜¯å·®ä¸å¤šæ”¹æ³•ï¼Œå¯ä»¥åƒè€ƒ [powerlevel10k](https://github.com/romkatv/powerlevel10k) æœ‰å¾ˆè©³ç´°çš„èªªæ˜ã€‚\n\nä¿®æ”¹ prompt è³‡æ–™å¤¾è·¯å¾‘å¦‚æœå¤ªé•·è¶…ééä¸€å€‹é•·åº¦ï¼Œä¸­é–“çš„è³‡æ–™å¤¾åç¨±æœƒè®Šæˆç¸®å¯«å¦‚ä¸‹åœ–ï¼Œé€™é‚Šæˆ‘æŠŠå®ƒæ”¹æˆå¤§æ–¼ 20 å€‹å­—ï¼Œä¸éå¯ä»¥è¦–è‡ªå·±è¢å¹•å¤§å°ä¿®æ”¹ã€‚\n\n`typeset -g POWERLEVEL9K_DIR_MAX_LENGTH=20`\n\nä¿®æ”¹ prompt ç•¶å‰ç›®éŒ„çš„é¡è‰²ï¼Œé€™é‚Šå¯ä»¥åƒè€ƒ directory-is-difficult-to-see-in-prompt-when-using-rainbow-style æœ‰å¾ˆè©³ç´°çš„èªªæ˜ï¼Œåº•ä¸‹æ˜¯æˆ‘è‡ªå·±æ›´æ”¹çš„ç‰ˆæœ¬é‚„è¦é…åˆä¿®æ”¹ terminal çš„ color schemeï¼Œä¹Ÿå¯ä»¥ä¾ç…§è‡ªå·±å–œå¥½ä¿®æ”¹ã€‚\n\n```\n# Current directory background color.\ntypeset -g POWERLEVEL9K_DIR_BACKGROUND=4\n# Default current directory foreground color.\ntypeset -g POWERLEVEL9K_DIR_FOREGROUND=0\n# If directory is too long, shorten some of its segments to the shortest possible unique\n# prefix. The shortened directory can be tab-completed to the original.\ntypeset -g POWERLEVEL9K_SHORTEN_STRATEGY=truncate_to_unique\n# Replace removed segment suffixes with this symbol.\ntypeset -g POWERLEVEL9K_SHORTEN_DELIMITER=\n# Color of the shortened directory segments.\ntypeset -g POWERLEVEL9K_DIR_SHORTENED_FOREGROUND=232\n# Color of the anchor directory segments. Anchor segments are never shortened. The first\n# segment is always an anchor.\ntypeset -g POWERLEVEL9K_DIR_ANCHOR_FOREGROUND=232\n# Display anchor directory segments in bold.\ntypeset -g POWERLEVEL9K_DIR_ANCHOR_BOLD=false\n```\n\n## ä¿®æ”¹ terminal çš„ color scheme\n\né€™é‚Šæä¾›æˆ‘è‡ªå·±æ”¹çš„é¡è‰²ï¼Œæœ‰åƒè€ƒ Windows Terminal Themes ç•¶ä¸­çš„ Brogrammerï¼Œé‚„æœ‰ Mac çš„ terminal é€²è¡Œä¿®æ”¹ã€‚\n\n```\n{\n  \"black\": \"#1f1f1f\",\n  \"red\": \"#f81118\",\n  \"green\": \"#85D29A\",\n  \"yellow\": \"#ecba0f\",\n  \"blue\": \"#5C97CF\",\n  \"purple\": \"#4e5ab7\",\n  \"cyan\": \"#1081d6\",\n  \"white\": \"#ffffff\",\n  \"brightBlack\": \"#d6dbe5\",\n  \"brightRed\": \"#de352e\",\n  \"brightGreen\": \"#1dd361\",\n  \"brightYellow\": \"#f3bd09\",\n  \"brightBlue\": \"#1081d6\",\n  \"brightPurple\": \"#5350b9\",\n  \"brightCyan\": \"#0f7ddb\",\n  \"brightWhite\": \"#ffffff\",\n\n  \"background\": \"#2D2D2D\",\n  \"foreground\": \"#d6dbe5\"\n}\n```\n\n## å›ºå®šæŒ‡ä»¤åˆ—åœ¨çµ‚ç«¯æ©Ÿåº•éƒ¨\n\nå¯ä»¥åœ¨ .zshrc ç•¶ä¸­åŠ å…¥é€™è¡Œï¼ŒæŠŠå‘½ä»¤åˆ—å›ºå®šåœ¨æœ€åº•ä¸‹ï¼Œè¦–ç·šå°±ä¸ç”¨ä¸€ç›´æ”¹å‹•ï¼Œæˆ‘è‡ªå·±æ˜¯å¾ˆå–œæ­¡é€™å€‹åŠŸèƒ½ï¼Œä¸éé€™å€‹æœ‰æ™‚å€™æœƒæœ‰ä¸€äº›æ™‚å€™é‚„æ˜¯æœƒè·‘æ‰ï¼Œe.g. ä¸‹ clear æŒ‡ä»¤çš„æ™‚å€™ï¼ŒæœŸå¾…æœ‰äººèƒ½æ‰¾åˆ°æ›´å¥½çš„æ–¹æ³•XD\n\n```\n# Fix prompt at the bottom of the terminal window\nprintf '\\n%.0s' {1..100}\n```\n\n## æœ€å¾Œ\n\nå¦‚æœæœ‰çœ‹åˆ°å“ªå€‹åœ°æ–¹å¯ä»¥ä¿®æ”¹çš„æˆ–æ˜¯æœ‰ä¸éŒ¯çš„å¥—ä»¶æ­¡è¿å‘Šè¨´æˆ‘ï¼Œä¸€èµ·æ‰“é€ ä¸€å€‹é«˜æ•ˆç‡çš„é–‹ç™¼ç’°å¢ƒã€‚\n\næ­¡è¿åƒè€ƒ [My_Terminal_Theme](https://github.com/Holychung/My_Terminal_Theme) ç•¶ä¸­çš„é…ç½®ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ° Macã€WSL çš„ç‰ˆæœ¬ï¼Œéƒ½æ˜¯å¯è¡Œçš„ã€‚\n\n[Mac è¨­å®š](https://github.com/Holychung/My_Terminal_Theme/tree/main/mac)\n\n[Windows WSL è¨­å®š](https://github.com/Holychung/My_Terminal_Theme/tree/main/WSL)\n\n[ä½œè€…Blog](https://holychung.github.io/)\n","tags":["linux"]},{"title":"neovimå’Œæ’ä»¶","url":"/2024/10/20/neovimå’Œæ’ä»¶/","content":"\n## å®‰è£…neovim\n\n[neovim-releases](https://github.com/neovim/neovim-releases/releases)ä¸‹è½½å®‰è£…åŒ…\n\n```bash\nsudo dpkg -i  nvim-linux64.deb\n```\n\n## æ–°å»ºé…ç½®æ–‡ä»¶\n\n[kickstart.nvim](https://github.com/nvim-lua/kickstart.nvim)\n\n[YouTubeæ•™ç¨‹](https://youtu.be/stqUbv-5u2s?si=MZ-nfA6-Y0KOlqe9)\n\n```bash\ngit clone https://github.com/nvim-lua/kickstart.nvim.git \"${XDG_CONFIG_HOME:-$HOME/.config}\"/nvim\n```\n\n## ä½¿ç”¨\n\n### å‘½ä»¤\n\n`:Lazy` æ’ä»¶çŠ¶æ€\n\n`:Mason` LSPè‡ªåŠ¨è¡¥å…¨æ’ä»¶\n\n`:Telescope keymap`\n\n### å¿«æ·é”®\n\n`C+F` æŸ¥æ‰¾  `i` å®‰è£…\n\n`C+N` ä¸‹ä¸€æ¡  `C+P` ä¸Šä¸€æ¡ `C+Y` æ¥å—\n\n`[` `]` è·³è½¬\n\n`leader` è¢«é…ç½®ä¸º Spaceç©ºæ ¼é”®\n\n`<leader>?` æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶\n\n`<leader><leader>` å½“å‰æ‰“å¼€çš„ç¼“å†²åŒº\n\n`<leader>/` å½“å‰æ–‡ä»¶æœç´¢\n\n`gd` Goto Definiton\n\n`gr` Goto References\n\n`gI` Goto Implementation\n\n","tags":["nvim"]},{"title":"VsCodeä¸­ä½¿ç”¨PlatformIO","url":"/2024/10/19/VsCodeä¸­ä½¿ç”¨PlatformIO/","content":"\n## å®‰è£… Visual Studio Code\n\nåœ¨ [å®˜ç½‘](https://code.visualstudio.com/download) ä¸‹è½½ .deb å®‰è£…åŒ…\n\nä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤å®‰è£…ï¼ˆæ³¨æ„ä¿®æ”¹æ–‡ä»¶åï¼‰\n\n```bash\nsudo dpkg -i code_1.94.2-1728494015_amd64.deb\n```\n\n## ä»å¼€å§‹èœå•æ‰“å¼€ Visual Studio Code\n\nç‚¹å‡»æ’ä»¶ (Ctrl + Shift + X)ï¼Œæœç´¢ PlatformIO ç‚¹å‡»å®‰è£…\n\nå¦‚æœPlatformIOå¼¹çª—æç¤ºæ²¡æœ‰æ‰¾åˆ°pythonï¼Œæˆ‘çš„ç³»ç»Ÿå·²ç»å®‰è£…äº†python3.11\n\næ­¤æ—¶éœ€è¦å®‰è£… python3-venv å‚è€ƒ[é“¾æ¥](https://community.platformio.org/t/ubuntu-vscode-pio-extension-install-platformio-can-not-find-working-python-3-6-interpreter/27853/3)\n\n```bash\nhttps://community.platformio.org/t/ubuntu-vscode-pio-extension-install-platformio-can-not-find-working-python-3-6-interpreter/27853/3\n```\n\nç»§ç»­å®‰è£…\n\n## ä¸²å£æƒé™\n\né€šè¿‡ä¸²å£ä¸‹è½½ç¨‹åºï¼Œæç¤ºæ²¡æœ‰æƒé™ã€‚æ­¤æ—¶éœ€è¦æ ¹æ®æç¤ºé…ç½®udev\n\nå‚è€ƒé“¾æ¥ [99-platformio-udev.rules](https://docs.platformio.org/en/stable/core/installation/udev-rules.htmlhttps://docs.platformio.org/en/stable/core/installation/udev-rules.html)\n\nä¸‹è½½å¹¶å°†æ–‡ä»¶å¤åˆ¶åˆ° `/etc/udev/rules.d/` æ–‡ä»¶å¤¹ä¸­\n\né‡å¯udevæœåŠ¡ `sudo service udev restart`\n\næŸ¥çœ‹ä¸²å£æ‰€å±ç»„åï¼Œå¦‚ä¸‹é¢çš„ `dialout`\n\n```bash\nls -l /dev/ttyACM0\n# crw-rw---- 1 root dialout 166, 0 juil. 10 13:43 /dev/ttyACM0\n```\n\nå°†å½“å‰ç”¨æˆ·åŠ å…¥åˆ° `dialout` ç»„\n\n```bash\nsudo usermod -a -G dialout $USERNAME\n```\n\næ³¨é”€åé‡æ–°ç™»é™†","tags":["PlatformIO"]},{"title":"è°ƒæ•´ç”µè„‘å¯åŠ¨é¡ºåº","url":"/2024/10/19/è°ƒæ•´ç”µè„‘å¯åŠ¨é¡ºåº/","content":"\n## é—®é¢˜\n\nè™½ç„¶Ubuntu åˆšå¼€å§‹å®‰è£…å®Œæˆåï¼Œç”µè„‘é»˜è®¤ä¼šé€šè¿‡GRUBå¯åŠ¨ã€‚ä½†æ˜¯ Windows ç»å¸¸ä¼šè¶Šè¿‡ GRUB ç›´æ¥å¯åŠ¨ã€‚\n\næ­¤æ—¶åªèƒ½åœ¨å¼€æœºåé€šè¿‡ BIOS è‡ªå¸¦å¯åŠ¨é€‰é¡¹ï¼Œæ‰‹åŠ¨é€‰æ‹©GRUBã€‚éå¸¸éº»çƒ¦ã€‚\n\n## è§£å†³\n\né“¾æ¥ [How to make UEFI bios start GRUB, not Windows?](https://superuser.com/questions/1247300/how-to-make-uefi-bios-start-grub-not-windows)\n\næˆ‘ä½¿ç”¨çš„æ˜¯\n\nefibootmgr -- This Linux tool can adjust the boot order. Begin by typing sudo efibootmgr alone to see the options. Note the number (Boot####) associated with the ubuntu entry, and the current boot order (on the BootOrder line). You can then enter a new boot order with the ubuntu entry at the top by using the -o option. For instance, if the current boot order is 0000,0003,0007,0004 and ubuntu is 0007, you'd type sudo efibootmgr -o 0007,0000,0003,0004 to adjust the boot order.\n\n\nefibootmgr -- è¿™ä¸ª Linux å·¥å…·å¯ä»¥è°ƒæ•´å¯åŠ¨é¡ºåºã€‚ é¦–å…ˆå•ç‹¬è¾“å…¥ sudo efibootmgr æŸ¥çœ‹é€‰é¡¹ã€‚ æ³¨æ„ä¸ ubuntu æ¡ç›®ç›¸å…³çš„ç¼–å·ï¼ˆBoot####ï¼‰å’Œå½“å‰å¯åŠ¨é¡ºåºï¼ˆåœ¨ BootOrder è¡Œï¼‰ã€‚ ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ -o é€‰é¡¹è¾“å…¥ä¸€ä¸ªæ–°çš„å¯åŠ¨é¡ºåºï¼Œå°† ubuntu æ¡ç›®æ”¾åœ¨æœ€å‰é¢ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰çš„å¯åŠ¨é¡ºåºæ˜¯ 0000,0003,0007,0004ï¼Œè€Œ ubuntu æ˜¯ 0007ï¼Œä½ å°±å¯ä»¥è¾“å…¥ sudo efibootmgr -o 0007,0000,0003,0004 æ¥è°ƒæ•´å¯åŠ¨é¡ºåºã€‚\n","tags":["linux"]},{"title":"vimå®‰è£…coc-nvimæ’ä»¶å®ç°ä»£ç è¡¥å…¨","url":"/2024/10/06/vimå®‰è£…coc-nvimæ’ä»¶å®ç°ä»£ç è¡¥å…¨/","content":"\n## vim æ’ä»¶ç®¡ç†å™¨\n\n[vim-plug](https://github.com/junegunn/vim-plug) Minimalist Vim Plugin Manager \n\n### å®‰è£…\n\n```bash\ncurl -fLo ~/.vim/autoload/plug.vim --create-dirs \\\n    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\n```\n\n### ä½¿ç”¨\n\nedit `~/.vimrc`\n\n```vim\ncall plug#begin()\n\n\" List your plugins here\nPlug 'tpope/vim-sensible'\n\ncall plug#end()\n```\n\né‡å¯ vim, å³å¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤\n\n* `:PlugInstall` to install the plugins\n* `:PlugUpdate` to install or update the plugins\n* `:PlugDiff` to review the changes from the last update\n* `:PlugClean` to remove plugins no longer in the list\n\n\n## coc.nvim æ’ä»¶\n\n[coc.nvim](https://github.com/neoclide/coc.nvim) Make your Vim/Neovim as smart as VS Code\n\nç¼–è¾‘ `~/.vimrc` åŠ å…¥ vim-plug æ’ä»¶åˆ—è¡¨\n\n```vim\n\" Use release branch (recommended)\nPlug 'neoclide/coc.nvim', {'branch': 'release'}\n\n\" Or build from source code by using npm\nPlug 'neoclide/coc.nvim', {'branch': 'master', 'do': 'npm ci'}\n```\n\né‡å¯ vim ç„¶åæ‰§è¡Œ `:PlugInstall` å‘½ä»¤å®‰è£…coc.nvim\n\nå®‰è£…å®Œæˆåï¼Œå†æ¬¡ç¼–è¾‘ `~/.vimrc` åŠ å…¥é»˜è®¤é…ç½®å‚æ•°(å¿«æ·é”®ç­‰) [é“¾æ¥](https://github.com/neoclide/coc.nvim#example-vim-configuration)\n\n## c/c++ è¡¥å…¨æ’ä»¶\n\n[coc-clangd](https://github.com/clangd/coc-clangd) clangd extension for coc.nvim \n\nvim ä¸­æ‰§è¡Œ `:CocInstall coc-clangd` å®‰è£…æ’ä»¶ï¼Œæ­¤æ’ä»¶ç”¨äºè¿æ¥ä¸‹ä¸€å°èŠ‚å®‰è£…çš„clangdæœåŠ¡\n\nä¿®æ”¹é…ç½®å‚æ•° `:CocConfig` ï¼Œé…ç½®å‚æ•°ä¹Ÿå¯å‚è€ƒ[llvm.org](https://clangd.llvm.org/installation.html) \n\n```vim\n{\n  \"clangd.arguments\": [\"--background-index\", \"--clang-tidy\"],\n  \"clangd.fallbackFlags\": [\"-std=c++23\"]\n}\n```\n\n## å®‰è£… clangd\n\n[llvm.org](https://clangd.llvm.org/installation.html) ä¸­ Editor plugins å°èŠ‚\n\n```bash\nsudo apt install clangd\n```\n\n## ä½¿ç”¨\n\nvimæ–°å»ºmain.cppæ–‡ä»¶ç¼–å†™ä»£ç \n\nCocå¿«æ·é”®ï¼š\n\n1. `Tab`åˆ‡æ¢è¡¥å…¨ `Enter`ç¡®è®¤\n2. `gd` to jump to definition\n3. `gr` for references\n4. `gy` for type definition\n5. `K`  for documentation\n6. `<leader>rn` for renaming  `<leader>`é»˜è®¤ä¸º `\\` æŒ‰é”®\n7. `if`, `ic` for func/class selection in visual mode\n8. `<space>a` to list diagnostics\n9. `[g` and `]g` to go prev/next in diagnostics\n10. `Ctrl+o` åœ¨æ™®é€šæ¨¡å¼ä¸‹ï¼ŒæŒ‰ Ctrl + o å¯ä»¥è¿”å›åˆ°ä¸Šä¸€ä¸ªå…‰æ ‡ä½ç½®\n11. `Ctrl+i` å¯ä»¥å‰è¿›åˆ°ä¸‹ä¸€ä¸ªå…‰æ ‡ä½ç½®ï¼ˆå³å›åˆ°ä½¿ç”¨ Ctrl + o è¿”å›çš„åœ°æ–¹ï¼‰\n\n## å…¶ä»–æ’ä»¶\n\n1. auto-pairs è‡ªåŠ¨è¡¥æ‹¬å·\n2. fzf æ–‡ä»¶æœç´¢\n3. nerdtree æ–‡ä»¶åˆ—è¡¨\n4. lightline å¥½çœ‹çš„çŠ¶æ€æ \n\n```vim\ncall plug#begin()\n\nPlug 'jiangmiao/auto-pairs'\nPlug 'junegunn/fzf', { 'do': { -> fzf#install() } }\nPlug 'junegunn/fzf.vim'\n\"Plug 'voldikss/vim-floaterm'\nPlug 'preservim/nerdtree', { 'on': 'NERDTreeToggle' }\nPlug 'itchyny/lightline.vim'\nPlug 'neoclide/coc.nvim', { 'branch': 'release' }\n\ncall plug#end()\n```\n\n","tags":["vim"]},{"title":"nodejså®‰è£…","url":"/2024/10/06/nodejså®‰è£…/","content":"\n## ç®€ä»‹\n\n### ç»´åŸºç™¾ç§‘\n\nNode.js æ˜¯è·¨å¹³å°ã€å¼€æºçš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå¯åœ¨ Windowsã€Linuxã€macOS ç­‰æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚\n\nNode.js å¤§éƒ¨åˆ†åŸºæœ¬æ¨¡å—éƒ½ç”¨ JavaScript è¯­è¨€ç¼–å†™ã€‚åœ¨ Node.js å‡ºç°ä¹‹å‰ï¼ŒJavaScript é€šå¸¸ä½œä¸ºå®¢æˆ·ç«¯ç¨‹åºè®¾è®¡è¯­è¨€ä½¿ç”¨ï¼Œä»¥JavaScript å†™å‡ºçš„ç¨‹åºå¸¸åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šæ‰§è¡Œã€‚Node.js çš„å‡ºç°ä½¿ JavaScript ä¹Ÿèƒ½ç”¨äºæœåŠ¡ç«¯ç¼–ç¨‹ã€‚Node.js å«æœ‰ä¸€ç³»åˆ—å†…ç½®æ¨¡å—ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥è„±ç¦» Apache HTTP Server æˆ– IISï¼Œä½œä¸ºç‹¬ç«‹æœåŠ¡å™¨æ‰§è¡Œã€‚ \n\n[wikipedia](https://zh.wikipedia.org/zh-cn/Node.js)\n\n### ä¸ªäººç†è§£\n\nåœ¨ Node.js å‡ºç°ä¹‹å‰ï¼ŒJavaScript æ˜¯åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„ï¼Œä¸»è¦ç”¨äºå‰ç«¯å¼€å‘ã€‚Node.js ä¸º JavaScript æä¾›äº†ä¸€ä¸ªç‹¬ç«‹è¿è¡Œç¯å¢ƒï¼Œè€Œæ— éœ€ä¾èµ–æµè§ˆå™¨ï¼Œä½¿å…¶èƒ½å¤Ÿç”¨äºç¼–å†™åç«¯é€»è¾‘ã€‚\n\n## è½¯ä»¶\n\n### ç®¡ç† Node.js\n\nå®‰è£…å’Œåˆ‡æ¢ Node.js çš„ä¸åŒç‰ˆæœ¬\n\n[nvs](https://github.com/jasongin/nvs) (Node Version Switcher)ã€‚\n\n```bash\nnvs\nnvs add latest\nnvs add lts\nnvs add <version>\nnvs use lts\nnvs use <version>\nnvs list\nnvs link lts\nnvs alias default <version>\n```\n\n[nvm](https://github.com/nvm-sh/nvm) (Node Version Manager)\n\n### ç®¡ç†åŒ…\n\nç”¨äºå®‰è£…å’Œç®¡ç† JavaScript åŒ…\n\n[npm](https://www.npmjs.com/) (Node Package Manager) npm æ˜¯ Node.js çš„é»˜è®¤åŒ…ç®¡ç†å™¨ã€‚\n\n```bash\nnpm install <package-name>\nnpm install -g <package-name>\nnpm uninstall <package-name>\n```\n\n[yarn](https://yarnpkg.com/) æ˜¯Facebook å¼€å‘çš„ä¸€ä¸ªæ›¿ä»£ npm çš„åŒ…ç®¡ç†å·¥å…·\n\n```bash\nyarn add <package-name>\nyarn remove <package-name>\nyarn upgrade <package-name>\n```\n\n### npx\n\nnpx æ˜¯ npm é™„å¸¦çš„å·¥å…·ï¼Œç”¨äºæ‰§è¡Œ npm åŒ…ä¸­çš„å‘½ä»¤ï¼Œè€Œæ— éœ€å…¨å±€å®‰è£…å®ƒä»¬ã€‚\n\n```bash\nnpx <package-name>\nnpx <package-name>@<version>\n```\n","tags":["Node.js"]},{"title":"CPPå­¦ä¹ ç¬”è®°","url":"/2024/09/06/CPPå­¦ä¹ ç¬”è®°/","content":"\nè§†é¢‘æ•™ç¨‹ï¼š [youtube ä¾¯æ·](https://www.youtube.com/watch?v=2S-tJaPKFdQ&list=PL-X74YXt4LVZ137kKM5dNfCIC4tsScerb)\n\n## P1\n\nç±»åˆ†ä¸¤ç§ï¼Œæ€è€ƒæ–¹å¼å®Œå…¨ä¸åŒï¼š\n\n**æ— æŒ‡é’ˆ**:å¤šåŠä¸ç”¨å†™ææ„å‡½æ•°\nclass without pointer members (Complex å¤æ•°)\n\n**æœ‰æŒ‡é’ˆ**:è¦å†™ææ„å‡½æ•°\nclass with pointer members (String å­—ç¬¦ä¸²)\n\n\nç±»ä¹‹é—´çš„å…³ç³»ï¼š\n\n**ç»§æ‰¿**inheritanceã€**å¤åˆ**compositionã€**å§”æ‰˜**delegation\n\nå•ä¸€class:     Object Basedï¼š   åŸºäºå¯¹è±¡\n\nclassé—´æœ‰å…³è”ï¼šObject Oriented: é¢å‘å¯¹è±¡\n\nc++(C++è¯­è¨€ C++æ ‡å‡†åº“) æ¨èä¹¦ç±\n\n## P2\n\nc å˜é‡ä¸ºå…¨å±€\n\nc++ å˜é‡å’Œå¯¹è±¡ç»‘å®š(c++ä¸­çš„classå’ŒstructåŒºåˆ«å¾ˆå°)\n\nc   æ— æŒ‡é’ˆ æ•°æ®å¤šä¸ªåœ°æ–¹ å‡½æ•°ä¸€ä»½\n\nc++ æœ‰æŒ‡é’ˆ æ•°æ®æ˜¯ä¸€ä¸ªæŒ‡é’ˆ å‡½æ•°ä¸€ä»½ å…·ä½“æ•°æ®å¤šä¸ªåœ°æ–¹\n\nc   æ ‡å‡†åº“\n\n`include <stdio.h> == <cstdio>`\n\nc++ æ ‡å‡†åº“ (include å¯ä»¥ä¸å¸¦.håç¼€)\n\n`include <iostream.h> == <iostream>`\n\næ ‡å‡†åº“ `std::cout <<` æ¥æ”¶åŸºæœ¬ç±»å‹ï¼Œå…¶ä»–å¤æ‚ç±»å‹éœ€è¦è‡ªå·±å†™ç¬¦å·é‡è½½å‡½æ•°\n\n```cpp\n.h é˜²å«å¼å£°æ˜\n#ifndef __COMPLEX__\n#define __COMPLEX__\n...\n#endif\n```\n\nä¸€ä¸ªç±»æ»¡è¶³å¤šç§æ•°æ®ç±»å‹ ä½¿ç”¨æ¨¡æ¿ åœ¨ä½¿ç”¨çš„æ—¶å€™æ¥ç¡®å®š\n\n`template<typename T>`\n\nç±»é‡Œé¢ä½¿ç”¨Tæ¥ä»£æ›¿æœªç¡®å®šç±»å‹çš„å˜é‡ï¼Œä»¥åä½¿ç”¨ï¼š\n\n```cpp\ncomplex<double> c1(2.5, 1.5);\ncomplex<int> c2(2, 6);\n```\n\n## P3\n\ninline å‡½æ•° å¿« æ”¾ç½®åœ¨class çš„ {body} ä¸­ï¼Œæˆ–è€…å‡½æ•°å‰åŠ  inlineã€‚ å¤æ‚çš„å‡½æ•°å³ä½¿å†™inlineä¹Ÿæ²¡ç”¨ å…¨éƒ¨å†™inlineä¹Ÿæ²¡å…³ç³»\n\nç±»ä½¿ç”¨çš„ä¸‰ç§æ–¹å¼:\n```cpp\ncomplex c1(1,2);\ncomplex c2;\ncomplex *c3 = new complex(1, 2);\n```\n\n```cpp\nnew delete\narray new delete array //éœ€è¦è°ƒç”¨å¤šæ¬¡ææ„å‡½æ•° ä¸ç„¶åªä¼šè°ƒç”¨ä¸€æ¬¡ææ„å‡½æ•°\n```\n\nå­—ç¬¦æ•°ç»„\n\n```cpp\nclass complex\n{\npublic:\n    complex (double r=0, double i=0)\n        : re (r), im (i)\n    {}\n    comple& operator += (const complex&);\n    double real () const {return re;}\n    double imag () const {return im;}\nprivate:\n    double re im;\n    \n    friend complex& __doapl (comple*, const complex&);\n};\n```\n\næ•°æ®å…¨éƒ¨æ”¾åˆ°privateä¸­ï¼Œå‡½æ•°ä¸»è¦æ”¾åœ¨publicï¼Œå¦‚æœä¸æƒ³è®©åˆ«äººè°ƒç”¨å°±æ”¾åˆ°privateä¸­ã€‚\n\næˆå‘˜å‡½æ•° éæˆå‘˜å‡½æ•°\n\né‡è½½ å‡½æ•°çš„å‚æ•°ä¸€å®šä¸èƒ½ä¸€æ · ç¼–è¯‘å™¨çœ‹åˆ°çš„å‡½æ•°å®é™…ä¸ºï¼ˆå‡½æ•°å+å‚æ•°ï¼‰ æ³¨æ„å‚æ•°é»˜è®¤å€¼çš„é—®é¢˜\n\n`complex (double r = 0, double i = 0) : re (r), im(i){}`\n\næ„é€ å‡½æ•°ï¼š1é»˜è®¤å€¼ 2åˆå§‹åŒ–åˆ—è¡¨ï¼ˆä»…æ„é€ å‡½æ•°æœ‰æ­¤åŠŸèƒ½ï¼‰ 3å¤šæ€\næ„é€ å‡½æ•°ä¸€å®šè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ•…ä¸éœ€è¦å†™è¿”å›å€¼\n\n## P4\n\næŠŠæ„é€ å‡½æ•°å†™åœ¨privateä¸­ï¼Œè¡¨ç¤ºä¸èƒ½è¢«å¤–éƒ¨è°ƒç”¨ï¼Œå³ä¸èƒ½å®ç°ç±»çš„å£°æ˜å’Œå®šä¹‰ã€‚\n\næœ‰ç§è®¾è®¡æ¨¡å¼Singletonï¼Œåˆ©ç”¨å°†æ„é€ å‡½æ•°å†™åˆ°privateä¸­æ¥å®ç°ä»…ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ã€‚\n\n`double real () const {return re;}`\nè‹¥å‡½æ•°ä¸ä¼šå»æ”¹å˜ç±»ä¸­çš„æ•°æ®ï¼Œéœ€è¦åœ¨å‡½æ•°()å’Œ{}ä¸­é—´åŠ  `const` é˜²æ­¢ ç”¨æˆ·å®šä¹‰ä¸€ä¸ª `const complex c1(1,2)` åœ¨ä½¿ç”¨æ—¶ `c1.real();` ä¼šå‡ºç°é”™è¯¯ã€‚\n\nå‡½æ•°å‚æ•°åŠè¿”å›å€¼å°½é‡ä¼ å¼•ç”¨ï¼Œè‹¥å‚æ•°å€¼è¾ƒé•¿ï¼Œä¼ å‚æ•°ä¼šå°†å‚æ•°å€¼å¤åˆ¶åˆ°æ ˆï¼Œè€Œå¼•ç”¨ä»…ä¼šä¼ ä¸€ä¸ªåœ°å€ï¼š\n\n```cpp\npass by value\npass by reference(to const)\nretnrn by value\nreturn by reference\n```\n\n`comple& operator += (const complex&);`\n\nè‹¥å‚æ•°å€¼ä¸ä¼šæ”¹å˜åˆ™åŠ å…¥constæ ‡è¯†ï¼Œå¼•ç”¨å’ŒæŒ‡é’ˆæ•ˆæœç±»ä¼¼ï¼Œå‡½æ•°ä¸­æ”¹å˜å¼•ç”¨ä¹Ÿä¼šæ”¹å˜å˜é‡çš„å€¼ã€‚\n\nç›¸åŒclassçš„å„ä¸ªobjectsäº’ä¸ºfriendså‹å…ƒï¼ˆå¯ä»¥ä½¿ç”¨privateç§æœ‰æ•°æ®ï¼‰\nä¸æ˜¯æ–°çš„å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥å¯ä»¥ä¼ å¼•ç”¨ã€‚\n\nè¿”å›å€¼ï¼šå¦‚è¿”å›å€¼ä¸æ˜¯æ–°å˜é‡(å±€éƒ¨å˜é‡)çš„åˆ™è¿”å›å¼•ç”¨ å¦‚i++\n\nè¿”å›å€¼ï¼šå¦‚è¿”å›å€¼éœ€è¦äº§ç”Ÿæ–°çš„å˜é‡ï¼Œåˆ™ä¼ å˜é‡ä¸ç„¶å‡½æ•°ç»“æŸä¸´æ—¶å˜é‡çš„å¼•ç”¨ä¹Ÿå°±ä¸¢å¤±äº† å¦‚c = a+b ä¸å¯ä¼ cçš„å¼•ç”¨\n\nè¿”å›å€¼ï¼šå¼•ç”¨å¯æ–¹ä¾¿ç”¨æˆ·å®ç° cout << real () << real() ç­‰è¿ç®—æ–¹å¼ï¼Œ å› ä¸ºæ‰§è¡Œé¡ºåºç‰¹æ®Šæ˜¯ä»å·¦åˆ°å³ï¼Œç¬¬ä¸€æ¬¡è¾“å‡ºåå«éœ€è¦æ¥æ”¶ï¼Œäº§ç”Ÿç¬¬äºŒæ¬¡è¾“å‡ºï¼›\n\n## P5\n\næ“ä½œç¬¦é‡è½½ æ‰€æœ‰æ“ä½œç¬¦éƒ½æ˜¯ä¸ºäº†ä½œç”¨åˆ°å·¦è¾¹\n\n```cpp\ninline complex&       //å•ç‹¬æå‡ºæ¥ä¹Ÿè®¸å…¶ä»–åœ°æ–¹ä¹Ÿåœ¨ç”¨\n__doapl(complex* ths, const const complex& r)\n{\n    ths->re += r.re;\n    ths->im += r.rm;\n    return *ths;\n}\n\ninline complex&\ncomplex::operator += (const complex& r)\n{\n    return __doapl(this, r);\n}\n```\n\nè¿”å›reference æ˜¯ä¸ºäº†è¿ç»­ä½¿ç”¨ å¦‚  c3+=c2+=c1; ä¸ºäº†åº”å¯¹å¦‚ä¸‹:\n\n```cpp\n{\n    complex c1(2,1);\n    complex c2;\n    \n    c2 = c1 + c2;\n    c2 = c1 + 5;\n    c2 = 7  + c1;\n}\n```\n\næ‰€ä»¥è¦å†™éæˆå‘˜å‡½æ•°çš„æ“ä½œç¬¦é‡è½½ å› ä¸ºè¿”å›çš„æ˜¯äº§ç”Ÿäº†æ–°çš„æ•°æ®ï¼Œæ‰€ä»¥åªèƒ½è¿”å›valueï¼Œä¸å¯ä»¥æ˜¯reference\n\n```cpp\ninline complex\noperator + (const compled& x, const complex& y)\n{\n    return complex( real(x) + real(y),\n                    imag(x) + imag(y));\n}\n\ninline complex\noperator + (const compled& x, double y)\n{\n    return complex( real(x) + y, imag(x));\n}\n\ninline complex\noperator + (double x, const complex& y)\n{\n    return complex( x + real(y), imag(y));\n}\n```\n\ncomplex ();  ==>  typename();  ç”¨æ¥åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œä½†ä¸ç»™å…¶åç§° ç±»ä¼¼ int(xxx);\n```cpp\n{\n    int(7);\n    complex c1(2,1);\n    complex c2;\n    complex ();\n    complex (4,5);\n    \n    cout <<complex(2);\n}\n```\n\nç±»::å‡½æ•°å  æ˜¯  æˆå‘˜å‡½æ•° æœ‰this\n\nå‡½æ•°å      æ˜¯  å…¨åŸŸå‡½æ•° æ— this\n\nå¯¹äº `<<` ç¬¦å·çš„é‡è½½åªèƒ½ç”¨å…¨åŸŸå‡½æ•°\n\ncout ä¸è®¤è¯†complexç±»ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±å†™æ“ä½œç¬¦é‡è½½å‡½æ•°ï¼Œå¹¶ä¸”éœ€è¦å°† << é‡è½½è¿ç®—å†™æˆå…¨åŸŸå‡½æ•°ï¼Œå¦‚æœæ˜¯ç±»å‡½æ•°ï¼Œé»˜è®¤ä¼šå¸¦thisæŒ‡é’ˆï¼Œä½¿ç”¨æ–¹å¼ä¼šåæˆ a << cout è€Œä¸æ˜¯ cout << a;\næ‰€æœ‰çš„æˆå‘˜å‡½æ•°ï¼Œé»˜è®¤åŒ…å«ä¸€ä¸ªå‚æ•°*thisï¼ŒthisæŒ‡é’ˆè°è°ƒç”¨ï¼ŒæŒ‡å‘è°ã€‚\n\n``` cpp\n#include <iostream.h>\nostream&\noperator << (ostream& os, const complex& x)\n{\n    return os << '(', << real(x) << ',' << imag(x) << ')';\n}\n```\n\næ„é€ å‡½æ•°ä¸å¸¦æŒ‡é’ˆçš„ç±»ï¼Œç¼–è¯‘å™¨ä¼šè‡ªå·±å¢åŠ æ‹·è´æ„é€ å’Œæ‹·è´å¤åˆ¶å‡½æ•°\n\n## P6 å¤ä¹ \n\n## P7\n\næ„é€ å‡½æ•°çš„å‚æ•°å¸¦æŒ‡é’ˆ  éœ€è¦å†™ææ„å‡½æ•°\n\nbig three: **æ‹·è´æ„é€ ** **æ‹·è´å¤åˆ¶** **ææ„**\n\n```cpp\n{\n    String s1(\"hello\");\n    String s2(s1);    //æ‹·è´æ„é€ \n    String s2 = s1;   //æ‹·è´èµ‹å€¼\n}\n```\n\n```cpp\nclass String\n{\npublic:\n    String(const char* cstr = 0);\n    String(const String& str);\n    String& operator = (const String& str);\n    ~String();\n    char* get_c_str() const {return m_data;}\nprivate:\n    char* m_data;\n};\ninline String::String(const char* cstr = 0)\n{\n    if(cstr) {\n        m_data = new char[strlen(cstr)+1];              //ä¸€å®šè¦ +1 ç”¨æ¥å­˜å‚¨ç»“æŸç¬¦ '\\0'\n        strcpy(m_data, cstr);\n    }\n    else {\n        m_data = new char[1];\n        *m_data = '\\0';\n    }\n}\ninline String::~String()\n{\n    delete[] m_data;\n}\n```\n\nä½¿ç”¨ï¼š\n\n```cp\n{\n    String s1();\n    String s2(\"hello\");\n    \n    String* p = new String(\"hello\");\n    delete p;\n}\n```\n\n**æµ…æ‹·è´**(åˆ«å)  é—®é¢˜ï¼šä¸¤ä¸ªå˜é‡æ§åˆ¶åŒä¸€å—å†…å­˜  ä¸€ä¸ªå˜é‡åŸæ¥çš„æ•°æ®æ²¡æœ‰æŒ‡é’ˆ\n\n**æ·±æ‹·è´**(æ•°æ®ç›¸åŒçš„ä¸¤ä¸ªå˜é‡)\n\nç¼–è¯‘å™¨é»˜è®¤ç»™å‡ºçš„æ˜¯æµ…æ‹·è´ï¼Œéœ€è¦è‡ªå·±å†™æ‹·è´æ„é€ å‡½æ•°\n\nç»å…¸å†™æ³•ä¸‰æ­¥èµ° **åˆ é™¤** **æ–°å»º** **æ‹·è´**\n\n```cpp\ninlin\nString& String::operator=(const String& str)\n{\n    if(this == &str)   //æ£€æµ‹è‡ªæˆ‘èµ‹å€¼\n        return *this;\n    delete[] m_data;\n    m_data = new char[strlen(str.m_data)+1];\n    strcpy(m_data, str.m_data);\n    return *this;\n}\n```\n\n## P8 å † æ ˆ å†…å­˜ç®¡ç†\n\næœ¬ç« åªé’ˆå¯¹ new è¿™ç§åŠ¨æ€åˆ†é…çš„ç”¨æ³•\n```cpp\nComplex c1(1,2);                   //å…¨å±€å¯¹è±¡ ç›´åˆ°ç¨‹åºç»“æŸ\n{\n    Complex c1(1,2);               //ç¦»å¼€ä½œç”¨åŸŸ c1 è°ƒææ„ ç„¶åè‡ªåŠ¨æ¸…é™¤\n    Complex* p = new Complex(3);   //ç¦»å¼€ä½œç”¨åŸŸ pæ‰€æŒ‡å†…å­˜ è¿˜å­˜åœ¨  éœ€è¦æ‰‹åŠ¨é‡Šæ”¾\n    static Complex c2(1,3);        //ç¦»å¼€ä½œç”¨åŸŸ c2è¿˜å­˜åœ¨ï¼Œç›´åˆ°ç¨‹åºç»“æŸ\n    \n    delete p;                      //æ‰‹åŠ¨é‡Šæ”¾\n}\n\n{\n    Complex* p = new COmplex(3);   //ç¦»å¼€ä½œç”¨åŸŸ pæ‰€æŒ‡å†…å­˜è¿˜å­˜åœ¨ï¼Œä½†på·²æ¶ˆå¤±ï¼Œé€ æˆå†…å­˜æ— æ³•å›æ”¶\n}\n```\n\n`new`   ï¼šåˆ†é…å†…å­˜ æ•°æ®ç±»å‹è½¬æ¢ è°ƒç”¨æ„é€ å‡½æ•°\n\n`delete`ï¼šè°ƒç”¨ææ„å‡½æ•° é‡Šæ”¾å†…å­˜\n\nåŠ¨æ€å†…å­˜åˆ†é…è¯¦è§£ï¼š  16çš„å€æ•° ä¸å¤Ÿå¡«0\n\nå•ä¸ªå¯¹è±¡çš„æƒ…å†µï¼š\nä¸Šä¸‹Cooke 4å­—èŠ‚*2  å†…å®¹æ˜¯åˆ†é…é•¿åº¦ï¼Œæœ€åä¸€ä½ä»£è¡¨ ç©ºé—² or ä½¿ç”¨\nè°ƒè¯•æ¨¡å¼ä¼šå¤šå‡º\nå›ºå®šå­—ç¬¦ ä¸Š4å­—èŠ‚*8 ä¸‹4å­—èŠ‚\nå®é™…å†…å®¹\n\næ•°ç»„çš„æƒ…å†µï¼š\ndebug å’Œ release ä¼šå†å®é™…å†…å®¹ä¹‹å‰åŠ æ•°ç»„é•¿åº¦\n\n`new []`   //array\n\n`delete []`\n\nå•ä¸€æˆ–æ•°ç»„å½¢å¼éƒ½ä¼šæœ‰Cookeè®°å½•åˆ†é…å†…å­˜çš„é•¿åº¦ï¼Œä½†æ•°ç»„å½¢å¼çš„deleteå¦‚æœæ²¡æœ‰æ­é…[] ä¼šé€ æˆå¯¹è±¡çš„ææ„å‡½æ•°ä»…è°ƒç”¨ä¸€æ¬¡ï¼Œæ— æ³•å°†å¯¹è±¡æ„é€ æ—¶ç”³è¯·çš„å†…å­˜åˆ é™¤ï¼Œè¿›è€Œé€ æˆå†…å­˜æ³„éœ²ã€‚\næ‰€ä»¥è‹¥æ„é€ å‡½æ•°æ²¡æœ‰å†…å­˜åˆ†é…ï¼Œä½¿ç”¨deleteä¸ä¼šå‡ºé—®é¢˜ã€‚ä½†ä¸å¯ä»¥è¿™æ ·ç”¨ã€‚\n\n## P9 å¤ä¹ Stringç±»çš„å®ç°è¿‡ç¨‹\n\n## P10 ç±»æ¨¡æ¿ å‡½æ•°æ¨¡æ¿\n\nåœ¨å˜é‡æˆ–å‡½æ•°å‰åŠ  static å®ƒå°±æ˜¯é™æ€å˜é‡æˆ–é™æ€å‡½æ•°\n\nåœ¨å¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„æ—¶ä¸åŒ…å«é™æ€éƒ¨åˆ†çš„æ•°æ®ï¼›\n\né™æ€å‡½æ•°æ²¡æœ‰thisæŒ‡é’ˆï¼Œä¸èƒ½ä¼ é€’è°ƒç”¨æ¥æºï¼Œæ‰€ä»¥åªèƒ½æ“ä½œé™æ€å˜é‡ï¼›\n\n```cpp\nclass Account {\npublic:\n    static double m_rate;\n    static void set_rate(const double& x) {m_rate = x;}\n};\ndouble Account::m_rate = 8.0;  //å¿…é¡»å¦‚æ­¤èµ‹åˆå€¼ï¼Œç±»ä¸­ä»…æœ‰å¯¹è±¡æœ‰å£°æ˜ï¼Œè¿˜å¿…é¡»åœ¨æ­¤å®šä¹‰ï¼Œåˆå€¼å¯æœ‰å¯æ— ï¼›\n```\n\nè°ƒç”¨é™æ€å‡½æ•°çš„ä¸¤ç§æ–¹å¼\n```cpp\nint main()\n{\n    Account::set_rate(5.0);  //é€šè¿‡ç±»åè°ƒç”¨ class name\n    \n    Account a;\n    a.set_rate(7.0);         //é€šè¿‡å¯¹è±¡è°ƒç”¨ object   ç‰¹æ®Šç‚¹åœ¨äºæ²¡æœ‰this\n}\n```\n\nSingleton è®¾è®¡æ¨¡å¼  å”¯ä¸€\n\n```cpp\nclass A {\npublic:\n    static A& getInstance();\n    setup() {...}\nprivate;\n    A();;\n    A(const A& rhs);\n    ...\n};\nA& A::getInstance()\n{\n    static A a;\n    return a;\n}\n```\n\nä¼˜ç‚¹åªæœ‰åœ¨ä½¿ç”¨ä¸ªä½“Instance() å‡½æ•°æ—¶æ‰ä¼šåˆ›å»ºa\nè°ƒç”¨: `A::getInstace().setup();`\n    \n\nç±»æ¨¡æ¿ `class template`  ä½¿ç”¨ä¸€ä¸ªç¬¦å·æ ‡è¯†ä¸€ç§æ•°æ®ç±»å‹\n\n```cpp\ntemplate<typename T>\nclass complex\n{\npublic:\n    complex (T r = 0, T i = 0)\n        : re (t), im (i)\n    {}\n    complex& operator += (const complex);\n    T real () const {return re;}\n    T imag () const {return im;}\nprivate:\n    T re, im;\n    \n    friend complex& __doapl (complex*, const const complex&);\n}\n{\n    complex<double> c1(2.5, 1.5);\n    complex<int> c2(2, 6);\n    ...\n}\n```\n\nå‡½æ•°æ¨¡æ¿ `function template`\n```cpp\ntemplate <class T>\ninline\nconst T& min(const T& a, const T& b)\n{\n    return b < a ? b : a;\n}\n\nstone r1(2, 3), r2(3,3), r3;\nr3 = min(r1, r2);\n```\n\nç¼–è¯‘å™¨ä¸çŸ¥é“stoneå¦‚ä½•æ¯”å¤§å°ï¼Œæ‰€ä»¥å†å¢åŠ æ“ä½œç¬¦é‡è½½\n```cpp\nclass stone\n{\npublic:\n    stone(int w, int h, int we)\n        : _w(w), _h(h), _weight(we)\n            {    }\n    bool operator< (const stone& rhs) const\n        {    return _weight < rhs._weight;  }\nprivate:\n    int _w, _h, _weight;\n};\n```\n\nå¦‚ä½•å»ºç«‹è‡ªå·±çš„å‘½åç©ºé—´ å¯ä»¥åˆ†æ®µå†™\n```cpp\nnamespace std\n{\n   ...\n}\n```\n\nå¦‚ä½•ä½¿ç”¨:\n\nç”¨æ³•1 using directive  å…¨éƒ¨æ‰“å¼€\n```cpp\n#include <iostream.h>\nusing namespace std;\n\nint main()\n{\n    cin << ...;\n    cout << ...;\n    return 0;\n}\n```\n\nç”¨æ³•2 using declaration  æ‰“å¼€ä¸€æ¡ å¦‚ä¸‹æ‰“å¼€cout è€Œcinæ²¡æ‰“å¼€\n```cpp\n#include <iostream.h>\nusing std::cout;\n\nint main()\n{\n    std::cin << ...;\n    cout << ...;\n    return 0;\n}\n```\n\nç”¨æ³•3   å®Œæ•´ä¹¦å†™\n\n```cpp\n#include <iostream.h>\n\nint main()\n{\n    std::cin << ...;\n    std::cout << ...;\n    return 0;\n}\n```\n\n## é¢å‘å¯¹è±¡\n\n## P11 ç»„åˆä¸ç»§æ‰¿\n\nå¤åˆ Composition\n\nclassä¸­å«æœ‰å¦ä¸€ä¸ªclass  **(has a)**  è®©Sequenceå¸®queueå®ç°åŠŸèƒ½\nè®¾è®¡æ¨¡å¼ Adapter å˜å‹å™¨ã€è½¬æ¢å™¨\n```cpp\ntemplate <class T, class Sequence = deque<T>>\nclass queue {\n    ...\nprotected:\n    Sequence c;    //é‡ç‚¹ queueä¸­æœ‰ä¸ªSequence(åº•å±‚å®¹å™¨)\npublic:\n    bool empty() const {return c.empty();}\n    \n    void push (const value_type& x) {c.push_back(x);}\n    void pop() {c.pop_front();}\n};\n```\nç”Ÿå‘½å‘¨æœŸ(ä¸€èµ·å‡ºç°æˆ–æ¶ˆå¤±ï¼Œä»…æœ‰å…ˆåé¡ºåº)\n\nåˆ›å»ºè¿‡ç¨‹ å…ˆå†…éƒ¨ åå¤–éƒ¨  (åŸºç¡€æ‰å®)\n\nå¤–éƒ¨æ„é€ å‡½æ•°ä¼šå¸®æˆ‘ä»¬è°ƒç”¨å†…éƒ¨çš„æ„é€ å‡½æ•°ï¼Œä½†ä»…ä¼šè°ƒç”¨é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œå¦‚æœä¸é€‚ç”¨éœ€è¦è‡ªå·±å†™æ¸…æ¥š\n```cpp\nContainer::Container(...) : Component() {...};     //Component()æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬åŠ çš„ ä¸é€‚ç”¨å°±è‡ªå·±ä¸»åŠ¨å†™\n```\n\nææ„è¿‡ç¨‹ å…ˆå¤–éƒ¨ åå†…éƒ¨  (å±‚å±‚å‰¥å¼€)\n```cpp\nContainer::~Container(...){... ~Component()};   //~Component() æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬åŠ çš„\n```\n\nå§”æ‰˜ Delegation (Composition by reference)\n\nä»æ¥ä¸è®² by pointï¼Œå› ä¸ºå­¦æœ¯ç•Œåªè®² by reference ä¼ æŒ‡é’ˆä¹Ÿå½’ç±»ä¸º by reference  **classä¸­å«æœ‰å¦ä¸€ä¸ªclassçš„æŒ‡é’ˆ**\n\nè‡³äºä»€ä¹ˆæ—¶å€™çœŸçš„æœ‰å¦ä¸€ä¸ªclassä¸ç¡®å®š\nç”Ÿå‘½å‘¨æœŸ ä¸åŒæ­¥ï¼Œæ²¡æœ‰å…ˆåï¼Œéœ€è¦è°åˆ›å»ºè°ã€‚\nå¯ä»¥å®ç°ç±»ä¼¼æ¥å£çš„åŠŸèƒ½ï¼Œå¯¹å¤–çš„classä¸å˜ï¼Œå†…éƒ¨å‡½æ•°çš„å˜åŒ–ä¸å½±å“å¤–éƒ¨ã€‚ ä¹Ÿå«ç¼–è¯‘é˜²ç«å¢™   Handle/Body(å¤´å’Œèº«ä½“)\n\nç»§æ‰¿ Inheritance\n\nclassä¸­å«æœ‰å¦ä¸€ä¸ªclass, è¡¨ç¤º **is-a**  å­ç±»ä¸­æœ‰çˆ¶ç±»çš„æˆåˆ†part åŒ…å«æ•°æ®å’Œå‡½æ•°çš„è°ƒç”¨æƒ\n\nåˆ›å»ºè¿‡ç¨‹ å…ˆå†…éƒ¨çˆ¶ç±» åå¤–éƒ¨å­ç±»  (åŸºç¡€æ‰å®)         å­ç±»æ„é€ å‡½æ•°ä¼šå¸®æˆ‘ä»¬è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä½†ä»…ä¼šè°ƒç”¨é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œå¦‚æœä¸é€‚ç”¨éœ€è¦è‡ªå·±å†™æ¸…æ¥š\n```cpp\nDerived::Derived(...) : Base() {...};  //Base()æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬åŠ çš„ ä¸é€‚ç”¨å°±è‡ªå·±ä¸»åŠ¨å†™\nææ„è¿‡ç¨‹ å…ˆå¤–éƒ¨å­ç±» åå†…éƒ¨çˆ¶ç±»  (å±‚å±‚å‰¥å¼€)\nDerived::~Derived(...){... ~Base()};   //~Base() æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘ä»¬åŠ çš„\n```\n\nå¦‚æœç±»ä¼šæˆä¸ºçˆ¶ç±»ï¼Œææ„å‡½æ•°å¿…é¡»æ˜¯virtualï¼Œå¦åˆ™ä¼šå‡ºç°undefined behavior\n\n\n## P12 è™šå‡½æ•° virtual functions\n\nnon-virtual **éè™šå‡½æ•°**ï¼šä¸å¸Œæœ›å­ç±»(derived class)é‡æ–°å®šä¹‰(override, è¦†å†™)\n\nvirtual       **è™šå‡½æ•°**ï¼š  å¸Œæœ›å­ç±»(derived class)é‡æ–°å®šä¹‰(override, è¦†å†™)ï¼Œå³ä½¿å®ƒå·²æœ‰é»˜è®¤å®šä¹‰ã€‚\n\npure virtual  **çº¯è™šå‡½æ•°**ï¼š  å¸Œæœ›å­ç±»(derived class)é‡æ–°å®šä¹‰(override, è¦†å†™)ï¼Œå®ƒä¸€å®šæ²¡æœ‰é»˜è®¤å®šä¹‰\n\nå­å‡½æ•°ä½¿ç”¨overrideé‡å†™å®šä¹‰ \n```cpp  \nclass Shape{\npublic:\n    virtual void draw() const = 0;                 //çº¯è™šå‡½æ•°  å­å‡½æ•°ä¸€å®šè¦é‡å†™\n    virtual void error(const std::string& msg);    //è™šå‡½æ•°\n    int objectID() const;                          //éè™šå‡½æ•°\n    ...\n};\nclass Rectangle: public Shape{...};\nclass Ellipse.public Shape {...};\n```\n\nè®¾è®¡æ¨¡å¼ï¼šTemplate Method\nè¾ƒä¸ºæœ‰åçš„åº”ç”¨MFC\n\n```cpp\n#include <iostream>\nusing namespace std;\n\nclass CDocument\n{\npublic:\n    void OnFileOpen()\n    {\n        cout << \"open file...\" << endl;\n        Serialize();\n        cout << \"close file...\" << endl;\n    }\n    virtual void Serialize() {};\n};\nclass CMyDoc : public CDocument\n{\npublic:\n    //åªæœ‰åº”ç”¨ç¨‹åºæœ¬èº«çŸ¥é“å¦‚ä½•è¯»å–è‡ªå·±çš„æ–‡ä»¶ï¼ˆæ ¼å¼ï¼‰\n    virtual void Serialize()\n    {\n        cout << \"CMyDoc::Serial()\" << endl;\n    }\n}\nint main()\n{\n    CMyDoc myDoc;\n    myDoc.OnFileOpen();\n}\n```\n\nå§”æ‰˜ + ç»§æ‰¿\n\nè®¾è®¡æ¨¡å¼Observer\nåˆ—è¡¨å­˜æ”¾éœ€è¦è¢«æ›´æ–°çš„ç›®æ ‡ï¼Œæä¾›è®¢é˜… é€€è®¢ å’Œ éå†åŠŸèƒ½\nçˆ¶ç±»æä¾›æ›´æ–°è™šå‡½æ•°ï¼Œç”±å­ç±»ç»§æ‰¿å®ç°éœ€è¦è¢«æ›´æ–°çš„æ“ä½œ\nå¤šç”¨äºUIæ›´æ–°\n\nå§”æ‰˜ + ç»§æ‰¿\n\nè®¾è®¡æ¨¡å¼Composite\næ–‡ä»¶ç³»ç»Ÿ æ—¢æœ‰æ–‡ä»¶ ä¹Ÿæœ‰ç›®å½• ç›®å½•é‡Œé¢è¿˜æœ‰æ–‡ä»¶å’Œç›®å½•\n\nå§”æ‰˜ + ç»§æ‰¿\n\nè®¾è®¡æ¨¡å¼Prototype åŸå‹\nåˆ›å»ºä¸€ä¸ªæœªæ¥åˆ«äººå®šä¹‰çš„ç±»\n\n\n## P14\n\nC++æŠ€æœ¯ä¸»çº¿\n\né¢å‘å¯¹è±¡ç¼–ç¨‹ å’Œ æ³›å‹ç¼–ç¨‹(æ¨¡æ¿)\n\nSTLæ ‡å‡†åº“åŸºæœ¬éƒ½æ˜¯æ¨¡æ¿ç¼–ç¨‹ï¼Œæ³›å‹æ€ç»´ï¼Œç»§æ‰¿å…³ç³»å¾ˆå°‘\nä¹¦ç±æ¨è\n\n## P15\n\nè½¬æ¢å‡½æ•° conversion function\n```cpp\nclass Fraction   //åˆ†æ•°\n{\npublic:\n    Fraction(int num, int den = 1);\n     : m_numeratior(num), m_denominator(den) {}\n    operator double() const {\n      return (double)(m_numerator / m_denmoinator);\n    }\nprivate:\n    int m_numerator;    //åˆ†å­\n    int m_denominator;  //åˆ†æ¯\n};\n```\n\nåº”ç”¨ï¼š\n```cpp\nFraction f(3, 5);\ndouble d = 4+f;  //è°ƒç”¨operator double() å°†f è½¬ä¸º0.6\n```","tags":["CPP"]},{"title":"ä¸€ä¸»æœºå¤šå®¢æˆ·ç«¯websocketé€šè®¯","url":"/2024/08/25/ä¸€ä¸»æœºå¤šå®¢æˆ·ç«¯websocketé€šè®¯/","content":"\nuvicorn FastAPI WebSocket\n\n## 1.æ¦‚è¿°\n\nwebsocketæœåŠ¡å™¨ï¼Œæ¥æ”¶å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®ç»ç”±ç®—æ³•å¤„ç†åï¼Œå°†ç»“æœè¿”å›ç»™å¯¹åº”å®¢æˆ·ç«¯ã€‚\n\nfastapiåŒæ—¶æ”¯æŒhttpåè®®ï¼Œå¯è‡ªè¡Œå¢åŠ å¯æä¾›ç½‘é¡µæœåŠ¡ã€‚\n\n\n## 2.ç¨‹åºæ–‡ä»¶\n\nè‡ªè¡Œå‡†å¤‡ä¸€å¼ jpgæ ¼å¼çš„å›¾ç‰‡ï¼Œå¤åˆ¶åˆ°ç¨‹åºæ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶é‡å‘½åä¸º`picture_in.jpg`\n\nå°†ä»¥ä¸‹ä»£ç å­˜å‚¨ä¸ºå¯¹åº”åç§°çš„æ–‡ä»¶ï¼Œå¹¶å…¨éƒ¨æ”¾åˆ°ç¨‹åºæ–‡ä»¶å¤¹ä¸­\n\n```python\n# pyqt_app.py\nimport sys\nimport cv2\nfrom PyQt5.QtCore import Qt\nfrom PyQt5.QtCore import QThread\nfrom PyQt5.QtWidgets import QApplication, QMainWindow, QVBoxLayout, QWidget, QLabel\nfrom web_api import WebTask, ProcessingTask\n\n\nclass MainWindow(QMainWindow):\n    def __init__(self):\n        super().__init__()\n        self.setWindowTitle(\"FastAPI + PyQt\")\n\n        # åˆ›å»ºä¸€ä¸ªå‚ç›´å¸ƒå±€\n        layout = QVBoxLayout()\n\n        # åˆ›å»ºä¸€ä¸ªæ ‡ç­¾å¹¶æ·»åŠ åˆ°å¸ƒå±€ä¸­\n        self.label = QLabel()\n        layout.addWidget(self.label)\n\n        self.lab_img = QLabel()\n        layout.addWidget(self.lab_img)\n\n        # åˆ›å»ºä¸€ä¸ª widget å¹¶è®¾ç½®å¸ƒå±€\n        central_widget = QWidget()\n        central_widget.setLayout(layout)\n        self.setCentralWidget(central_widget)\n\n    def change_txt(self, msg):\n        self.label.setText(msg)\n\n    def display_img(self, id, num, im):\n        print(f'socket:{id}, image:{num}')\n        cv2.imshow('im', im)\n        cv2.waitKey(1)\n\n\nif __name__ == \"__main__\":\n    app = QApplication(sys.argv)\n    window = MainWindow()\n    window.show()\n\n    # Web\n    webThread = QThread()\n    web = WebTask()\n    web.moveToThread(webThread)\n    webThread.started.connect(web.long_running)\n    web.signal_text.connect(window.change_txt)\n    # web.signal_client_msg.connect(window.display_img)\n\n    # Processing\n    procThread = QThread()\n    proc = ProcessingTask()\n    proc.moveToThread(procThread)\n    procThread.started.connect(proc.long_running)\n    # web.signal_client_msg.connect(proc.receive_msg, Qt.DirectConnection)\n\n    webThread.start()\n    procThread.start()\n\n    sys.exit(app.exec_())\n\n```\n\n\n```python\n# web_api.py\nimport base64\nimport asyncio\nimport threading\nimport time\nimport cv2\nimport numpy as np\nimport uvicorn\nfrom io import BytesIO\nfrom typing import List\nfrom PIL import Image\nfrom fastapi import FastAPI, WebSocket, WebSocketDisconnect\nfrom PyQt5.QtCore import QObject, pyqtSignal\nfrom collections import deque\nfrom IDQueue import IDQueue\n\nmax_len_queue = 5\nsocket_to_ai_queue = deque(maxlen=max_len_queue)\nai_to_socket_queue = IDQueue()\nsocket_to_ai_lock = threading.Lock()\nai_to_socket_lock = threading.Lock()\n\n\nclass ConnectionManager:\n    def __init__(self):\n        self.active_connections: List[WebSocket] = []\n\n    async def connect(self, websocket: WebSocket):\n        await websocket.accept()\n        self.active_connections.append(websocket)\n\n    def disconnect(self, websocket: WebSocket):\n        self.active_connections.remove(websocket)\n\n    async def send_personal_message(self, message: str, websocket: WebSocket):\n        await websocket.send_text(message)\n\n    async def broadcast(self, message: str):\n        for connection in self.active_connections:\n            await connection.send_text(message)\n\n\nclass WebTask(QObject):\n    signal_text = pyqtSignal(str)\n    signal_client_msg = pyqtSignal(int, int, np.ndarray)\n\n    def __init__(self):\n        super().__init__()\n        self.app = FastAPI()\n        self.manager = ConnectionManager()\n\n    def long_running(self):\n        @self.app.websocket(\"/ws_bytes/{client_id}\")\n        async def websocket_client_msg(websocket: WebSocket, client_id: int):\n            await self.manager.connect(websocket)\n            ai_to_socket_queue.clear(client_id)\n            try:\n                while True:\n                    data = await websocket.receive_json()\n                    images = data.get(\"images\", {})\n                    img_b64 = images.get(\"encoded\", \"\")\n                    img_id_send = images.get(\"image_id\", -1)\n                    if len(img_b64) > 0:\n                        img_file = BytesIO(base64.b64decode(img_b64))\n                        # æ–¹å¼ä¸€  Image\n                        # im = Image.open(img_file)\n                        # im.save('picture_out.jpg', \"JPEG\")\n                        # æ–¹å¼äºŒ  cv2\n                        img_array = np.frombuffer(img_file.getvalue(), dtype=np.uint8)\n                        im = cv2.imdecode(img_array, cv2.IMREAD_COLOR)\n                        # cv2.imshow('im', im)\n                        # cv2.waitKey(1)\n                        # cv2.destroyAllWindows()\n                        # self.signal_client_msg.emit(client_id, img_id, im)\n\n                        # å‘é€ç»™å¤„ç†çº¿ç¨‹\n                        if len(socket_to_ai_queue) < max_len_queue:\n                            with socket_to_ai_lock:\n                                print(\"socket_to_ai_queue append\")\n                                socket_to_ai_queue.append((client_id, img_id_send, im))\n                        else:\n                            print(\"socket_to_ai_queue full\")\n                        # ä»å¤„ç†çº¿ç¨‹æ¥æ”¶ç»“æœ\n                        timeout = 1000  # è¶…æ—¶æ—¶é•¿ 1000*0.003=3ç§’\n                        while timeout:\n                            timeout -= 1\n                            if ai_to_socket_queue.len(client_id):\n                                with ai_to_socket_lock:\n                                    print(\"ai_to_socket_queue pop\")\n                                    img_id_read, count = ai_to_socket_queue.pop(client_id)\n                                    if img_id_send == img_id_read:\n                                        break\n                                    else:\n                                        print(f\"img_id_send:{img_id_send} != img_id_read:{img_id_read}\")\n                            else:\n                                await asyncio.sleep(0.003)\n\n                    await self.manager.send_personal_message(f\"You client_id:{client_id}, img_id:{img_id_send}, count:{count}\", websocket)\n            except WebSocketDisconnect:\n                self.manager.disconnect(websocket)\n\n        # å¯åŠ¨ Uvicorn æœåŠ¡å™¨\n        asyncio.create_task(uvicorn.run(self.app, host=\"0.0.0.0\", port=8000))\n\n\nclass ProcessingTask(QObject):\n    def __init__(self):\n        super().__init__()\n\n    def work(self):\n        print(\"work start\")\n        time.sleep(0.1)\n        print(\"work finsh\")\n\n    def send_result(self, client_id, val):\n        if ai_to_socket_queue.len(client_id) < max_len_queue:\n            with ai_to_socket_lock:\n                print(\"ai_to_socket_queue append\")\n                ai_to_socket_queue.add(client_id, val)\n        else:\n            print(\"ai_to_socket_queue full\")\n\n    def long_running(self):\n        count = 0\n        print(f'ProcessingTask running')\n        while True:\n            if len(socket_to_ai_queue) > 0:\n                with socket_to_ai_lock:\n                    print(\"socket_to_ai_lock popleft\")\n                    client_id, img_id, im = socket_to_ai_queue.popleft()\n                print(f\"thread count:{count}\")\n                count += 1\n                self.work()\n                self.send_result(client_id, (img_id, count))\n            else:\n                time.sleep(0.003)\n\n```\n\n```python\n# IDQueue.py\nfrom collections import OrderedDict, deque\n\nclass IDQueue:\n    def __init__(self):\n        self.queue_dict = OrderedDict()\n        self.queue_lengths = {}\n\n    def add(self, id, item):\n        if id not in self.queue_dict:\n            self.queue_dict[id] = deque()\n            self.queue_lengths[id] = 0\n        self.queue_dict[id].append(item)\n        self.queue_lengths[id] += 1\n        self.queue_dict.move_to_end(id)\n\n    def pop(self, id):\n        if id not in self.queue_dict or not self.queue_dict[id]:\n            return None\n        item = self.queue_dict[id].popleft()\n        self.queue_lengths[id] -= 1\n        if self.queue_lengths[id] == 0:\n            del self.queue_dict[id]\n            del self.queue_lengths[id]\n        return item\n\n    def len(self, id):\n        return self.queue_lengths.get(id, 0)\n\n    def get_queue(self, id):\n        return self.queue_dict.get(id, None)\n\n    def clear(self, id):\n        print(f\"IDQueue {id} clear\")\n        if id in self.queue_dict:\n            del self.queue_dict[id]\n            del self.queue_lengths[id]\n\n\nqueue = IDQueue()\n\n# æ·»åŠ å…ƒç´ \nqueue.add(1, 'apple')\nqueue.add(1, 'banana')\nqueue.add(2, 'cherry')\nqueue.add(2, 'date')\n\n# è·å–é˜Ÿåˆ—é•¿åº¦\nprint(queue.len(1))  # Output: 2\nprint(queue.len(2))  # Output: 2\n\n# å¼¹å‡ºå…ƒç´ \nprint(queue.pop(1))  # Output: 'apple'\nprint(queue.pop(2))  # Output: 'cherry'\n\n# è·å–é˜Ÿåˆ—\nprint(list(queue.get_queue(1)))  # Output: ['banana']\nprint(list(queue.get_queue(2)))  # Output: ['date']\n\n```\n\n```python\n# fastapi_websockets_client1.py\nimport asyncio\nimport base64, json\nimport time\nimport websockets\n\nlast_time = time.time()\nlast_step = 0\n\n\ndef ptime():\n    global last_time, last_step\n    now = time.time()\n    print(f\"step{last_step}: {now - last_time}s    now: {now}\")\n    last_time = now\n    last_step += 1\n\n\nasync def send_image(client_id, filename):\n    async with websockets.connect(f'ws://127.0.0.1:8000/ws_bytes/{client_id}') as websocket:\n        # æ›¿æ¢ä¸ºä½ çš„å›¾ç‰‡æ–‡ä»¶è·¯å¾„\n        for i in range(0, 20):\n            with open(filename, 'rb') as imgfile:\n                base64_bytes = base64.b64encode(imgfile.read())\n                base64_encoded = base64_bytes.decode()\n            data = {\n                'hard_info': {\n                    'num': 1,\n                    \"name\": \"1å·å·¥ä½\",\n                    'ip': \"192.168.0.10\"\n                },\n                'images': {\n                        'camera_index': 1,\n                        'image_id': i,\n                        'encoded': base64_encoded\n                }\n            }\n            print(f\"start{i}\")\n            await websocket.send(json.dumps(data))\n            response = await websocket.recv()\n            print(response)\n            ptime()\n\n\n# æ›¿æ¢ä¸ºä½ æƒ³è¦ä½¿ç”¨çš„å®¢æˆ·ç«¯ ID\nclient_id = 1\nimg_path = 'picture_in.jpg'\nasyncio.get_event_loop().run_until_complete(send_image(client_id, img_path))\n```\n\n\n## 3.æœåŠ¡å™¨ç«¯è¯´æ˜\n\næ–‡ä»¶ï¼š pyqt_app.py  web_api.py  IDQueue.py\n\n\nä¸»çº¿ç¨‹ï¼š  PyQtç•Œé¢\nå­çº¿ç¨‹1ï¼š  **WebTask**  uvicorn + fastapi\nå­çº¿ç¨‹2 ï¼š **ProcessingTask**  ç®—æ³•\n\n\næ•°æ®æµä¸€ï¼šä»websocketåˆ°è®¡ç®—çº¿ç¨‹\n```\nwebsocket1       ---\nwebsocket2       ---==== é˜Ÿåˆ— ====    è®¡ç®—çº¿ç¨‹\nwebsocket3       ---\n```\n\næ•°æ®æµäºŒï¼šä»è®¡ç®—çº¿ç¨‹åˆ°websocket\n```\n                                          ---    websocket1\nè®¡ç®—çº¿ç¨‹  ==== IDQueue å¸¦socket Idçš„é˜Ÿåˆ— ====---    websocket2\n                                          ---    websocket3\n```\n\n\n## 4.å®¢æˆ·ç«¯\n\nfastapi_websockets_client.py\n\nå¤šå¤åˆ¶å‡ ä»½ï¼Œä¿®æ”¹`client_id = 1`ä¸ºå…¶ä»–æ•°å­—ã€‚\n\n## 5.æµ‹è¯•\n\n1å·ç»ˆç«¯è¿è¡Œ\n\n```bash\npython  pyqt_app.py\n```\n\n1å·ç»ˆç«¯è¿è¡ŒæœåŠ¡å™¨\n\n```bash\npython  pyqt_app.py\n```\n\n2å·ç»ˆç«¯è¿è¡Œå®¢æˆ·ç«¯1\n\n```bash\npython  fastapi_websockets_client1.py\n```\n\n3å·ç»ˆç«¯è¿è¡Œå®¢æˆ·ç«¯2\n\n```bash\npython  fastapi_websockets_client2.py\n```\n\nå®¢æˆ·ç«¯æ—¥å¿—\n\n![client_log.png](client_log.png)","tags":["Python"]},{"title":"PyQtåˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼","url":"/2024/08/25/PyQtåˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼/","content":"\nå‚è€ƒé“¾æ¥ [stackoverflow](https://stackoverflow.com/questions/6783194/background-thread-with-qthread-in-pyqt)\n\n```python\nimport sys\nimport time\n\nfrom PyQt5.QtCore import (QCoreApplication, QObject, QRunnable, QThread,\n                          QThreadPool, pyqtSignal)\n\n\n# Subclassing QThread\n# http://qt-project.org/doc/latest/qthread.html\nclass AThread(QThread):\n\n    def run(self):\n        count = 0\n        while count < 5:\n            time.sleep(1)\n            print(\"A Increasing\")\n            count += 1\n\n# Subclassing QObject and using moveToThread\n# http://blog.qt.digia.com/blog/2007/07/05/qthreads-no-longer-abstract\nclass SomeObject(QObject):\n\n    finished = pyqtSignal()\n\n    def long_running(self):\n        count = 0\n        while count < 5:\n            time.sleep(1)\n            print(\"B Increasing\")\n            count += 1\n        self.finished.emit()\n\n# Using a QRunnable\n# http://qt-project.org/doc/latest/qthreadpool.html\n# Note that a QRunnable isn't a subclass of QObject and therefore does\n# not provide signals and slots.\nclass Runnable(QRunnable):\n\n    def run(self):\n        count = 0\n        app = QCoreApplication.instance()\n        while count < 5:\n            print(\"C Increasing\")\n            time.sleep(1)\n            count += 1\n        app.quit()\n\n\ndef using_q_thread():\n    app = QCoreApplication([])\n    thread = AThread()\n    thread.finished.connect(app.exit)\n    thread.start()\n    sys.exit(app.exec_())\n\ndef using_move_to_thread():\n    app = QCoreApplication([])\n    objThread = QThread()\n    obj = SomeObject()\n    obj.moveToThread(objThread)\n    obj.finished.connect(objThread.quit)\n    objThread.started.connect(obj.long_running)\n    objThread.finished.connect(app.exit)\n    objThread.start()\n    sys.exit(app.exec_())\n\ndef using_q_runnable():\n    app = QCoreApplication([])\n    runnable = Runnable()\n    QThreadPool.globalInstance().start(runnable)\n    sys.exit(app.exec_())\n\nif __name__ == \"__main__\":\n    # using_q_thread()\n    using_move_to_thread()\n    # using_q_runnable()\n\n```","tags":["PyQt"]},{"title":"Jetsonå®‰è£…USBè½¬RS232ä¸²å£é©±åŠ¨","url":"/2024/07/03/Jetsonå®‰è£…USBè½¬RS232ä¸²å£é©±åŠ¨/","content":"\nUSBè½¬ä¸²å£èŠ¯ç‰‡ä½¿ç”¨ **pl2303**\n\n## 1.ç¯å¢ƒ\n\nç¡¬ä»¶:\n\n* jetson nano\n* USBè½¬RS232\n\nä¸²å£è°ƒè¯•è½¯ä»¶ï¼š\n\nå¸¦uiç±»ï¼šcutecomã€putty\n\nå‘½ä»¤è¡Œï¼šminicomã€screen\n\nå…ˆç”¨è°ƒè¯•è½¯ä»¶æµ‹è¯•ï¼Œç³»ç»Ÿè‡ªå¸¦çš„é©±åŠ¨æœ‰é—®é¢˜å†è¿›è¡Œä¸‹é¢çš„æ“ä½œã€‚\n\n## 2.æˆ‘é‡åˆ°çš„é—®é¢˜\n\nå…ˆç”¨çš„usbè½¬RS232ï¼ŒèŠ¯ç‰‡è¯•CH340ï¼Œå‡ºç°çš„é—®é¢˜æ˜¯ï¼šæ³¢ç‰¹ç‡115200ï¼Œwindowsä¸­æ”¶åˆ°çš„æ•°æ®æ­£å¸¸ã€‚Jetsonæ”¶åˆ°çš„æ•°é‡å·®ä¸å¤šï¼Œä½†æ•°æ®å…¨éƒ¨é”™è¯¯ã€‚æ”¶å‘å¦‚ä¸‹ï¼š\n\n![jetson_ch340_error](jetson_ch340_error.jpeg)\n\nå‘é€'1'æ¥æ”¶0x11ã€‚éšåå†WCHæ²æ’å®˜ç½‘ä¸‹é©±åŠ¨ï¼Œç¼–è¯‘æ›¿æ¢ã€‚è°ƒè¯•åŠ©æ‰‹æµ‹è¯•æ­£å¸¸ï¼Œä½†æ¥åˆ°å®é™…è®¾å¤‡ä¸Šä½¿ç”¨æ•°æ®è¿˜æ˜¯ä¹±ç ï¼Œé‚æ”¾å¼ƒä½¿ç”¨ã€‚\n\næ¢PL2303ï¼Œwindowséœ€è¦ç­‰ä¸€ä¼šæ‰èƒ½è‡ªåŠ¨å®‰è£…é©±åŠ¨ã€‚è€Œjetsonä¸èƒ½æ­£å¸¸æŒ‚è½½åˆ°ttyUSBxã€‚`dmesg`æŸ¥çœ‹åªèƒ½åˆ°usb 1-2.1: SerialNumber: CMCVe12CJ06ï¼Œé‡æ–°ç¼–è¯‘å’Œæ›¿æ¢é©±åŠ¨åï¼Œæ˜¾ç¤ºattachedåˆ°ttyUSB0ï¼Œé€šè¿‡puttyæŸ¥çœ‹è®¾å¤‡æ•°æ®ï¼Œæ¥æ”¶æ­£å¸¸ã€‚\n\n```bash\n[ 1640.374193] usb 1-2.1: new full-speed USB device number 8 using tegra-xusb\n[ 1640.398877] usb 1-2.1: New USB device found, idVendor=067b, idProduct=23a3\n[ 1640.398894] usb 1-2.1: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[ 1640.398905] usb 1-2.1: Product: USB-Serial Controller\n[ 1640.398914] usb 1-2.1: Manufacturer: Prolific Technology Inc.\n[ 1640.398923] usb 1-2.1: SerialNumber: CMCVe12CJ06\n[ 3483.947952] usbserial: USB Serial deregistering driver pl2303\n[ 3483.948103] usbcore: deregistering interface driver pl2303\n[ 3500.329161] pl2303: loading out-of-tree module taints kernel.\n[ 3500.335716] usbcore: registered new interface driver pl2303\n[ 3500.335756] usbserial: USB Serial support registered for pl2303\n[ 3500.335830] pl2303 1-2.1:1.0: pl2303 converter detected\n[ 3500.336221] usb 1-2.1: pl2303 converter now attached to ttyUSB0\n```\n\n## 3.åŸºç¡€\n\n`dmesg` å…ˆæ’æ‹”USBï¼Œå†ä½¿ç”¨æŒ‡ä»¤æŸ¥çœ‹ç³»ç»Ÿå˜åŒ–ä¿¡æ¯\n\n`lsusb` æŸ¥çœ‹USBæ¥å£ç¡¬ä»¶åˆ—è¡¨\n\n`ls /dev` æŸ¥çœ‹ç¡¬ä»¶è®¾å¤‡åˆ—è¡¨\n\n`sudo lsusb -v -d 067b:23a3` æŸ¥çœ‹æŸä¸ªå…·ä½“è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯\n\n`lsmod`  æ˜¾ç¤ºå·²è½½å…¥ç³»ç»Ÿçš„æ¨¡å— \n\n`sudo rmmod pl2303` å¸è½½æ¨¡å—\n\n`insmod` ä¸€æ¬¡åªèƒ½åŠ è½½ç‰¹å®šçš„ä¸€ä¸ªè®¾å¤‡é©±åŠ¨ï¼Œä¸”éœ€è¦é©±åŠ¨çš„å…·ä½“åœ°å€ã€‚å†™æ³•ä¸ºï¼š\n\n```bash\ninsmod drv.ko\n```\n\n`modprobe` åˆ™å¯ä»¥ä¸€æ¬¡å°†æœ‰ä¾èµ–å…³ç³»çš„é©±åŠ¨å…¨éƒ¨åŠ è½½åˆ°å†…æ ¸ã€‚ä¸åŠ é©±åŠ¨çš„å…·ä½“åœ°å€ï¼Œä½†éœ€è¦åœ¨å®‰è£…æ–‡ä»¶ç³»ç»Ÿæ—¶æ˜¯æŒ‰ç…§make modues_installçš„æ–¹å¼å®‰è£…é©±åŠ¨æ¨¡å—çš„ã€‚é©±åŠ¨è¢«å®‰è£…åœ¨/lib/modules/$(uname -r)/...ä¸‹ã€‚å†™æ³•ä¸ºï¼š\n\n```bash\nmodprob drv\n```\n\nmodprobe å’Œinsmodä¸€æ ·éƒ½æ˜¯ç”¨æ¥åŠ è½½å†…æ ¸moduleçš„ä¸è¿‡modprobeæ¯”è¾ƒæ™ºèƒ½ï¼Œå®ƒå¯ä»¥æ ¹æ®moduleçš„ä¾èµ–æ€§æ¥è‡ªåŠ¨ä¸ºä½ åŠ è½½ï¼›è€Œinsmodå°±åšä¸åˆ°è¿™ç‚¹\n\n\n\n## 4.ä¸‹è½½é©±åŠ¨\n\nä» [UGREENç»¿è”](https://www.lulian.cn/download/tag/pl2303qudong) ç½‘ä¸‹è½½é©±åŠ¨ï¼Œå¹¶è§£å‹ã€‚å†…å®¹å¦‚ä¸‹ï¼š\n\n![pl2303_driver](pl2303_driver.png)\n\n## 5.æŸ¥çœ‹jetsonå†…æ ¸ç‰ˆæœ¬\n\n```bash\nuname -a\n```\n\nå¯ä»¥çœ‹åˆ° 4.9.337\n\n```bash\nLinux booster 4.9.337-tegra #1 SMP PREEMPT Thu Jun 8 21:19:14 PDT 2023 aarch64 aarch64 aarch64 GNU/Linux\n```\n\n## 6.å°†é©±åŠ¨ä¸Šä¼ åˆ°Jetson\n\nä»PL2303G_Linux_Driver_v1.0.6ä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ª4.9ç‰ˆçš„ï¼Œé€‰ä¸€ä¸ªï¼ˆå¤±è´¥äº†å†è¯•å¦ä¸€ä¸ªï¼‰ä½¿ç”¨MobaXtermæˆ–å…¶ä»–è½¯ä»¶ä¸Šä¼ åˆ°jetsonã€‚\n\n## 7.ç¼–è¯‘å®‰è£…\n\n```bash\ncd 4.9_ok\nmake\n```\n\nå¯ä»¥çœ‹åˆ°æˆåŠŸç¼–è¯‘å‡ºpl2303.koæ–‡ä»¶\n\næ¥ä¸‹æ¥å¸è½½æ—§çš„ï¼Œå†å®‰è£…æ–°ç¼–è¯‘çš„ã€‚\n\n```bash\nsudo rmmod pl2303\nsudo insmod pl2303.ko\n```\n\ndmesg | tail æŸ¥çœ‹æ˜¯å¦attachåˆ°ttyUSBx\n\n`usb 1-2.1: pl2303 converter now attached to ttyUSB0`\n\n## 8.æµ‹è¯•\n\n```bash\nsudo putty\n```\n\nè®¾ç½®æ³¢ç‰¹ç‡ï¼Œåˆšå¼€å§‹å¯ä»¥å°†RS232çš„Txå’ŒRxå¼•è„šçŸ­æ¥ï¼Œé”®ç›˜æŒ‰ä»€ä¹ˆå±å¹•æ˜¾ç¤ºä»€ä¹ˆè¯´æ˜é€šä¿¡æ­£å¸¸ã€‚\n\næ›¿æ¢è‡ªå¸¦é©±åŠ¨\n\n```bash\nsudo cp pl2303.ko /lib/modules/4.9.337-tegra/kernel/drivers/usb/serial/\n```\n\n\n\n## 9.ä¿®æ”¹æƒé™å…ROOT\n\nå‚è€ƒ[github](https://github.com/Slamtec/rplidar_ros/blob/ros2/scripts/create_udev_rules.sh)\n\nä»¥rplidar.rulesä¸ºæ¨¡æ¿ï¼Œä¿®æ”¹idVendorå’ŒidProductçš„å€¼ï¼Œå¦‚ä¸‹ï¼š\n\n```bash\nKERNEL==\"ttyUSB*\", ATTRS{idVendor}==\"067b\", ATTRS{idProduct}==\"23a3\", MODE:=\"0777\", SYMLINK+=\"mygps\"\n```\n\nå¯ç”¨è§„åˆ™\n\n```bash\nsudo service udev reload\nsudo service udev restart\nsudo udevadm control --reload && sudo udevadm trigger\n```\n\næŸ¥çœ‹è§„åˆ™æ˜¯å¦åº”ç”¨æˆåŠŸ\n\n```bash\nll /dev\nlrwxrwxrwx   1 root root           7 7æœˆ   2 14:06 mygps -> ttyUSB0\n```\n\næµ‹è¯•\n\n```bash\nputty\n```\n\né‡å¯ï¼Œå¦‚æœä¸èƒ½æ­£å¸¸æŒ‚è½½ï¼Œéœ€è¦ä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤ï¼š\n\n```bash\nmodprobe\n```\n","tags":["Jetson"]},{"title":"ros2åŸºç¡€æ•™ç¨‹","url":"/2024/07/03/ros2åŸºç¡€æ•™ç¨‹/","content":"\n## 1.åŸºç¡€çŸ¥è¯†\n### 1.1å·¥ä½œç©ºé—´\n\n* åˆ›å»ºå·¥ä½œç©ºé—´\n\n  ä¸€ä¸ªå­˜æ”¾é¡¹ç›®å¼€å‘ç›¸å…³æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œä¹Ÿæ˜¯å¼€å‘è¿‡ç¨‹ä¸­å­˜æ”¾æ‰€æœ‰èµ„æ–™çš„å¤§æœ¬è¥ã€‚ \n\n```bash\n# é€‰æ‹©ä¸€ä¸ªå­˜å‚¨çš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨æ ¹ç›®å½•\ncd ~/yahboomcar_ros2_ws\n# åˆ›å»ºå·¥ä½œçš„ç©ºé—´\nmkdir -p yahboomcar_ws/src\ncd yahboomcar_ws\n```\n\n* ç¼–è¯‘\n\n```bash\ncolcon build\n```\n\n* è®¾ç½®ç¯å¢ƒå˜é‡\n\n```bash\n# ä»…åœ¨å½“å‰ç»ˆç«¯ç”Ÿæ•ˆ\nsource install/setup.bash   \n# æ‰€æœ‰ç»ˆç«¯å‡ç”Ÿæ•ˆ\necho \"source ~/yahboomcar_ros2_ws/yahboomcar_ws/install/setup.bash\" >> ~/.bashrc    \n```\n\n\n\n### 1.2åŠŸèƒ½åŒ…\n\n æŠŠä¸åŒåŠŸèƒ½çš„ä»£ç åˆ’åˆ†åˆ°ä¸åŒçš„åŠŸèƒ½åŒ…ä¸­ï¼Œå°½é‡é™ä½ä»–ä»¬ä¹‹é—´çš„è€¦åˆå…³ç³» \n\n* åˆ›å»ºc++åŠŸèƒ½åŒ…\n\n```bash\ncd ~/yahboomcar_ros2_ws/yahboomcar_ws/src\n# åˆ›å»ºC++åŠŸèƒ½åŒ…\nros2 pkg create pkg_helloworld_cpp --build-type ament_cmake --dependencies rclcpp --node-name helloworld  \n```\n\n* åˆ›å»ºpythonåŠŸèƒ½åŒ…\n\n```bash\ncd ~/yahboomcar_ros2_ws/yahboomcar_ws/src\nros2 pkg create pkg_helloworld_py --build-type ament_python --dependencies rclpy --node-name helloworld\n```\n\n* ç›®å½•ç»“æ„\n\n```bash\nWorkSpace --- è‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´ã€‚\n    |--- buildï¼šå­˜å‚¨ä¸­é—´æ–‡ä»¶çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹ä¼šä¸ºæ¯ä¸€ä¸ªåŠŸèƒ½åŒ…åˆ›å»ºä¸€ä¸ªå•ç‹¬å­ç›®å½•ã€‚\n    |--- installï¼šå®‰è£…ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹ä¼šä¸ºæ¯ä¸€ä¸ªåŠŸèƒ½åŒ…åˆ›å»ºä¸€ä¸ªå•ç‹¬å­ç›®å½•ã€‚\n    |--- logï¼šæ—¥å¿—ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ—¥å¿—æ–‡ä»¶ã€‚\n    |--- srcï¼šç”¨äºå­˜å‚¨åŠŸèƒ½åŒ…æºç çš„ç›®å½•ã€‚\n        |-- C++åŠŸèƒ½åŒ…\n            |-- package.xmlï¼šåŒ…ä¿¡æ¯ï¼Œæ¯”å¦‚:åŒ…åã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–é¡¹ã€‚\n            |-- CMakeLists.txtï¼šé…ç½®ç¼–è¯‘è§„åˆ™ï¼Œæ¯”å¦‚æºæ–‡ä»¶ã€ä¾èµ–é¡¹ã€ç›®æ ‡æ–‡ä»¶ã€‚\n            |-- srcï¼šC++æºæ–‡ä»¶ç›®å½•ã€‚\n            |-- includeï¼šå¤´æ–‡ä»¶ç›®å½•ã€‚\n            |-- msgï¼šæ¶ˆæ¯æ¥å£æ–‡ä»¶ç›®å½•ã€‚\n            |-- srvï¼šæœåŠ¡æ¥å£æ–‡ä»¶ç›®å½•ã€‚\n            |-- actionï¼šåŠ¨ä½œæ¥å£æ–‡ä»¶ç›®å½•ã€‚\n        |-- PythonåŠŸèƒ½åŒ…\n            |-- package.xmlï¼šåŒ…ä¿¡æ¯ï¼Œæ¯”å¦‚:åŒ…åã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–é¡¹ã€‚\n            |-- setup.pyï¼šä¸C++åŠŸèƒ½åŒ…çš„CMakeLists.txtç±»ä¼¼ã€‚\n            |-- setup.cfgï¼šåŠŸèƒ½åŒ…åŸºæœ¬é…ç½®æ–‡ä»¶ã€‚\n            |-- resourceï¼šèµ„æºç›®å½•ã€‚\n            |-- testï¼šå­˜å‚¨æµ‹è¯•ç›¸å…³æ–‡ä»¶ã€‚\n            |-- åŠŸèƒ½åŒ…åŒåç›®å½•ï¼šPythonæºæ–‡ä»¶ç›®å½•ã€‚\n```\n\n* å…¶ä»–æ–‡ä»¶\n\n```bash\n|-- C++æˆ–PythonåŠŸèƒ½åŒ…\n    |-- launchï¼šå­˜å‚¨launchæ–‡ä»¶ã€‚\n    |-- rvizï¼šå­˜å‚¨rviz2é…ç½®ç›¸å…³æ–‡ä»¶ã€‚\n    |-- urdfï¼šå­˜å‚¨æœºå™¨äººå»ºæ¨¡æ–‡ä»¶ã€‚\n    |-- paramsï¼šå­˜å‚¨å‚æ•°æ–‡ä»¶ã€‚\n    |-- worldï¼šå­˜å‚¨ä»¿çœŸç¯å¢ƒç›¸å…³æ–‡ä»¶ã€‚\n    |-- mapï¼šå­˜å‚¨å¯¼èˆªæ‰€éœ€åœ°å›¾æ–‡ä»¶ã€‚\n    |-- ......\n```\n\n\n\n### 1.3èŠ‚ç‚¹\n\n æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯¹åº”æŸä¸€å•ä¸€çš„åŠŸèƒ½æ¨¡å—  (ä¾‹å¦‚ï¼šé›·è¾¾é©±åŠ¨èŠ‚ç‚¹å¯èƒ½è´Ÿè´£å‘å¸ƒé›·è¾¾æ¶ˆæ¯ï¼Œæ‘„åƒå¤´é©±åŠ¨èŠ‚ç‚¹å¯èƒ½è´Ÿè´£å‘å¸ƒå›¾åƒæ¶ˆæ¯) \n\n ä¸€ä¸ªå®Œæ•´çš„æœºå™¨äººç³»ç»Ÿå¯èƒ½ç”±è®¸å¤šååŒå·¥ä½œçš„èŠ‚ç‚¹ç»„æˆï¼ŒROS2ä¸­çš„å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶(C++ç¨‹åºæˆ–Pythonç¨‹åº)å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ã€‚ \n\n åœ¨é€šä¿¡æ—¶ï¼Œä¸è®ºé‡‡ç”¨ä½•ç§æ–¹å¼ï¼Œé€šä¿¡å¯¹è±¡çš„æ„å»ºéƒ½ä¾èµ–äºèŠ‚ç‚¹(Node) \n\n`pkg_helloworld_py/helloworld.py` æ¥ç¼–å†™èŠ‚ç‚¹åŠŸèƒ½\n\n\n\nsetup.py å®šä¹‰å£å…¥ç‚¹\n\n```python\nentry_points = {\n\t'console_scripts':[\n        # å…¥å£å‡½æ•°å\n        'helloworld = pkg_helloworld_py.helloworld:main'\n        # å¯æ‰§è¡Œæ–‡ä»¶å      åŠŸèƒ½åŒ…åç§°      ç¼–å†™èŠ‚ç‚¹åŠŸèƒ½çš„pythonæ–‡ä»¶åç§°\n    ],\n},\n```\n\n* åªç¼–è¯‘ç‰¹å®šåŠŸèƒ½åŒ…\n\n```bash\ncd ~/yahboomcar_ros2_ws/yahboomcar_ws\ncolcon build --packages-select pkg_helloworld_py\nsource install/setup.bash\n```\n\n* å¯åŠ¨å•ä¸ªèŠ‚ç‚¹\n\n```bash\nros2 run pkg_helloworld_py helloworld\n```\n\n* å¯åŠ¨å¤šä¸ªèŠ‚ç‚¹\n\n```bash\n# ç¤ºä¾‹ä¸ºå…¶ä»–é¡¹ç›®\nros2 launch rplidar_ros rplidar_s2_lanuch.py\n```\n\n\n\n## 2.æ¿€å…‰é›·è¾¾\n\n### 2.1å‘å¸ƒé›·è¾¾æ‰«ææ•°æ®\n\n* è¿›å…¥å·¥ä½œç©ºé—´ `cd ~/ros2_ws/src`\n\n* æ‹‰å–é¡¹ç›®ä»£ç \n\n```bash\ngit clone -b ros2 https://github.com/Slamtec/rplidar_ros.git\n```\n\næ¥ä¸‹æ¥çš„æ“ä½œå¯ä»¥æŸ¥çœ‹é¡¹ç›®ä¸­çš„README.mdæ–‡ä»¶ã€‚æ³¨æ„è¿è¡Œæµ‹è¯•æ—¶éœ€è¦å¢åŠ ä¸²å£ç«¯å£è®¾ç½® ï¼š`serial_port:=/dev/rplidar`\n\n* ä¸å¸¦ç•Œé¢\n\n```bash\nros2 run rplidar_ros rplidar_node serial_port:=/dev/rplidar\n```\n\næˆ–\n\n```bash\nros2 launch rplidar_ros rplidar_s2_launch.py serial_port:=/dev/rplidar\n```\n\n* å¸¦ç•Œé¢\n\n```bash\nros2 launch rplidar_ros view_rplidar_s2_launch.py serial_port:=/dev/rplidar\n```\n\n\n\n### 2.2è®¢é˜…é›·è¾¾æ•°æ®å¹¶åˆ¤æ–­æœ€å°è·ç¦»\n\n* åˆ›å»ºpythonåŠŸèƒ½åŒ…\n\n```bash\ncd ~/ros2_ws/src\nros2 pkg create rplidar_warning --build-type ament_python --dependencies rclpy --node-name rplidar_warning\n```\n\n* ä¿®æ”¹æ–‡ä»¶å†…å®¹å®ç°è®¢é˜…åŠæœ€å°è·ç¦»åˆ¤æ–­åŠŸèƒ½\n\n~/ros2_ws/src/rplidar_warning/rplidar_warning/rplidar_warning.py\n\n```python\n#!/usr/bin/env python\n# coding:utf-8\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import LaserScan\nfrom std_msgs.msg import Bool\nimport numpy as np\nimport math\nRAD2DEG = 180 / math.pi\n\nclass laserWarning(Node):\n    def __init__(self,name):\n        super().__init__(name)\n\n        self.Buzzer_state = False\n        self.laserAngle = 70\n        self.ResponseDist = 0.5\n        self.pub_Buzzer = self.create_publisher(Bool, '/Buzzer', 1)\n        self.sub_laser = self.create_subscription(LaserScan, '/scan', self.laserCallback, 1000)\n\n    def laserCallback(self, scan_data):\n        if not isinstance(scan_data, LaserScan): return\n        # è®°å½•æ¿€å…‰æ‰«æå¹¶å‘å¸ƒæœ€è¿‘ç‰©ä½“çš„ä½ç½®ï¼ˆæˆ–æŒ‡å‘æŸç‚¹ï¼‰\n        # Record the laser scan and publish the position of the nearest object (or point to a point)\n        ranges = np.array(scan_data.ranges)\n        # åˆ›å»ºè·ç¦»åˆ—è¡¨ï¼Œå°†æ£€æµ‹èŒƒå›´å†…çš„æœ‰æ•ˆè·ç¦»æ”¾å…¥åˆ—è¡¨ä¸­\n        # create distance list, put the effective distance within the detection range into the list\n        minDistList = []\n        # åˆ›å»ºåºåˆ—å·ï¼Œå°†æœ‰æ•ˆè·ç¦»å¯¹åº”çš„IDæ”¾å…¥åˆ—è¡¨ä¸­\n        # Create a serial number and place the ID corresponding to the valid distance in the list\n        minDistIDList = []\n        # æŒ‰è·ç¦»æ’åºä»¥æ£€æŸ¥ä»è¾ƒè¿‘çš„ç‚¹åˆ°è¾ƒè¿œçš„ç‚¹æ˜¯å¦æ˜¯çœŸå®çš„ä¸œè¥¿\n        # if we already have a last scan to compare to:\n        for i in range(len(ranges)):\n            angle = (scan_data.angle_min + scan_data.angle_increment * i) * RAD2DEG\n            # if angle > 90: print \"i: {},angle: {},dist: {}\".format(i, angle, scan_data.ranges[i])\n            # é€šè¿‡æ¸…é™¤ä¸éœ€è¦çš„æ‰‡åŒºçš„æ•°æ®æ¥ä¿ç•™æœ‰æ•ˆçš„æ•°æ®\n            if abs(angle) > (180 - self.laserAngle):\n                minDistList.append(ranges[i])\n                minDistIDList.append(angle)\n        if len(minDistList) == 0: return\n        # æ‰¾åˆ°æœ€å°è·ç¦»\n        # Find the minimum distance\n        minDist = min(minDistList)\n        # æ‰¾åˆ°æœ€å°è·ç¦»å¯¹åº”çš„ID\n        # Find the ID corresponding to the minimum distance\n        minDistID = minDistIDList[minDistList.index(minDist)]\n        self.get_logger().info(f\"find minimum {minDist} {minDistID}\")\n\n        if minDist <= self.ResponseDist:\n            if self.Buzzer_state == False:\n                b = Bool()\n                b.data = True\n                self.pub_Buzzer.publish(b)\n                self.Buzzer_state = True\n        else:\n            if self.Buzzer_state == True:\n                self.pub_Buzzer.publish(Bool())\n                self.Buzzer_state = False\n\n\n    def dynamic_reconfigure_callback(self, config, level):\n        self.laserAngle = config['laserAngle']\n        self.ResponseDist = config['ResponseDist']\n        return config\n\n\ndef main():\n    rclpy.init()\n    tracker = laserWarning(\"laser_Warning\")\n    rclpy.spin(tracker)\n    tracker.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n```\n\n\n\n* åˆ é™¤ build install log æ–‡ä»¶å¤¹\n\n```bash\nrm -rf build install log\n```\n\n* ç¼–è¯‘æ‰€æœ‰åŠŸèƒ½åŒ…\n\n```bash\ncolcon build\n```\n\n* ç¼–è¯‘é€‰ä¸­çš„åŠŸèƒ½åŒ…(é€‰æ‹©ä½¿ç”¨)\n\n```bash\ncolcon build --packages-select pkg_helloworld_py\n```\n\n* å¼€å¯ä¸¤ä¸ªç»ˆç«¯ï¼Œå¹¶ä¸”éƒ½æ›´æ–°ä¸€æ¬¡ç¯å¢ƒå˜é‡\n\n```bash\nsource install/setup.bash\n```\n\n* ç»ˆç«¯1å‘å¸ƒé›·è¾¾æ•°æ®\n\n```bash\nros2 launch rplidar_ros view_rplidar_s2_launch.py serial_port:=/dev/rplidar\n```\n\n* ç»ˆç«¯2è®¢é˜…é›·è¾¾æ•°æ®\n\n```bash\nros2 run rplidar_warning rplidar_warning\n```\n","tags":["ROS2"]},{"title":"åœ¨dockerä¸­è¿è¡ŒROS2å®¹å™¨å¹¶æµ‹è¯•æ€å²šæ¿€å…‰é›·è¾¾","url":"/2024/07/03/åœ¨dockerä¸­è¿è¡ŒROS2å®¹å™¨å¹¶æµ‹è¯•æ€å²šæ¿€å…‰é›·è¾¾/","content":"\n## 1.dockerå®‰è£…åŠåŸºç¡€çŸ¥è¯†\n\n[dockerå®‰è£…](https://www.yahboom.com/build.html?id=7178&cid=586)\n\n[å›½å†…é•œåƒç«™ç‚¹]( https://linux.do/t/topic/114516)\n\n[yahboomtechnology/ros2-baseé•œåƒ](https://hub.docker.com/r/yahboomtechnology/ros2-base/tags)\n\n[å¯¼å‡ºé•œåƒå¹¶å‹ç¼©ã€è§£å‹å¹¶å¯¼å…¥é•œåƒ](https://blog.csdn.net/qq_34777982/article/details/102454739)\n\n[åˆ›å»ºå®¹å™¨ ç¡¬ä»¶æŒ‚è½½ GUIæ˜¾ç¤º](https://www.yahboom.com/build.html?id=7182&cid=586)  è„šæœ¬ç”¨æ¥åˆ›å»ºå®¹å™¨ï¼Œä»…éœ€è¿è¡Œä¸€æ¬¡ã€‚åæœŸä½¿ç”¨docker start/stopå¼€æ§åˆ¶å®¹å™¨å¯åœ\n\n[åœ¨dockerä¸­ä½¿ç”¨GPIO](https://github.com/NVIDIA/jetson-gpio/tree/master) `--privileged \\` æ­¤é€‰é¡¹ä½¿dockeré•œåƒä½¿ç”¨æ‰€æœ‰å®¿ä¸»æœºçš„ç¡¬ä»¶\n\nå»ºç«‹[udevè§„åˆ™](https://github.com/Slamtec/rplidar_ros/blob/ros2/scripts/rplidar.rules)(å°†æŒ‡å®šttyUSBæ˜ å°„ä¸ºrplidarå¹¶ä¿®æ”¹[ä½¿ç”¨æƒé™](https://www.small09.top/posts/210311-serialmodeandudevinlinux/))\n\n```bash\n~$ ls -al /dev/ttyUSB0 /dev/rplidar \nlrwxrwxrwx 1 root root         7 6æœˆ  25 09:14 /dev/rplidar -> ttyUSB0\ncrwxrwxrwx 1 root dialout 188, 0 6æœˆ  25 09:14 /dev/ttyUSB0\n```\n\nåˆ›å»ºdockerçš„è„šæœ¬ create.sh  æ­¤æ–¹å¼ä¸ä¼šå°†ttyUSB0 æ˜ å°„ä¸ºrplidarï¼Œä¹Ÿä¸éœ€è¦åœ¨ros2ä¸­æŒ‡å®šä¸²å£\n\n```bash\n!/bin/bash\nxhost +\n\ndocker container run -it \\\n--net=host \\\n--env=\"DISPLAY\" \\\n--env=\"QT_X11_NO_MITSHM=1\" \\\n--privileged \\\n-v /tmp/.X11-unix:/tmp/.X11-unix \\\n-v /home/zy/Code:/root/yahboomcar_ros2_ws/temp \\\n-p 9090:9090 \\\n-p 8888:8888 \\\nyahboomtechnology/ros2-base:2.0.2 /bin/bash\n```\n\n## 2.å¸¸ç”¨æŒ‡ä»¤\n\n```bash\ndockerå¯ä»¥ä½¿ç”¨ç•Œé¢ã€‚æ¯æ¬¡é‡å¯åå¿…é¡»è¦åœ¨VNCè¿œç¨‹æ¡Œé¢ä¸­æ‰“å¼€çš„Terminalåæ‰§è¡Œä¸‹é¢è¿™æ®µæŒ‡ä»¤ï¼Œå¼€å¯GUIè®¿é—®æƒé™ï¼Œå†å¯åŠ¨å®¹å™¨ã€‚\nxhost +local:root\næˆ–\nxhost +\n\næŸ¥çœ‹å®¹å™¨è¿è¡Œæƒ…å†µ\ndocker ps -a\n\nè¿è¡Œå®¹å™¨\ndocker run åé¢åŠ ä¸€å †å‚æ•° åŒ…å«é•œåƒåç§°å’Œå®¹å™¨æ ‡ç­¾\n\nå¯åŠ¨å®¹å™¨  è¿è¡Œè¿‡ä¸€æ¬¡åé¢ä»…éœ€ä½¿ç”¨ç®¡ç†å®¹å™¨æŒ‡ä»¤\ndocker start [IDæˆ–æ ‡ç­¾]\ndocker stop\ndocker rm\n\nå†æ¬¡è¿›å…¥å®¹å™¨\ndocker attach [IDæˆ–æ ‡ç­¾]\næ–°å»ºshellè¿›å…¥å®¹å™¨\ndocker exec -it [å®¹å™¨id] /bin/bash\n\nexit        # å®¹å™¨åœæ­¢é€€å‡º\nctrl+P+Q    # å®¹å™¨ä¸åœæ­¢é€€å‡º\n\nè¿è¡Œè½¯ä»¶ï¼ŒæŸ¥çœ‹èƒ½å¦å¼€å¯GUIç”»é¢\nrviz2\n```\n\n\n\n## 3.è¿›å…¥docker\n\n[ROS2ç¤ºä¾‹æµ‹è¯•](https://book.guyuehome.com/ROS2/1.%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/1.3_ROS2%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95/#ros2_2) åªæŒ‰ROS2ç¤ºä¾‹æµ‹è¯•å°èŠ‚æµ‹è¯•dockerç¯å¢ƒçš„çš„ROS2æ˜¯å¦è¿è¡Œæ­£å¸¸\n\n\n\næ‹‰å–æ€å²šé›·è¾¾åœ¨ROS2ä¸­åº”ç”¨çš„[gitä»“åº“](https://github.com/Slamtec/rplidar_ros/tree/ros2)ï¼Œåˆ‡æ¢åˆ°ros2åˆ†æã€‚æŒ‰README.mdè¯´æ˜å»ºç«‹å’Œç¼–è¯‘é¡¹ç›®ã€‚\n\n```bash\ngit clone -b ros2 https://github.com/Slamtec/rplidar_ros.git\n```\n\næ³¨æ„ï¼š\n\né¡¹ç›®é»˜è®¤ä½¿ç”¨ /dev/ttyUSB0 ï¼Œç„¶è€Œæˆ‘ä»¬åœ¨å»ºç«‹dockerå®¹å™¨æ—¶å°†å®¿ä¸»æœºçš„ttyUSB0æœ€ç»ˆæ˜ å°„ä¸ºdockerä¸­çš„rplidar\n\næ•…æ­¤æ—¶åœ¨dockerä¸­æ‰§è¡Œ\n\n```bash\n~$ ls /dev\nconsole  fd  full  mqueue  null ptmx  pts  random  rplidar  shm  stderr  stdin  stdout  tty  urandom  zero\n```\n\nå‘ç°æ˜¯æ²¡æœ‰ttyUSB0çš„ã€‚\n\n\n\nREADME.mdä¸­çš„è¿è¡ŒæŒ‡ä»¤\n\n```bash\nros2 launch rplidar_ros view_rplidar_s2_launch.py\n```\n\néœ€è¦æŒ‡å®šä¸²å£å·\n\n\n```bash\nros2 launch rplidar_ros view_rplidar_s2_launch.py serial_port:=/dev/rplidar\n```","tags":["ROS2"]},{"title":"jetsonåˆ·æœºæ•‘ç –","url":"/2024/07/03/jetsonåˆ·æœºæ•‘ç –/","content":"\n## 1.çƒ§å½•EMMCå¼•å¯¼\n\nå¦‚æœå¼€æœºä¸æ˜¾ç¤ºNvidiaçš„ç»¿è‰²å›¾ç‰‡ï¼Œè¯´æ˜å¼•å¯¼å›ºä»¶æŸåã€‚è™½ç„¶sdå¡æˆ–Uç›˜ä¸­æœ‰ç³»ç»Ÿï¼Œä½†ç¡¬ä»¶å¹¶ä¸çŸ¥é“è¦å»ä½•å¤„åŠ è½½ã€‚ç°è±¡ä¸ºå¼€æœºæŒ‡ç¤ºç»¿ç¯äº®ï¼Œä½†HDMIæ— æ˜¾ç¤ºï¼ŒUSBæ¥å£æ— ä¾›ç”µï¼ˆé¼ æ ‡ä¸äº®ï¼‰ã€‚é€šè¿‡TTLä¸²å£å¯ä»¥çœ‹åˆ°æœºå™¨ä¸åœçš„é‡å¯ã€‚\n\n[äºšåšæ•™ç¨‹](https://www.yahboom.com/public/upload/upload-html/1710831903/JetsonNano%E7%83%A7%E5%BD%95%E7%B3%BB%E7%BB%9F.html) ä¸­çš„åˆ·æœºçš„æŒ‡ä»¤æˆ‘åœ¨jetson nanoä¸Šå°è¯•å¤±è´¥ã€‚\n\n[NVIDIA SDK Manager](https://docs.nvidia.com/sdk-manager/system-requirements/index.html) æ‰“å¼€é“¾æ¥æŸ¥çœ‹åˆ·å†™jetsonéœ€è¦çš„å®¿ä¸»æœºç³»ç»Ÿè¦æ±‚ï¼Œå¦‚ Jetson nano éœ€è¦ Ubuntu 1804.\n\nä¸‹è½½ [SDK Manager](http://docs.nvidia.com/sdk-manager/download-run-sdkm/index.html) æ­¤è½¯ä»¶å¯ä¸‹è½½éœ€è¦åˆ·æœºçš„å·¥å…·å’Œè½¯ä»¶åŒ…ã€‚\n\nå»ºè®®ä½¿ç”¨ç‰©ç†æœºï¼Œè™šæ‹ŸæœºOracle VM VirtualBoxå‡ºç°å°†USBåˆ†é…ç»™è™šæ‹Ÿæœºï¼Œä½†é€šè¿‡ç•Œé¢å†™å…¥çš„æ—¶å€™ä¼šå‡ºç°USBçŸ­çº¿çš„é—®é¢˜ã€‚\n\nä¹Ÿå¯ä»¥åœ¨ç•Œé¢åˆ·å†™å¤±è´¥åå°è¯•ä½¿ç”¨å‘½ä»¤è¡Œçš„æ–¹å¼ï¼Œéœ€è¦åœ¨SDK Managerä¸‹è½½è½¯ä»¶åŒ…ä¸­æ‰§è¡Œï¼Œå¯å‚è€ƒä¸Šé¢çš„äºšåšæ•™ç¨‹ã€‚\n\nhttps://forums.developer.nvidia.com/t/recover-bootloader-in-nano-4g-b01/277975/4\n\n```bash\nsudo ./flash.sh jetson-nano-qspi mmcblk1p1\n```\n\nå°†è·³çº¿å¸½è¿æ¥åˆ°FC RECå’ŒGNDå¼•è„šï¼Œ æ¥å…¥ç”µæºï¼Œæœ€åå’Œæ’å…¥microUSBæ•°æ®çº¿ã€‚\n\nä¸Šç”µå¼€æœºåä¼šè‡ªåŠ¨è¿›å…¥RECåˆ·æœºæ¨¡å¼ã€‚ \n\nä½¿ç”¨Ubuntuåˆ·æœº\n\n\n## 2.çƒ§å½•ç³»ç»Ÿé•œåƒ\n\nä¸‹è½½[imgç³»ç»Ÿé•œåƒ](https://developer.nvidia.com/embedded/downloads#?tx=$product,jetson_nano) ï¼Œé€‰æ‹©é“¾æ¥ä¸­çš„ SD Card Imageã€‚\n\nçƒ§å½•è¿‡ç¨‹å‚è€ƒä¸Šä¸€å°èŠ‚çš„äºšåšæ•™ç¨‹\n\n\n\n## 3.SDå¡æ‰©å®¹\n\n```bash\nsudo apt install gparted\n```\n\nåœ¨å›¾å½¢ç•Œé¢ç¯å¢ƒä¸‹æ“ä½œã€‚\n\n\n\n## 4.SSHè¿œç¨‹ç™»å½•\n\n[å‚è€ƒé“¾æ¥](https://linuxize.com/post/how-to-enable-ssh-on-ubuntu-18-04)\n\n\n\n## 5.VNCè¿œç¨‹æ¡Œé¢\n\n[äºšåšæ™ºèƒ½](https://www.yahboom.com/build.html?id=6189&cid=586)\n\n\n\n## 6.Jtopçš„å®‰è£…å’Œä½¿ç”¨\n\n[å‚è€ƒ](https://jetsonhacks.com/2023/02/07/jtop-the-ultimate-tool-for-monitoring-nvidia-jetson-devices)\n\n\n","tags":["Jetson"]},{"title":"Ubuntu-RSP1-GNURadio","url":"/2024/05/05/Ubuntu-RSP1-GNURadio/","content":"\nMSI2500 MSI001 RSP1 SoapySDR libmirisdr gr-osmosdr GNURadio Ubuntu\n\n## 1.æ¦‚è¿°\n\nå›½å†…ç‰ˆå…‹éš†ç‰ˆRSP1åœ¨RTL-433å’ŒGNU Radioä¸­çš„ä½¿ç”¨\n\n### windows:\n\nä½¿ç”¨ [SDRuno](https://www.sdrplay.com/softwarehome/) è½¯ä»¶å®‰è£…ç®€å•æ˜“ä¸Šæ‰‹.  (å»ºè®®å…³é—­æˆ–å¸è½½æµæ°“æ€æ¯’è½¯ä»¶)\n\n### Ubuntu: \n\næ— æ³•ä½¿ç”¨ SDRconnec. \n\næŒ‰ç…§ [Rev Space](https://revspace.nl/Msi2500SDR) æ•™ç¨‹ï¼Œå¯å°†å…¶è¯†åˆ«ä¸ºmiriï¼Œä¸”èƒ½æ­£å¸¸é‡‡æ ·ã€‚\n\nä½¿ç”¨æ–¹å¼ä¸€ï¼š [rtl_433](https://github.com/merbanan/rtl_433)\n\nä½¿ç”¨æ–¹å¼äºŒï¼š [GNU Radio](https://www.gnuradio.org/)\n\nä¸¤ç§æ–¹å¼ä¸‹é¢å‡æœ‰ä½¿ç”¨æ•™ç¨‹ã€‚\n\nå¯¹äºubuntuä¸‹æ•´ä¸ªç³»ç»Ÿæ¡†æ¶æˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼š\n\n![Ubuntu_RSP1](Ubuntu_RSP1.png)\n\n\n## 2.Hardware ç¡¬ä»¶\n\nBG7YZF é»„æ·®åˆ›å®¢ç©ºé—´\n\na chinese clone of the SDRPlay RSP1.\n\n![taobao](taobao.jpg)\n\n![screenshot_rsp1](Screenshot_rsp1.jpg)\n\nMS001+MSI2500\n\n10k~2GHz ADC:12bit Bandwidth:10MHz TCXO:0.5ppm\n\n![msi001_msi2500](msi001_msi2500.jpg)\n\n## 3.API é©±åŠ¨\n\nSoapySDR æ˜¯å¦ä¸€ä¸ªå¼€æºçš„SDRç¡¬ä»¶æŠ½è±¡å±‚ï¼Œæ—¨åœ¨æä¾›ä¸€ç§é€šç”¨çš„APIå’Œä¸­é—´ä»¶ï¼Œç”¨äºä¸ä¸åŒçš„SDRç¡¬ä»¶è®¾å¤‡è¿›è¡Œäº¤äº’ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿä»¥ä¸€è‡´çš„æ–¹å¼è®¿é—®å’Œæ§åˆ¶å„ç§SDRè®¾å¤‡ã€‚SoapySDR æ”¯æŒå¤šç§å¹³å°å’Œæ“ä½œç³»ç»Ÿï¼Œå¹¶æä¾›äº†C++ã€Pythonå’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ç»‘å®šã€‚\n\n### ç¦ç”¨å’Œå¸è½½å†…æ ¸é©±åŠ¨\n\nremove the modules manually\n\n```sh\nsudo modprobe -r msi2500 msi001\n```\n\ncreate a file /etc/modprobe.d/blacklist-msi.conf\n\n```\nblacklist msi001\nblacklist msi2500\n```\n\n### å®‰è£…SoapySDR\n\n```sh\nsudo apt install soapysdr-module-mirisdr\n```\n\n### æŸ¥æ‰¾è®¾å¤‡\n\nå°†è®¾å¤‡è¿æ¥åˆ°USBæ¥å£\n\n```sh\n SoapySDRUtil --find\n ```\n\nå›æ˜¾ result(for example)\n \n```sh\n######################################################\n##     Soapy SDR -- the SDR abstraction library     ##\n######################################################\n\n[INFO] [UHD] linux; GNU C++ version 13.1.0; Boost_107400; UHD_4.4.0.0+ds1-4\nFound device 0\n  default_input = True\n  default_output = True\n  device_id = 0\n  driver = audio\n  label = Built-in Audio\n\nFound device 1\n  driver = miri\n  label = Mirics MSi2500 default (e.g. VTX3D card)\n  miri = 0\n ```\n\nPrint detailed information  æ‰“å¼€å¹¶æ‰“å°æµ‹è¯•ä¿¡æ¯\n\n```sh\nSoapySDRUtil  --probe=\"driver=miri\"\n```\nå›æ˜¾ result(for example)\n\n```sh\n######################################################\n##     Soapy SDR -- the SDR abstraction library     ##\n######################################################\n\nProbe device driver=miri\nUsing device #0: Mirics MSi2500 default (e.g. VTX3D card)\n\n----------------------------------------------------\n-- Device identification\n----------------------------------------------------\n  driver=miri\n  hardware=miri\n\n----------------------------------------------------\n-- Peripheral summary\n----------------------------------------------------\n  Channels: 1 Rx, 0 Tx\n  Timestamps: NO\n\n----------------------------------------------------\n-- RX Channel 0\n----------------------------------------------------\n  Full-duplex: NO\n  Supports AGC: NO\n  Stream formats: CF32\n  Native format: CF32 [full-scale=1]\n  Antennas: RX\n  Full gain range: [-1, 49, 1] dB\n    LNA gain range: [-1, 49, 1] dB\n  Full freq range: [0.15, 30], [64, 108], [162, 240], [470, 960], [1450, 1675] MHz\n    RF freq range: [0.15, 30], [64, 108], [162, 240], [470, 960], [1450, 1675] MHz\n    CORR freq range:  MHz\n  Tune args:\n     * LO Offset - Tune the LO with an offset and compensate with the baseband CORDIC.\n       [key=OFFSET, units=Hz, default=0.0, type=float]\n     * CORR - Specify a specific value for this component or IGNORE to skip tuning it.\n       [key=CORR, units=Hz, default=DEFAULT, type=float, options=(DEFAULT, IGNORE)]\n  Sample rates: 8 MSps\n\n_mirisdr_alloc_async_buffers\nLost samples!\n82 01 00 00 00 10 00 00 fb fd bc b4 0e f6 fd fe \nLost samples!\nLost samples!\nOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO\n```\n\n## 4.rtl_433\n\nrtl_433 æ˜¯ä¸€ä¸ªå¼€æºçš„è½¯ä»¶é¡¹ç›®ï¼Œç”¨äºæ¥æ”¶å’Œè§£ç ä½¿ç”¨è½¯ä»¶å®šä¹‰æ— çº¿ç”µï¼ˆSDRï¼‰æ¥æ”¶å™¨ï¼ˆå¦‚RTL-SDRï¼‰æ•è·çš„æ— çº¿ç”µä¿¡å·ã€‚\n\nrtl_433 é¡¹ç›®çš„ç›®æ ‡æ˜¯æ”¯æŒè§£ç å¤šç§ä¸åŒçš„æ— çº¿ç”µè®¾å¤‡å’Œåè®®ï¼ŒåŒ…æ‹¬æ°”è±¡ä¼ æ„Ÿå™¨ã€æ±½è½¦é¥æ§å™¨ã€æ— çº¿æ¸©åº¦ä¼ æ„Ÿå™¨ç­‰ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç›´æ¥ä¸RTL-SDRè®¾å¤‡è¿›è¡Œäº¤äº’ï¼Œå¹¶å°†æ•è·çš„æ— çº¿ç”µä¿¡å·è§£ç ä¸ºå¯è¯»çš„æ–‡æœ¬è¾“å‡ºã€‚\n\n### å®‰è£…\n\n```sh\nsudo apt install rtl-433\n```\n\n### æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯\n\n```sh\nrtl_433 -d driver=miri -v\n```\n\n### è§£ç æµ‹è¯•\n\n```sh\nrtl_433 -d \"miri\"\n```\n\nå›æ˜¾ result(for example)\n\n```sh\nrtl_433 -d \"miri\"\nrtl_433 version 22.11 (2022-11-19) inputs file rtl_tcp RTL-SDR SoapySDR\nUse -h for usage help and see https://triq.org/ for documentation.\nTrying conf file at \"rtl_433.conf\"...\nTrying conf file at \"/home/yourname/.config/rtl_433/rtl_433.conf\"...\nTrying conf file at \"/usr/local/etc/rtl_433/rtl_433.conf\"...\nTrying conf file at \"/etc/rtl_433/rtl_433.conf\"...\nRegistered 191 out of 223 device decoding protocols [ 1-4 8 11-12 15-17 19-23 25-26 29-36 38-60 63 67-71 73-100 102-105 108-116 119 121 124-128 130-149 151-161 163-168 170-175 177-197 199 201-215 217-223 ]\n[INFO] [UHD] linux; GNU C++ version 13.1.0; Boost_107400; UHD_4.4.0.0+ds1-4\n[INFO] Using format CS16.\nSample rate set to 250000 S/s.\nTuner set to automatic gain.\nTuner gain set to Auto.\nTuned to 433.920MHz.\nRtAudio pulse: _NOT_ running realtime scheduling\nbaseband_demod_FM_cs16: low pass filter for 250000 Hz at cutoff 25000 Hz, 40.0 us\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ntime      : 2024-05-05 14:15:39\nmodel     : Acurite-986  id        : 4096\nchannel   : 1R           Battery   : 1             temperature: 1.000000 F   status    : 4             Integrity : CRC\n```\n\n##  5.libmirisdr-5\n\nGNU Radioæœªèƒ½é€šè¿‡SoapySDRæ‰“å¼€è®¾å¤‡ï¼Œæ•…ä½¿ç”¨[libmirisdr-5](https://github.com/ericek111/libmirisdr-5)(forked from f4exb/libmirisdr-4)\n\nlibmirisdr æä¾›äº†ä¸ Mirics SDR æ¥æ”¶å™¨è¿›è¡Œäº¤äº’çš„åº•å±‚é©±åŠ¨ç¨‹åºå’ŒAPIã€‚å®ƒå…è®¸å¼€å‘äººå‘˜é€šè¿‡ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚C/C++ï¼‰è®¿é—®å’Œæ§åˆ¶ Mirics SDR æ¥æ”¶å™¨çš„åŠŸèƒ½ã€‚\n\n```sh\ngit clone git@github.com:ericek111/libmirisdr-5.git\n```\n\nbuild and install\n\n```sh\ncd libmirisdr-5\nmkdir build\ncd build\ncmake ..\nmake -j4\nsudo make install\nsudo ldconfig\n```\n\n## 6.gr-osmosdr\n\ngr-osmosdr æ˜¯ä¸€ä¸ªä¸ GNU Radio è½¯ä»¶æ— çº¿ç”µå¹³å°ç›¸å…³çš„å¼€æºé¡¹ç›®ï¼Œç”¨äºä¸å„ç§è½¯ä»¶å®šä¹‰æ— çº¿ç”µï¼ˆSDRï¼‰ç¡¬ä»¶è®¾å¤‡è¿›è¡Œäº¤äº’ã€‚\n\nä½¿ç”¨ gr-osmosdrï¼Œä½ å¯ä»¥å°†ä¸åŒå‚å•†çš„SDRç¡¬ä»¶è®¾å¤‡ï¼ˆå¦‚RTL-SDRã€HackRFã€LimeSDRç­‰ï¼‰ä¸GNU Radioè¿›è¡Œé›†æˆã€‚å®ƒæä¾›äº†ä¸€ç»„æ¨¡å—å’Œå‡½æ•°ï¼Œç”¨äºé…ç½®å’Œæ§åˆ¶SDRç¡¬ä»¶è®¾å¤‡çš„å‚æ•°ï¼Œå¦‚é¢‘ç‡ã€å¢ç›Šã€é‡‡æ ·ç‡ç­‰ã€‚é€šè¿‡è¿™äº›åŠŸèƒ½ï¼Œä½ å¯ä»¥å°†SDRç¡¬ä»¶è®¾å¤‡æ¥æ”¶åˆ°çš„æ— çº¿ç”µä¿¡å·å¯¼å…¥åˆ°GNU Radioçš„æµç¨‹å›¾ä¸­è¿›è¡Œè¿›ä¸€æ­¥çš„ä¿¡å·å¤„ç†å’Œåˆ†æã€‚\n\n[gr-osmosdr](https://osmocom.org/projects/gr-osmosdr/wiki/GrOsmoSDR)\n\n```sh\ngit clone https://git.osmocom.org/sdr/gr-osmosdr.git\n```\n\nbuild and install\n\n```sh\ncd gr-osmosdr\nmkdir build\ncd build\ncmake ..\nmake -j4\nsudo make install\nsudo ldconfig\n```\n\n\n## 7.GNU Radio\n\nGNU Radio æ˜¯ä¸€ä¸ªæµç¨‹å›¾é©±åŠ¨çš„å¼€æºè½¯ä»¶å·¥å…·åŒ…ï¼Œç”¨äºæ„å»ºè½¯ä»¶æ— çº¿ç”µç³»ç»Ÿå’Œä¿¡å·å¤„ç†åº”ç”¨ç¨‹åºã€‚gr-osmosdr æ˜¯ GNU Radio çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸å„ç§SDRç¡¬ä»¶è®¾å¤‡è¿›è¡Œé€šä¿¡çš„åŠŸèƒ½ã€‚\n\n### å®‰è£…\n\n```sh\nsudo apt install gnuradio\n```\n\nopen gnuradio\n\n### æµå›¾1\n\nåŠŸèƒ½ï¼šä»sdrè¯»å–æ•°æ®ï¼Œå¹¶ç°å®åˆ°ç•Œé¢ã€‚å¦‚ä¸‹ï¼š\n\n![gnu_project1_grc](gnu_project1_grc.png)\n\nExecute the flow graph\n\n![gnu_project1_run](gnu_project1_run.png)\n\n### æµå›¾2 FM\n\n[YouTube](https://youtu.be/tj_9p_rXULM?si=qtQ6HvAgtN4TNqyG)\n\nåŠŸèƒ½ï¼šä»sdrè¯»å–æ•°æ®ï¼Œä½¿ç”¨FMè§£ç ï¼Œæœ€åä»å£°å¡æ’­æ”¾ã€‚å¦‚ä¸‹ï¼š\n\n![gnu_project2_grc](gnu_project2_grc.png)\n\nExecute the flow graph\n\n![gnu_project2_run](gnu_project2_run.png)","tags":["SDR"]},{"title":"Ubuntu-RSP1-RTL_433","url":"/2024/04/21/Ubuntu-RSP1-RTL-433/","content":"\nRSP1 MSI2500 MSI001 SoapySDR RTL_433 Ubuntu\n\n## å»ºè®®æŸ¥çœ‹å‚è€ƒé“¾æ¥\n\n[Link !!!](https://revspace.nl/Msi2500SDR)\n\n### 3.1.1. Linux kernel driver\n\nNot sure what the Linux kernel driver is actually any good for anyway. \n\nremove the modules manually\n\n```sh\nsudo modprobe -r msi2500 msi001\n```\n\ncreate a file /etc/modprobe.d/blacklist-msi.conf\n\n```\nblacklist msi001\nblacklist msi2500\n```\n\n### 3.1.2. Soapy SDR\n\ninstall the soapy 'miri' driver:\n\n```sh\nsudo apt install soapysdr-module-mirisdr\n```\n\ntry to find it with SoapySDRUtil\n\n```sh\nSoapySDRUtil --find\n```\n\nresult (for example): \n\n```sh\nFound device 1\n  driver = miri\n  label = Mirics MSi2500 default (e.g. VTX3D card)\n  miri = 0\n```\n\ntry to open with SoapySDRUtil\n\n```sh\n SoapySDRUtil  --probe=\"driver=miri\"\n ```\n or\n ```sh\n SoapySDRUtil  --probe=\"driver=soapyMiri\"\n ```\n\n### 3.1.3. rtl_433\n\n[link](https://github.com/merbanan/rtl_433)\n\ninstall\n```sh\nsudo apt install rtl-433\n```\n\nrun\n```sh\nrtl_433 -d \"\"\n```","tags":["SDR"]},{"title":"PyBind11ç®€æ˜æ•™ç¨‹","url":"/2024/04/21/PyBind11ç®€æ˜æ•™ç¨‹/","content":"\npythoné€šè¿‡PyBind11è°ƒç”¨cpp\n\n## 1.æ¦‚è¿°\n\nåŸæ–‡é“¾æ¥: [How to Call C++ from Python](https://www.matecdev.com/posts/cpp-call-from-python.html)\n\nç¿»è¯‘æ•´ç†: [BimAnt](http://www.bimant.com/blog/pybind11-crash-tutorial/)\n\nä» Python è°ƒç”¨ C++ åŸºæœ¬ä¸Šæœ‰ä¸¤ç§æ–¹æ³•ï¼šä½¿ç”¨ PyBind11 C++ åº“ç”Ÿæˆ Python æ¨¡å—ï¼Œæˆ–ä½¿ç”¨ cytpes Python åŒ…è®¿é—®å·²ç¼–è¯‘çš„å…±äº«åº“ã€‚ ä½¿ç”¨ PyBind11 æˆ‘ä»¬å¯ä»¥æ›´è½»æ¾åœ°å…±äº«è®¸å¤šæ•°æ®ç±»å‹ï¼Œè€Œä½¿ç”¨ ctypes æ˜¯ä¸€ç§ä½çº§ C é£æ ¼çš„è§£å†³æ–¹æ¡ˆã€‚\n\nå°±æˆ‘è€Œè¨€ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿåˆ©ç”¨ C++ çš„æ€§èƒ½å’Œå¯ç§»æ¤æ€§ï¼Œä½†æˆ‘ä¸æƒ³æ”¾å¼ƒè§£é‡Šè¯­è¨€çš„äº¤äº’æ€§ä»¥è¿›è¡Œå¿«é€Ÿæ¢ç´¢å’Œè°ƒè¯•ã€‚\n\nå¹¸è¿çš„æ˜¯ï¼Œä» Python è°ƒç”¨ C++ å¹¶ä¸åƒä¹çœ‹èµ·æ¥é‚£ä¹ˆå›°éš¾ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å¼€å‘ C++ ä»£ç çš„åŒæ—¶æŒæ¡ Python çš„ä¸€äº›äº¤äº’æ€§ã€‚\n\nå°±æˆ‘è€Œè¨€ï¼Œæˆ‘æƒ³ä½¿ç”¨ Python æ¥ï¼š\n\n* å°†ä¸€äº›é—®é¢˜å‚æ•°ä¼ é€’ç»™C++\n* è°ƒç”¨ C++ ä»£ç æ¥è¿è¡Œè®¡ç®—å¯†é›†å‹ä¾‹ç¨‹\n* æ£€ç´¢æœ€ç»ˆç»“æœä»¥åŠä¸€äº›ç”¨äºè°ƒè¯•çš„ä¸­é—´è®¡ç®—ã€‚\n* ä»¥äº¤äº’æ–¹å¼æ¢ç´¢ç»“æœï¼Œå¹¶ç”Ÿæˆå›¾è¡¨å’ŒæŠ¥å‘Šã€‚\n\nä½¿ç”¨ ctypes çš„é—®é¢˜æ˜¯å…±äº«è®¸å¤šæ•°æ®ç±»å‹éœ€è¦å¤§é‡çš„ä½çº§è§£å†³æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œè™½ç„¶ ctypes ä¸æ”¯æŒå¤æ•°ç­‰åŸºæœ¬å†…å®¹ï¼Œä½† PyBind11 ä½¿ Numpy èƒ½å¤Ÿä¸ Eigen å®Œå…¨äº’æ“ä½œï¼Œå¹¶ä¸”éœ€è¦æœ€å°‘çš„ä»£ç ã€‚\n\nä¸è¿‡ï¼Œæˆ‘ä¹Ÿå‘ç°äº† PyBind11 çš„ä¸€ä¸ªå°é—®é¢˜ã€‚ äº‹å®è¯æ˜ï¼Œé‡æ–°ç¼–è¯‘ C++ ä»£ç å¹¶å°è¯•é‡æ–°åŠ è½½ PyBind ç”Ÿæˆçš„ Python æ¨¡å—åï¼Œä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿã€‚ é‡æ–°åŠ è½½å·²ç¼–è¯‘æ¨¡å—çš„å”¯ä¸€æ–¹æ³•æ˜¯é‡æ–°å¯åŠ¨æˆ‘çš„ Python ä¼šè¯ã€‚ æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œå› ä¸º Python çš„å¯åŠ¨æ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ ä¹Ÿè®¸ï¼Œè¿™ä¸ªæ­¥éª¤å¯ä»¥åœ¨ IDE çº§åˆ«è‡ªåŠ¨åŒ–ã€‚\n\nå› æ­¤ï¼Œç°åœ¨çš„é—®é¢˜æ˜¯å¦‚ä½•å……åˆ†åˆ©ç”¨ PyBind11ã€‚\n\n## 2.ä¸ PyBind11 å…±äº« C++ ç±»\n\nPyBind11 çš„å®˜æ–¹æ–‡æ¡£éå¸¸å¥½ï¼Œæˆ‘èƒ½å¤Ÿæ¯«æ— é—®é¢˜åœ°å¼€å§‹ä½¿ç”¨å®ƒã€‚ ç„¶è€Œï¼Œæˆ‘æƒ³åˆ†äº«è¿™ä¸ªåº“çš„è¶…çº§å¿«é€Ÿå…¥é—¨æŒ‡å—ï¼Œä»¥åŠæˆ‘æ‰“ç®—å¦‚ä½•ä½¿ç”¨å®ƒã€‚\n\nPybind11 æ˜¯ä¸€ä¸ªä»…åŒ…å«å¤´æ–‡ä»¶çš„åº“ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å®ƒï¼š\n\n`pip install pybind11`\n\nè™½ç„¶æ²¡æœ‰å¿…è¦å°†æ‰€æœ‰ C++ ä»£ç æ„é€ ä¸ºç±»ï¼Œä½†å¦‚æœä½ æœ‰ä¸€ä¸ªè¦åœ¨ C++ å’Œ Python ä¹‹é—´å…±äº«çš„ç±»ï¼ŒPybind11 å°†ä½¿äº‹æƒ…å˜å¾—éå¸¸å®¹æ˜“ã€‚ å®é™…ä¸Šï¼Œæˆ‘æ›´åƒæ˜¯ä¸€ä¸ªstructå‘é‡ç±»å‹çš„äººï¼Œæˆ‘æ€»æ˜¯æƒ³åœ¨ç»™å®šçš„é¡¹ç›®ä¸­å¼•å…¥æœ€å°‘æ•°é‡çš„ç±»ã€‚\n\nç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å‘ç°ä½¿ç”¨å¤–è§‚è®¾è®¡æ¨¡å¼ï¼ˆå‚è§ wikiï¼‰å¯ä»¥åŒæ—¶å¸¦æ¥éå¸¸ç®€å•çš„ Python/C++ äº’æ“ä½œæ€§å’Œè‰¯å¥½çš„ APIã€‚\n\næ‰€ä»¥ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ªç®€å•çš„ç±»ã€‚ å®ƒåŸºæœ¬ä¸ŠåŒ…å«ï¼š\n\n* è¯»å–é—®é¢˜å‚æ•°çš„æ„é€ å‡½æ•°ã€‚\n* æ‰§è¡Œè®¡ç®—çš„ run() å‡½æ•°ã€‚\n* ä¸€äº› Eigen æ•°ç»„ä½œä¸ºå…¬å…±å˜é‡æ¥å­˜å‚¨ç»“æœã€‚\n\nè¿™æ˜¯æˆ‘çš„æœ€å°ç¤ºä¾‹ï¼š\n\n```h\n// mylib.h\n#include <Eigen/Dense>\n#include <cmath>\n\nusing Eigen::Matrix, Eigen::Dynamic;\ntypedef Matrix<std::complex<double>, Eigen::Dynamic, Eigen::Dynamic> myMatrix;\n\nclass MyClass {\n\n    int N;\n    double a;\n    double b;\n\npublic:\n\n    Eigen::VectorXd v_data;\n    Eigen::VectorXd v_gamma;\n\n    MyClass(){}\n    MyClass( double a_in, double b_in, int N_in) \n    {\n        N = N_in;\n        a = a_in;\n        b = b_in;\n    }\n\n    void run() \n    { \n        v_data = Eigen::VectorXd::LinSpaced(N, a, b); \n\n        auto gammafunc = [](double it) { return std::tgamma(it); };\n        v_gamma = v_data.unaryExpr(gammafunc);\n    }\n};\n```\n\nä¸ºäº†å…±äº«è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº› C++ ä»£ç ã€‚ æˆ‘å€¾å‘äºåœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œå…¶ä¸­åŒ…å«åˆ›å»º python åŒ…è£…å™¨æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼š\n\n```cpp\n// pywrap.cpp\n#include <pybind11/pybind11.h>\n#include <pybind11/eigen.h>\n#include \"mylib.h\"\n\nnamespace py = pybind11;\nconstexpr auto byref = py::return_value_policy::reference_internal;\n\nPYBIND11_MODULE(MyLib, m) {\n    m.doc() = \"optional module docstring\";\n\n    py::class_<MyClass>(m, \"MyClass\")\n    .def(py::init<double, double, int>())  \n    .def(\"run\", &MyClass::run, py::call_guard<py::gil_scoped_release>())\n    .def_readonly(\"v_data\", &MyClass::v_data, byref)\n    .def_readonly(\"v_gamma\", &MyClass::v_gamma, byref)\n    ;\n}\n```\n\næœ‰å‡ ç‚¹éœ€è¦å¼ºè°ƒï¼š\n\n* ç±»æ„é€ å‡½æ•°ç­¾åç”± .def(py::init<int, double, double>())  æŒ‡å®š\n* å¯¹äº run() å‡½æ•°ï¼Œæˆ‘ä»¬è¦æ±‚é‡Šæ”¾ GILï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰ï¼Œè¿™å°†é˜»æ­¢æˆ‘ä»¬çš„å‡½æ•°ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ã€‚\n* æœ€åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ CMakeLists.txt æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼š\n\n```CMakeLists\ncmake_minimum_required(VERSION 3.10)\n\nproject(MyLib)\nset(CMAKE_CXX_STANDARD 20)\nset(PYBIND11_PYTHON_VERSION 3.6)\nset(CMAKE_CXX_FLAGS \"-Wall -Wextra -fPIC\")\n\nfind_package(pybind11 REQUIRED)\nfind_package(Eigen3 REQUIRED)\n\npybind11_add_module(${PROJECT_NAME} pywrap.cpp)\n\ntarget_compile_definitions(${PROJECT_NAME} PRIVATE VERSION_INFO=${EXAMPLE_VERSION_INFO})\ntarget_include_directories(${PROJECT_NAME} PRIVATE ${PYBIND11_INCLUDE_DIRS})\ntarget_link_libraries(${PROJECT_NAME} PRIVATE Eigen3::Eigen)\n```\nç°åœ¨å·²å‡†å¤‡å¥½äº†ã€‚ å¦‚æœä½ ä½¿ç”¨ VS Codeï¼Œé…ç½® CMake æ‰©å±•åï¼Œåªéœ€æŒ‰ F7 å³å¯ç¼–è¯‘ C++ åº“ã€‚\n\n## 3.ä» Python è°ƒç”¨ C++ åº“\n\nè¿™ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ï¼Œå¹¶ä¸”åº”è¯¥å¼€ç®±å³ç”¨ã€‚ ç„¶è€Œï¼Œæœ‰ä¸€äº›æ­¥éª¤å¯ä»¥ä¼˜åŒ–äº¤äº’å¼å·¥ä½œæµç¨‹ï¼Œè¿™äº›æ­¥éª¤ç¨å¾®æ£˜æ‰‹ï¼Œä½†ä¹Ÿå€¼å¾—å®æ–½ã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœæ­£åœ¨æ‰§è¡Œ Python ç¯å¢ƒå¹¶ä¸”ç¼–è¯‘çš„åº“è¿›å…¥æ„å»ºç›®å½•ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n\nimport sys\nsys.path.append(\"build/\")\nfrom MyLib import MyClass\n\nimport matplotlib.pyplot as plt\n\nSimulation = MyClass(-4,4,1000)\nSimulation.run()\n\nplt.plot(Simulation.v_data, Simulation.v_gamma, \\\n\"--\", linewidth = 3, color=(1,0,0,0.6),label=\"Function Value\")\nplt.ylim(-10,10)\nplt.xlabel(\"x\")\nplt.ylabel(\"($f(x) = \\gamma(x)$)\")\nplt.title(\"(Gamma Function: $\\gamma(z) = \\int_0^\\infty x^{z-1} e^{-x} dx$)\",fontsize = 18);\nplt.show()\n\nç»“æœå¦‚ä¸‹ï¼š\n\n![Gamma](image-137.png)\n\nè¯·æ³¨æ„ï¼Œç‰¹å¾å‘é‡ä¼šè‡ªåŠ¨è½¬æ¢ä¸º Python æ•°ç»„ã€‚\n\nä¿®æ”¹ myLib.hpp åï¼Œåªéœ€åœ¨ pywrap.cpp ä¸­ä¸ºæˆ‘ä»¬è¦å…¬å¼€çš„æ¯ä¸ªæ–°å‡½æ•°æˆ–å˜é‡æ·»åŠ ä¸€è¡Œä»£ç ã€‚\n\nä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ä¼šå¯¼è‡´å®Œå…¨äº¤äº’å¼çš„å·¥ä½œæµç¨‹ã€‚ å½“ä½ åœ¨æ›´æ”¹åé‡æ–°ç¼–è¯‘ C++ ä»£ç æ—¶ï¼ŒPython ç«¯ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚ å³ä½¿å°è¯•ä½¿ç”¨ importtools é‡æ–°åŠ è½½ Python æ¨¡å—ï¼š\n\n```sh\nimport importlib\nimportlib.reload(MyLib)\n```\n\nä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚ åŸå› æ˜¯ç¼–è¯‘åçš„ä»£ç æ— æ³•åœ¨Pythonä¸­é‡æ–°åŠ è½½ã€‚\n\nå› æ­¤ï¼Œä½¿ç”¨ PyBind11 æ—¶ï¼Œæ¯æ¬¡é‡æ–°ç¼–è¯‘ C++ ä»£ç æ—¶éƒ½éœ€è¦é‡æ–°å¯åŠ¨ Python ä¼šè¯ï¼Œè¿™å¯¹äºå¼€å‘ç›®çš„æ¥è¯´æœ‰ç‚¹çƒ¦äººã€‚ ç„¶è€Œï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå°çš„ä»£ä»·ï¼Œå› ä¸º Python çš„å¯åŠ¨æ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ä¸€äº› IDE çƒ­é”®æˆ–å…¶ä»–å·¥å…·æ¥è‡ªåŠ¨åŒ–è¯¥è¿‡ç¨‹ã€‚\n\n## 4.ç»“æŸè¯­\n\nå¥½äº†ï¼Œè¿™å°±æ˜¯å¯ä»¥è½»æ¾åœ°ä» Python è°ƒç”¨ C++ åº“çš„æ–¹æ³•ã€‚æ•™ç¨‹çš„ç¤ºä¾‹ä»£ç å¯ä»¥ä»githubè·å–ã€‚\n\nç‰¹åˆ«æ˜¯ï¼Œè¿™ä¸ªä¸¤æ­¥è¿‡ç¨‹å¯ä»¥äº§ç”Ÿéå¸¸äº¤äº’å¼çš„å¼€å‘å·¥ä½œæµç¨‹ã€‚ å°½ç®¡æˆ‘ä»¬æœ‰ä¸€ä¸ªç¼–è¾‘-ç¼–è¯‘-è¿è¡Œå·¥ä½œæµç¨‹ï¼Œä½†æˆ‘ä»¬åœ¨æœ€åæ·»åŠ äº†ä¸€ä¸ªè§£é‡Šå™¨ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬çš„å·¥ä½œæµç¨‹çœ‹èµ·æ¥åƒç¼–è¾‘-ç¼–è¯‘-è¿è¡Œ-æ¢ç´¢ã€‚\n\nå°†æ¥ï¼Œæˆ‘è®¡åˆ’å°†ä¸¤ä¸ªåŠŸèƒ½åˆå¹¶åˆ°æ­¤å·¥ä½œæµç¨‹ä¸­ï¼š\n\n* ç¬¬ä¸€ä¸ªæ˜¯ C++20 æ¨¡å—ï¼Œå®ƒåº”è¯¥å¯ä»¥åŠ å¿«å¤§å‹ C++ é¡¹ç›®çš„ç¼–è¯‘æ—¶é—´ã€‚ ä¸å¹¸çš„æ˜¯ï¼ŒCMake ä»ç„¶ä¸æ¨¡å—ä¸å…¼å®¹ï¼ˆè¯·å‚é˜…æ­¤é—®é¢˜ä»¥è·å–æ›´æ–°ï¼‰ï¼Œå¹¶ä¸”æ˜¾ç„¶å¿…é¡»ä¾èµ–åƒ Ninja-Build è¿™æ ·çš„æ„å»ºç³»ç»Ÿæ‰èƒ½ç«‹å³ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚\n* å¦ä¸€ä»¶äº‹æ˜¯ä¿®å¤é‡æ–°ç¼–è¯‘ C++ ä»£ç åï¼ˆæ‰‹åŠ¨ï¼‰é‡æ–°å¯åŠ¨ Python ä¼šè¯çš„éœ€è¦ã€‚ ä¸ºæ­¤ï¼Œæˆ‘å¸Œæœ›ä¹Ÿè®¸å¯ä»¥åœ¨ VSCode çº§åˆ«å¯¹æ­¤é‡‡å–ä¸€äº›æªæ–½ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒVS Code ä¸­çš„æœ€ä½³é€‰é¡¹ä¼¼ä¹æ˜¯ç»ˆæ­¢ Python ä¼šè¯ï¼Œç„¶åä½¿ç”¨ Shift+Enter æ‰§è¡Œ Python ä»£ç ï¼Œå¦‚æœå°šæœªæ‰“å¼€ä¼šè¯ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ã€‚","tags":["Python"]},{"title":"Windowsç³»ç»Ÿä¸­ä½¿ç”¨CMakeé…ç½®OpenCVçš„CPPç¯å¢ƒ","url":"/2024/04/18/Windowsç³»ç»Ÿä¸­ä½¿ç”¨Cmakeé…ç½®OpenCVçš„CPPç¯å¢ƒ/","content":"\nWindows CMake OpenCV C++\n\n## 1.æ¦‚è¿°\n\nWindowsç³»ç»Ÿä¸­ä½¿ç”¨Cmakeé…ç½®OpenCVçš„C++ç¯å¢ƒ\n\nå‚è€ƒ[Link](https://www.youtube.com/watch?v=CnXUTG9XYGI)\n\n## 2.ä¸‹è½½å¹¶è§£å‹ [opencv](https://opencv.org/releases/)\n\né€‰æ‹©Windowsï¼Œä¸è¦é€‰æ‹©Sources\n\n## 3.ä¸‹è½½å¹¶å®‰è£…cmake\n\nçœç•¥...\n\n## 4.ç¼–è¾‘ç³»ç»Ÿç¯å¢ƒå˜é‡\n\nåœ¨Path å¢åŠ ä»¥ä¸‹ä¸‰é¡¹(æ ¹æ®å®‰è£…ä½ç½®ä¿®æ”¹è·¯å¾„)\n\n```\nC:\\Program Files\\CMake\\bin\nD:\\opencv\\build\\x64\\vc15\\bin\nD:\\opencv\\build\\x64\\vc15\\lib\n```\n\n## 5.æ–°å»ºæ–‡ä»¶å¤¹åŠå†…éƒ¨çš„æ–‡ä»¶\n```\nHelloOpenCV\nâ””â”€src\n    â””â”€main.cpp\nCMakeLists.txt\n1.jpg\n```\n\n```cpp\n//main.cpp\n#include <opencv2/opencv.hpp>\n#include <iostream>\n\nint main()\n{\n    std::string imagePath = \"1.jpg\";\n    cv::Mat image = cv::imread(imagePath, cv::IMREAD_COLOR);\n    cv::imshow(\"Display window\", image);\n    cv::waitKey(0);\n    return 0;\n}\n```\n\næ ¹æ®å®‰è£…ä½ç½®ä¿®æ”¹ `OpenCV_DIR` çš„å€¼\n```CMake\n# CMakeLists.txt\ncmake_minimum_required(VERSION 3.0)\nproject(HelloOpenCV)\n\nset(OpenCV_DIR \"D:/opencv/build/x64/vc15/lib\")\n\nfind_package(OpenCV REQUIRED)\n\ninclude_directories(${OpenCV_INCLUDE_DIRS})\n\nadd_executable(HelloOpenCV src/main.cpp)\n\ntarget_link_libraries(HelloOpenCV ${OpenCV_LIBS})\n```\n\n## 6.Terminal ä¸­ç¼–è¯‘\n\n```PowerShell\nmkdir build\ncmake -B .\\build\\\n```\n\nDebug\n```PowerShell\ncmake --build .\\build\\\n.\\build\\Debug\\HelloOpenCV.exe\n```\n\nRelease\n```PowerShell\ncmake --build .\\build\\ --config Release\n.\\build\\Release\\HelloOpenCV.exe\n```","tags":["OpenCV"]},{"title":"Ubuntu-OpenCV-CPP-Without-IDE","url":"/2024/04/13/Ubuntu-OpenCV-CPP-Without-IDE/","content":"\nUbuntu OpenCV CMake\n\n## 1.Building packages\n\n1. update packages list\n\n```sh\nsudo apt update\n```\n\n2. Install building packages\n\n```sh\nsudo apt -y install build-essential\n```\n\n## 2.Install OpenCV from Ubuntu Repositories\n\n[link](https://phoenixnap.com/kb/installing-opencv-on-ubuntu)\n\n1. Install OpenCV\n\n```sh\nsudo apt -y install libopencv-dev\n```\n\n2. Check the OpenCV version\n\n```sh\ndpkg -l libopencv-dev\n```\n\n## 3.Install CMake\n\n```sh\nsudo apt -y install cmake\ncmake --version\n```\n\n## 4.Create CPP Projetct\n\n[link](https://docs.opencv.org/4.x/db/df5/tutorial_linux_gcc_cmake.html)\n\n```sh\nDisplayImage\nâ”œâ”€â”€ build\nâ”‚Â Â  â””â”€â”€ \nâ”œâ”€â”€ CMakeLists.txt\nâ”œâ”€â”€ cmake-modules\nâ”‚Â Â  â””â”€â”€ OpenCVConfig.cmake\nâ”œâ”€â”€ img\nâ”‚Â Â  â””â”€â”€ lenna.jpeg\nâ””â”€â”€ src\n    â””â”€â”€ DisplayImage.cpp\n```\n\n```cpp\n// DisplayImage.cpp\n\n#include <stdio.h>\n#include <opencv2/opencv.hpp>\n\nusing namespace cv;\n\nint main(int argc, char **argv)\n{\n    if (argc != 2)\n    {\n        printf(\"usage: DisplayImage.out <Image_Path>\\n\");\n        return -1;\n    }\n\n    Mat image;\n    image = imread(argv[1], IMREAD_COLOR);\n\n    if (!image.data)\n    {\n        printf(\"No image data \\n\");\n        return -1;\n    }\n    namedWindow(\"Display Image\", WINDOW_AUTOSIZE);\n    imshow(\"Display Image\", image);\n\n    waitKey(0);\n\n    return 0;\n}\n```\n\n\n```\n# CMakeLists.txt\n\n# CMake æœ€ä½ç‰ˆæœ¬å·è¦æ±‚\ncmake_minimum_required(VERSION 3.6)\n\n# é¡¹ç›®ä¿¡æ¯\nproject(DisplayImage)\n\n# å°†cmake-modulesæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åŠ å…¥ CMAKE_MODULE_PATH\nlist(APPEND CMAKE_MODULE_PATH \"${PROJECT_SOURCE_DIR}/cmake-modules\")\n\n# æŸ¥æ‰¾å¹¶ä»å¤–éƒ¨é¡¹ç›®åŠ è½½è®¾ç½®\n# REQUIREDå¦‚æœæ‰¾ä¸åˆ°è½¯ä»¶åŒ…ï¼Œè¯¥é€‰é¡¹å°†åœæ­¢å¤„ç†å¹¶æ˜¾ç¤ºä¸€æ¡é”™è¯¯æ¶ˆæ¯\nfind_package(OpenCV REQUIRED)\n\n# å°†ç»™å®šç›®å½•æ·»åŠ åˆ°ç¼–è¯‘å™¨ç”¨æ¥æœç´¢åŒ…å«æ–‡ä»¶çš„ç›®å½•ä¸­ã€‚ç›¸å¯¹è·¯å¾„è¢«è§£é‡Šä¸ºç›¸å¯¹äºå½“å‰æºç›®å½•\ninclude_directories(${OpenCV_INCLUDE_DIRS})\n\n# åˆ©ç”¨æºç æ–‡ä»¶ç”Ÿæˆç›®æ ‡å¯æ‰§è¡Œç¨‹åº\nadd_executable(DisplayImage src/DisplayImage.cpp)\n\n# æ·»åŠ é“¾æ¥åº“\ntarget_link_libraries(DisplayImage ${OpenCV_LIBS})\n```\n\n## 5.Find OpenCV Config\n\n[link](https://wiki.hanzheteng.com/development/cmake/cmake-find_package)\n\n```sh\nsudo find / -name \"OpenCVConfig.cmake\"\n```\n\ncopy to cmake-modules folder\n\n## 6.Build and Test\n\n```sh\ncd build\ncmake ..\nmake\n./DisplayImage ../img/lenna.jpeg\n```\n\nmaybe need `chmod +x DisplayImage`\n\n![test](Screenshot_test.png)\n\n\n## 7.VSCode Debug\n\n* Install Extensions\n\n![install_Extensions](Screenshot_VSCode_Extensions.png)\n\n* restart and set cmake\n\n![set_cmake](Screenshot_set_cmake.png)\n\n* add breakpoint and click Debug button\n\n![breakpoint](Screenshot_set_breakpoint.png)\n\n* Debugging\n\n![run_debug](Screenshot_Debug.png)\n\n* set pic path for main args\n\nplease tell me...\n\n\n","tags":["OpenCV"]},{"title":"opencväº¤å‰ç¼–è¯‘","url":"/2024/02/25/opencväº¤å‰ç¼–è¯‘/","content":"\n## 1.æ¦‚è¿°\n\nUbuntu x86 äº¤å‰ç¼–è¯‘ aarm64 OpenCV 3.4.5\n\n[å‚è€ƒ](https://www.codenong.com/cs105274123/)\n\n## 2.ç¯å¢ƒ\n\nUbuntu 18.04 aarm64    OpenCV3.4.5  ç›®æ ‡arm64\n\næºç \n\n OpenCVæºç ä¸‹è½½åœ°å€: https://opencv.org/releases/ \n\nå®‰è£…äº¤å‰ç¼–è¯‘å™¨\n\n```bash\nsudo apt-get install gcc-aarch64-linux-gnu g++-aarch64-linux-gnu\n```\n\nå®‰è£…cmake\n\n```bash\nsudo apt install cmake cmake-gui\n```\n\nè§£å‹OpenCV\n\n## 3.ä½¿ç”¨cmake-guiç”ŸæˆMakefile\n\n![img](20200402174348844.png) \n\n![img](20200402174507776.png) \n\n![img](20200402174708819.png) \n\n![img](20200402174747432.png) \n\n![img](20200402175311654.png) \n\næŸ¥çœ‹æ˜¯å¦ç”ŸæˆMakefileæ–‡ä»¶\n\n## 4.ç¼–è¯‘\n\n```bash\nmake && make install\n```\n\nç”¨fileæŒ‡ä»¤æŸ¥çœ‹ç¼–è¯‘å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶\n\n```bash\nfile bin/opencv_version\n```\n\nå°†æ–‡ä»¶åŠ installä¸­ç”Ÿæˆçš„æ–‡ä»¶ç§»åŠ¨åˆ°aarm64æ–‡ä»¶å¤¹ï¼Œæ–¹é¢æŸ¥æ‰¾å’Œä½¿ç”¨ã€‚\n\n## 5.ç¼–è¯‘ä¾‹ç¨‹\n\n åœ¨è¿™ä¸ªopencv-3.4.5/samples/cpp/example_cmakeç›®å½•é‡Œå®˜æ–¹å·²ç»ç»™å‡ºäº†ä¸€ä¸ªexampleå¯ä»¥æ‹¿æ¥æµ‹è¯•ä¸‹ï¼Œä½¿ç”¨ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œç¼–è¯‘æ—¶åŠ ä¸ŠOpenCVç›¸å…³çš„åº“å’Œå¤´æ–‡ä»¶ã€‚ \n\n```bash\ng++ example.cpp -o aarm64 -I /home/yi/opencv/aarm64/include/ -L /home/yi/opencv/aarm64/lib/ -lopencv_calib3d -lopencv_objdetect -lopencv_core -lopencv_photo -lopencv_dnn -lopencv_shape -lopencv_features2d  -lopencv_stitching -lopencv_flann -lopencv_superres -lopencv_highgui -lopencv_videoio -lopencv_imgcodecs  -lopencv_video -lopencv_imgproc -lopencv_videostab -lopencv_ml\n```\n\nåº“ã€å¤´æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ°ç›®æ ‡æ¿ï¼ˆè‹¥cmake-guié€‰æ‹©ç¼–è¯‘å¹³å°ä¸ºgnuï¼Œå³å¯åœ¨æœ¬åœ°æµ‹è¯•æ— éœ€æ‹·è´æ–‡ä»¶ï¼‰\n\n## 6.è®¾ç½®åŠ¨æ€åº“è·¯å¾„\n\n```bash\nexport LD_LIBRARY_PATH=/home/yi/opencv/aarm64/lib/:$LD_LIBRARY_PATH\n```\n\n## 7.è¿è¡Œ\n\n\n```bash\n./aarm64\n```\n\nè½¯ä»¶è¿è¡Œç•Œé¢\n\n![1668051815828](1668051815828.png)","tags":["OpenCV"]},{"title":"Ubuntuå®‰è£…QTäº¤å‰ç¼–è¯‘ç¯å¢ƒ","url":"/2024/02/25/Ubuntuå®‰è£…QTäº¤å‰ç¼–è¯‘ç¯å¢ƒ/","content":"\n## 1.Ubuntu å®‰è£…QTäº¤å‰ç¼–è¯‘ç¯å¢ƒ\n\n[å‚è€ƒ](https://blog.csdn.net/guohuaqu/article/details/109519744)\n\néœ€æ±‚å®ç°å†x86æœºå™¨ä¸‹å®Œæˆå¯¹ARM64å¹³å°çš„ç¨‹åºå¼€å‘\n\n## 2.å®‰è£…ARM64ç¼–è¯‘å™¨\n\n```bash\nsudo apt-get install gcc-aarch64-linux-gnu g++-aarch64-linux-gnu\n```\næŸ¥çœ‹\n\n![shell aarch64-linux-gnu-](1667790599228.png)\n\n## 3.å®‰è£…qtå¼€å‘ç¯å¢ƒ\n\nqtå®‰è£…åŒ…ï¼šqt-opensource-linux-x64-5.12.12.run\n\nsudo chmod +xï¼Œç„¶åè¿è¡Œï¼Œå°±ä¼šå‡ºç°å›¾å½¢ç•Œé¢ï¼ŒæŒ‰æ­¥éª¤ä¸€æ­¥æ­¥å®‰è£…å³å¯ã€‚\n\n## 4.å®‰è£…qtå·¥å…·\n\nARM64äº¤å‰ç¼–è¯‘å™¨ï¼Œä¾‹å¦‚qmakeã€åº“ç­‰\n\nä¸‹è½½qtæºç åŒ…ï¼š[qt-everywhere-src-5.12.12.tar.xz](http://download.qt.io/archive/qt/5.14/5.12.12/single/qt-everywhere-src-5.12.12.tar.xz) \n\nè§£å‹ xz -d qt-everywhere-src-5.12.12.tar.xz\n\nä¿®æ”¹ç¼–è¯‘é…ç½®æ–‡ä»¶\n\n```bash\nyi@linux:~/Downloads/qt-everywhere-src-5.12.12/qtbase/mkspecs$ ls\naix-g++                macx-xcode\naix-g++-64             modules\nandroid-clang          modules-inst\nandroid-g++            netbsd-g++\ncommon                 openbsd-g++\ncygwin-g++             qconfig.pri\ndarwin-g++             qdevice.pri\ndevices                qmodule.pri\ndummy                  qnx-aarch64le-qcc\nfeatures               qnx-armle-v7-qcc\nfreebsd-clang          qnx-x86-64-qcc\nfreebsd-g++            qnx-x86-qcc\nhaiku-g++              solaris-cc\nhpuxi-g++-64           solaris-cc-64\nhurd-g++               solaris-cc-64-stlport\nintegrity-armv7        solaris-cc-stlport\nintegrity-armv7-imx6   solaris-g++\nintegrity-armv8-rcar   solaris-g++-64\nintegrity-x86          unsupported\nlinux-aarch64-gnu-g++  wasm-emscripten\nlinux-arm-gnueabi-g++  win32-arm64-msvc2017\nlinux-clang            win32-clang-g++\nlinux-clang-libc++     win32-clang-msvc\nlinux-g++              win32-g++\nlinux-g++-32           win32-icc\nlinux-g++-64           win32-icc-k1om\nlinux-icc              win32-msvc\nlinux-icc-32           winrt-arm64-msvc2017\nlinux-icc-64           winrt-arm64-msvc2019\nlinux-icc-k1om         winrt-arm-msvc2015\nlinux-llvm             winrt-arm-msvc2017\nlinux-lsb-g++          winrt-arm-msvc2019\nlynxos-g++             winrt-x64-msvc2015\nmacx-clang             winrt-x64-msvc2017\nmacx-g++               winrt-x64-msvc2019\nmacx-icc               winrt-x86-msvc2015\nmacx-ios-clang         winrt-x86-msvc2017\nmacx-tvos-clang        winrt-x86-msvc2019\n```\n\næŸ¥çœ‹ä¿®æ”¹é…ç½®æ–‡ä»¶ vim linux-aarch64-gnu-g++/qmake.conf\n\n```bash\n#\n# qmake configuration for building with aarch64-linux-gnu-g++\n#\n\nMAKEFILE_GENERATOR      = UNIX\nCONFIG                 += incremental\nQMAKE_INCREMENTAL_STYLE = sublib\n\ninclude(../common/linux.conf)\ninclude(../common/gcc-base-unix.conf)\ninclude(../common/g++-unix.conf)\n\n# modifications to g++.conf\nQMAKE_CC                = aarch64-linux-gnu-gcc\nQMAKE_CXX               = aarch64-linux-gnu-g++\nQMAKE_LINK              = aarch64-linux-gnu-g++\nQMAKE_LINK_SHLIB        = aarch64-linux-gnu-g++\n\n# modifications to linux.conf\nQMAKE_AR                = aarch64-linux-gnu-ar cqs\nQMAKE_OBJCOPY           = aarch64-linux-gnu-objcopy\nQMAKE_NM                = aarch64-linux-gnu-nm -P\nQMAKE_STRIP             = aarch64-linux-gnu-strip\nload(qt_config)\n```\n\nå¼€å§‹ç¼–è¯‘ï¼š\n\n è¿›å…¥æ ¹ç›®å½•cd qt-everywhere-src-5.12.12 \n\n```bash\n./configure -prefix /home/yi/Qt5.12.12/5.12.12/aarch64 -make libs -xplatform linux-aarch64-gnu-g++ -no-opengl -skip qtdeclarative\n```\n\n-prefix ä»£è¡¨ä½ çš„å®‰è£…æ–‡ä»¶å¤¹\n\n-xplatform ä»£è¡¨ä½ æ‰€åˆ¶å®šçš„ç¼–è¯‘å™¨\n\nno-opengl è·³è¿‡ç¼–è¯‘openGL(å› ä¸ºæˆ‘å·²ç»å®‰è£…äº†Qtï¼Œæ‰€ä»¥ä¸éœ€è¦ç•Œé¢)\n\n-skip qtdeclarative è·³è¿‡ qtdeclarativeï¼ˆä¸è·³è¿‡ï¼Œç¼–è¯‘å‡ºé”™ï¼Œå‡ºé”™çš„åŸå› ä¸æ¸…æ¥šï¼‰\n\nçº¿ç¨‹å¼€åˆ°äº†æœ€å¤§ï¼Œå¹¶æŠŠlogå­˜åœ¨äº†æœ¬åœ°ã€‚ç¼–è¯‘å…·ä½“æ—¶é—´æ¯”è¾ƒä¾èµ–è‡ªå·±PCçš„é…ç½®ã€‚\n\n```bash\nmake -j16 2>&1 | tee build.log\n```\nåˆ›å»ºå®‰è£…æ–‡ä»¶å¤¹\n\n```bash\nMkdir -p Qt5.12.12/5.12.12/aarch64\n```\nå®‰è£…\n\n```bash\nmake install\n```\næŸ¥çœ‹ç»“æœ\n\n```bash\nyi@linux:~/Qt5.12.12/5.12.12/aarch64$ ls\nbin  doc  include  lib  mkspecs  plugins  translations\n```\n## 5.é…ç½®Qtï¼Œæ·»åŠ äº¤å‰ç¼–è¯‘ç¯å¢ƒ\n\n4.é…ç½®Qtï¼Œæ·»åŠ äº¤å‰ç¼–è¯‘ç¯å¢ƒ\n\na.æ‰“å¼€Qt\n\nb.tools â†’ options,æ‰“å¼€é¢æ¿\n\nc.è®¾ç½®compilers,æ‰‹åŠ¨æ·»åŠ ARM64äº¤å‰ç¼–è¯‘å™¨\n\nadd c\n\n![commpilers](commpilers.png)\n\n\nd.æ‰‹åŠ¨add qt version\n\n![qt kits-Versions](1667797779321.png)\n\ne.æ‰‹åŠ¨add Kits\n\n![qt kits-Manual](1667797929755.png)\n\n![qt Debugger](1667797958269.png)\n\n## 6.æ–°å»ºå·¥ç¨‹&ç¼–è¯‘\n\né€‰æ‹©åˆšåˆšæ‰‹åŠ¨æ·»åŠ çš„kits\n\n","tags":["Qt"]},{"title":"Pycharm+Anaconda+QtDesignerå¼€å‘å®Œæ•´é…ç½®æ”»ç•¥","url":"/2024/02/12/Pycharm-Anaconda-QtDesignerå¼€å‘å®Œæ•´é…ç½®æ”»ç•¥/","content":"\næ­å»ºQyQtå¼€å‘ç¯å¢ƒ\n\nPyCharm + Anaconda(æˆ–miniconda) + Qt Designer\n\n## 1.PyCharmä¸‹è½½å®‰è£…\npycharm ç¤¾åŒºç‰ˆ\n\n## 2.Anacondaä¸‹è½½å®‰è£…\n\n[anaconda](https://repo.anaconda.com/archive/Anaconda3-2021.05-Windows-x86_64.exe)\n\nanaconda mirror\n\n## 3.è®¾ç½®pypiæº\n\npycharm project\n\n```\npip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\n```\n\n## 4.å®‰è£…è½¯ä»¶åŒ…\n\n```\npip install -r requirements.txt\n```\n\n## 5.æŸ¥çœ‹pythonç‰ˆæœ¬\n\n```\nC:\\Users\\æ›¿æ¢ä¸ºç”¨æˆ·å>pip -V\npip 21.0.1 from E:\\ProgramData\\Anaconda3\\lib\\site-packages\\pip (python 3.8)\n```\n\n## 6.conda æ·»åŠ ä¸­ç§‘å¤§æº\n[https://blog.csdn.net/R18830287035/article/details/90633942](https://blog.csdn.net/R18830287035/article/details/90633942)\n\n```\nC:\\Users\\æ›¿æ¢ä¸ºç”¨æˆ·å>\nconda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/main/\nconda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/free/\nconda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/\nconda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/msys2/\nconda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/bioconda/\nconda config --add channels https://mirrors.ustc.edu.cn/anaconda/cloud/menpo/\nconda config --set show_channel_urls yes\n```\n\n```\nC:\\Users\\æ›¿æ¢ä¸ºç”¨æˆ·å>\nconda config --show channels\nchannels:\n  - https://mirrors.ustc.edu.cn/anaconda/cloud/menpo/\n  - https://mirrors.ustc.edu.cn/anaconda/cloud/bioconda/\n  - https://mirrors.ustc.edu.cn/anaconda/cloud/msys2/\n  - https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/\n  - https://mirrors.ustc.edu.cn/anaconda/pkgs/free/\n  - https://mirrors.ustc.edu.cn/anaconda/pkgs/main/\n  - defaults\n```\n\n## 7.PyCharm+Qt Designer+PyUICå®‰è£…é…ç½®æ•™ç¨‹\n\n[https://www.cnblogs.com/lsdb/p/9121903.html](https://www.cnblogs.com/lsdb/p/9121903.html)\n\n\n## 8.PyCharm Setting\n\n```\nTools - External Tools\n  Qt-QtDesigner \n    Name: QtDesigner\n    Group: Qt\n    Program: E:\\ProgramData\\Anaconda3\\envs\\py37ccd\\Lib\\site-packages\\PySide2\\designer.exe\n    Working dir: $FileDir$\n  Qt-PyUIC\n    Name: PyUIC\n    Group: Qt\n    Program: E:\\ProgramData\\Anaconda3\\envs\\py37ccd\\python.exe\n    Arguments: -m PyQt5.uic.pyuic $FileName$ -o $FileNameWithoutExtension$.py\n    Working dir: $FileDir$\n```\n\n## 9.PyCharm+QTDesigner+PyUICä½¿ç”¨æ•™ç¨‹\nhttps://www.cnblogs.com/lsdb/p/9122425.html\n","tags":["PyQt"]},{"title":"esp32é€šè¿‡lvglåº“é©±åŠ¨è§¦æ‘¸å±","url":"/2023/08/06/esp32é€šè¿‡lvglåº“é©±åŠ¨è§¦æ‘¸å±/","content":"\nåœ¨ESP32å¼€å‘æ¿ä¸Šä½¿ç”¨LVGLæ¡†æ¶å¼€å‘LCDæ˜¾ç¤ºå±ç•Œé¢\n\næ˜¾ç¤ºæ¡†æ¶ï¼šLVGL\n\nTFTèŠ¯ç‰‡ï¼šST7789\n\nç”µå®¹è§¦æ‘¸èŠ¯ç‰‡ï¼šCST816S\n\n![run_demo](run_demo.png)\n\n## 1.TFT_eSPI drive LCD\n\nhttps://github.com/Bodmer/TFT_eSPI/discussions/2555\n\nThis wiki page was useful: [Github](https://github.com/Bodmer/TFT_eSPI/wiki/Installing-on-PlatformIO)\n\nThat said, there are some missing parts that due to the state of the library will show up as a non-functioning screen. For my use case (an ILI9488 device), I needed to provide additional values. I believe some of these are necessary for all projects.\n\nHere is the bare minimum project using Visual Studio Code with PlatformIo and using the technique of platformio.ini file modification. No library file modification needed!\n\nplatformio.ini:\n\n```\n[env:nodemcu-32s]\nplatform = espressif32\nboard = nodemcu-32s\nframework = arduino\nmonitor_speed = 115200\nlib_deps = bodmer/TFT_eSPI@^2.5.23\nbuild_flags =\n-D USER_SETUP_LOADED\n-D ILI9488_DRIVER\n-D TFT_MISO=19\n-D TFT_MOSI=23\n-D TFT_SCLK=18\n-D TFT_CS=15\n-D TFT_DC=2\n-D TFT_RST=4\n-D LOAD_GLCD=1\n-D SMOOTH_FONT\n-D SPI_FREQUENCY=27000000\n```\n\nmain.cpp:\n\n```c++\n#include <Arduino.h>\n#include <TFT_eSPI.h> // Hardware-specific library\nTFT_eSPI tft = TFT_eSPI(); // Invoke custom library\n\nvoid setup()\n{\nSerial.begin(115200); // For debug\ntft.init();\n\ntft.setRotation(1);\ntft.fillScreen(TFT_GREEN);\n}\n\nvoid loop()\n{\n// put your main code here, to run repeatedly:\n}\n```\n\nNote that I had to include USER_SETUP_LOADED as well as SMOOTH_FONT.\n\nThere are some minor errors in the wiki article. It projects like we need to have an =1 but I found it works just like the include system and is not necessary.\n\n\n## 2.My project, need offset.\n\nplatformio.ini:\n\n```c++\n[env:wesp32]\nplatform = espressif32\nboard = wesp32\nframework = arduino\nmonitor_speed = 115200\nupload_speed = 230400\nboard_build.partitions = default_16MB.csv\nboard_upload.flash_size = 16MB\nlib_deps = \n\tbodmer/TFT_eSPI@^2.5.30\n    lvgl/lvgl@^8.3.7\nbuild_flags = \n\t-D USER_SETUP_LOADED\n\t-D ST7789_DRIVER\n\t-D CGRAM_OFFSET\n\t-D TFT_MOSI=23\n\t-D TFT_SCLK=18\n\t-D TFT_DC=2\n\t-D TFT_RST=4\n\t-D LOAD_GLCD=1\n\t-D SMOOTH_FONT\n\t-D SPI_FREQUENCY=55000000\n```\n\n## 3.lvgl\n\nmain.cpp\n```c++\n/*Using LVGL with Arduino requires some extra steps:\n *Be sure to read the docs here: https://docs.lvgl.io/master/get-started/platforms/arduino.html  */\n\n#include <lvgl.h>\n#include <TFT_eSPI.h>\n\n/*To use the built-in examples and demos of LVGL uncomment the includes below respectively.\n *You also need to copy `lvgl/examples` to `lvgl/src/examples`. Similarly for the demos `lvgl/demos` to `lvgl/src/demos`.\n Note that the `lv_examples` library is for LVGL v7 and you shouldn't install it for this version (since LVGL v8)\n as the examples and demos are now part of the main LVGL library. */\n\n/*Change to your screen resolution*/\nstatic const uint16_t screenWidth  = 240;\nstatic const uint16_t screenHeight = 280;\n\nstatic lv_disp_draw_buf_t draw_buf;\nstatic lv_color_t buf[ screenWidth * 10 ];\n\nTFT_eSPI tft = TFT_eSPI(screenWidth, screenHeight); /* TFT instance */\n\n#if LV_USE_LOG != 0\n/* Serial debugging */\nvoid my_print(const char * buf)\n{\n    Serial.printf(buf);\n    Serial.flush();\n}\n#endif\n\n/* Display flushing */\nvoid my_disp_flush( lv_disp_drv_t *disp, const lv_area_t *area, lv_color_t *color_p )\n{\n    uint32_t w = ( area->x2 - area->x1 + 1 );\n    uint32_t h = ( area->y2 - area->y1 + 1 );\n\n    tft.startWrite();\n    tft.setAddrWindow( area->x1, area->y1, w, h );\n    tft.pushColors( ( uint16_t * )&color_p->full, w * h, true );\n    tft.endWrite();\n\n    lv_disp_flush_ready( disp );\n}\n\nvoid setup()\n{\n    Serial.begin( 115200 ); /* prepare for possible serial debug */\n\n    String LVGL_Arduino = \"Hello Arduino! \";\n    LVGL_Arduino += String('V') + lv_version_major() + \".\" + lv_version_minor() + \".\" + lv_version_patch();\n\n    Serial.println( LVGL_Arduino );\n    Serial.println( \"I am LVGL_Arduino\" );\n\n    lv_init();\n\n#if LV_USE_LOG != 0\n    lv_log_register_print_cb( my_print ); /* register print function for debugging */\n#endif\n\n    tft.begin();          /* TFT init */\n    tft.setRotation( 4 ); /* 2:top fpc 4:bottom fpc */\n\n    lv_disp_draw_buf_init( &draw_buf, buf, NULL, screenWidth * 10 );\n\n    /*Initialize the display*/\n    static lv_disp_drv_t disp_drv;\n    lv_disp_drv_init( &disp_drv );\n    /*Change the following line to your display resolution*/\n    disp_drv.hor_res = screenWidth;\n    disp_drv.ver_res = screenHeight;\n    disp_drv.flush_cb = my_disp_flush;\n    disp_drv.draw_buf = &draw_buf;\n    lv_disp_drv_register( &disp_drv );\n\n    /* Create simple label */\n    lv_obj_t *label_top = lv_label_create( lv_scr_act() );\n    lv_label_set_text( label_top, LVGL_Arduino.c_str() );\n    lv_obj_align( label_top, LV_ALIGN_TOP_LEFT, 0, 0 );\n\n    lv_obj_t *label = lv_label_create( lv_scr_act() );\n    lv_label_set_text( label, LVGL_Arduino.c_str() );\n    lv_obj_align( label, LV_ALIGN_CENTER, 0, 0 );\n\n    lv_obj_t *label_bottom = lv_label_create( lv_scr_act() );\n    lv_label_set_text( label_bottom, LVGL_Arduino.c_str() );\n    lv_obj_align( label_bottom, LV_ALIGN_BOTTOM_RIGHT, 0, 0 );\n\n    Serial.println( \"Setup done\" );\n}\n\nvoid loop()\n{\n    lv_timer_handler(); /* let the GUI do its work */\n    delay( 5 );\n}\n```\n\n## 4.lvgl+touch\nplatformio.ini:\n```c++\n[env:wesp32]\nplatform = espressif32\nboard = wesp32\nframework = arduino\nmonitor_speed = 115200\nupload_speed = 230400\nboard_build.partitions = default_16MB.csv\nboard_upload.flash_size = 16MB\nlib_deps = \n\tbodmer/TFT_eSPI@^2.5.30\n    fbiego/CST816S@^1.1.0\n    lvgl/lvgl@^8.3.7\nbuild_flags = \n\t-D USER_SETUP_LOADED\n\t-D ST7789_DRIVER\n\t-D CGRAM_OFFSET\n\t-D TFT_MOSI=23\n\t-D TFT_SCLK=18\n\t-D TFT_DC=2\n\t-D TFT_RST=4\n\t-D LOAD_GLCD=1\n\t-D SMOOTH_FONT\n\t-D SPI_FREQUENCY=55000000\n```\n\nmain.cpp\n```c++\n/*Using LVGL with Arduino requires some extra steps:\n *Be sure to read the docs here: https://docs.lvgl.io/master/get-started/platforms/arduino.html  */\n\n#include <lvgl.h>\n#include <TFT_eSPI.h>\n#include <CST816S.h>\n\n\n/*To use the built-in examples and demos of LVGL uncomment the includes below respectively.\n *You also need to copy `lvgl/examples` to `lvgl/src/examples`. Similarly for the demos `lvgl/demos` to `lvgl/src/demos`.\n Note that the `lv_examples` library is for LVGL v7 and you shouldn't install it for this version (since LVGL v8)\n as the examples and demos are now part of the main LVGL library. */\n\n/*Change to your screen resolution*/\nstatic const uint16_t screenWidth  = 240;\nstatic const uint16_t screenHeight = 280;\n\nstatic lv_disp_draw_buf_t draw_buf;\nstatic lv_color_t buf[ screenWidth * 10 ];\n\nTFT_eSPI tft = TFT_eSPI(screenWidth, screenHeight); /* TFT instance */\n\nCST816S touch(15, 4, 5, 34);\t// sda, scl, rst, irq\n\n#if LV_USE_LOG != 0\n/* Serial debugging */\nvoid my_print(const char * buf)\n{\n    Serial.printf(buf);\n    Serial.flush();\n}\n#endif\n\n/* Display flushing */\nvoid my_disp_flush( lv_disp_drv_t *disp, const lv_area_t *area, lv_color_t *color_p )\n{\n    uint32_t w = ( area->x2 - area->x1 + 1 );\n    uint32_t h = ( area->y2 - area->y1 + 1 );\n\n    tft.startWrite();\n    tft.setAddrWindow( area->x1, area->y1, w, h );\n    tft.pushColors( ( uint16_t * )&color_p->full, w * h, true );\n    tft.endWrite();\n\n    lv_disp_flush_ready( disp );\n}\n\n/*Read the touchpad*/\nvoid my_touchpad_read(lv_indev_drv_t * indev_driver, lv_indev_data_t * data )\n{\n    bool touched = touch.available();\n\n    if( !touched )\n    {\n        data->state = LV_INDEV_STATE_REL;\n    }\n    else\n    {\n        data->state = LV_INDEV_STATE_PR;\n\n        /*Set the coordinates*/\n        data->point.x = touch.data.x;\n        data->point.y = touch.data.y;\n\n        Serial.print( \"Data x \" );\n        Serial.println( touch.data.x );\n\n        Serial.print( \"Data y \" );\n        Serial.println( touch.data.y );\n    }\n}\n\nvoid setup()\n{\n    Serial.begin( 115200 ); /* prepare for possible serial debug */\n\n    String LVGL_Arduino = \"Hello Arduino! \";\n    LVGL_Arduino += String('V') + lv_version_major() + \".\" + lv_version_minor() + \".\" + lv_version_patch();\n\n    Serial.println( LVGL_Arduino );\n    Serial.println( \"I am LVGL_Arduino\" );\n\n    lv_init();\n\n#if LV_USE_LOG != 0\n    lv_log_register_print_cb( my_print ); /* register print function for debugging */\n#endif\n\n    tft.begin();          /* TFT init */\n    tft.setRotation( 2 ); /* 2:top fpc 4:bottom fpc */\n\n    touch.begin();\n    Serial.print(touch.data.version);\n    Serial.print(\"\\t\");\n    Serial.print(touch.data.versionInfo[0]);\n    Serial.print(\"-\");\n    Serial.print(touch.data.versionInfo[1]);\n    Serial.print(\"-\");\n    Serial.println(touch.data.versionInfo[2]);\n\n    lv_disp_draw_buf_init( &draw_buf, buf, NULL, screenWidth * 10 );\n\n    /*Initialize the display*/\n    static lv_disp_drv_t disp_drv;\n    lv_disp_drv_init( &disp_drv );\n    /*Change the following line to your display resolution*/\n    disp_drv.hor_res = screenWidth;\n    disp_drv.ver_res = screenHeight;\n    disp_drv.flush_cb = my_disp_flush;\n    disp_drv.draw_buf = &draw_buf;\n    lv_disp_drv_register( &disp_drv );\n\n    /*Initialize the (dummy) input device driver*/\n    static lv_indev_drv_t indev_drv;\n    lv_indev_drv_init( &indev_drv );\n    indev_drv.type = LV_INDEV_TYPE_POINTER;\n    indev_drv.read_cb = my_touchpad_read;\n    lv_indev_drv_register( &indev_drv );\n\n    /* Create simple label */\n    lv_obj_t *label_top = lv_label_create( lv_scr_act() );\n    lv_label_set_text( label_top, LVGL_Arduino.c_str() );\n    lv_obj_align( label_top, LV_ALIGN_TOP_LEFT, 0, 0 );\n\n    lv_obj_t *label = lv_label_create( lv_scr_act() );\n    lv_label_set_text( label, LVGL_Arduino.c_str() );\n    lv_obj_align( label, LV_ALIGN_CENTER, 0, 0 );\n\n    lv_obj_t *label_bottom = lv_label_create( lv_scr_act() );\n    lv_label_set_text( label_bottom, LVGL_Arduino.c_str() );\n    lv_obj_align( label_bottom, LV_ALIGN_BOTTOM_RIGHT, 0, 0 );\n\n    Serial.println( \"Setup done\" );\n}\n\nvoid loop()\n{\n    lv_timer_handler(); /* let the GUI do its work */\n    delay( 5 );\n}\n\n```\n\n## 5.lvgl demo\n\nä½¿ç”¨å®˜æ–¹demosæµç¨‹ï¼š\n\n* lv_conf.h ä¸­ `#define LV_USE_DEMO_WIDGETS 1`\n* å°†lvglåº“ä¸­çš„demosç§»åŠ¨åˆ°srcæ–‡ä»¶å¤¹ã€‚ä¸ç„¶ä¼šå‡ºç°`undefined reference to 'lv_demo_benchmark' `ï¼ˆä¾‹å¦‚lv_demo_benchmarkï¼‰ è¿™æ˜¯ç”±äºlv_demo_benchmark.cæœªè¢«ç¼–è¯‘å¯¼è‡´çš„ æŠŠdemosæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°lvglçš„srcç›®å½•ä¸‹å°±è¡Œäº†ï¼Œè¿™æ ·å°±ä¼šå‚ä¸åˆ°ç¼–è¯‘ä¸­äº†\n* åŒ…å«å¤´æ–‡ä»¶ï¼Œä¾‹å¦‚åœ¨main.cæ–‡ä»¶ä¸­ `#include \"demos/lv_demos.h\"`\n* åˆå§‹åŒ–ç­‰å‚è€ƒå®˜æ–¹ä¾‹ç¨‹ï¼Œsetupä¸­è°ƒç”¨demoä¸­çš„å‡½æ•°å³å¯ã€‚ `lv_demo_widgets();`\n\n\n## é¢åŒ…æ¿æµ‹è¯•\n\næ³¨æ„æ ¸å¯¹FPCåº§çš„çº¿åº(1è„šçš„ä½ç½®)\n\n| ESP32 | FPC | Function | Other             |\n| ----- | --- | -------- | ----------------- |\n| GND   | 1   | GND      |                   |\n| GND   | 2   | LED_K    | å¯é€šè¿‡PWMè°ƒæ•´äº®åº¦ |\n| 3V3   | 3   | VDD      | ä¾›ç”µ              |\n| 3V3   | 4   | VDD      |                   |\n| GND   | 5   | GND      |                   |\n| GND   | 6   | GND      |                   |\n| 2     | 7   | D/C      |                   |\n| GND   | 8   | CS       | é»˜è®¤æ‹‰ä½ä¸€ç›´æœ‰æ•ˆ  |\n| 18    | 9   | SCL      | SPI_SCL           |\n| 23    | 10  | SDA      | SPI_MOSI          |\n| 32    | 11  | REST     | LCD_RST           |\n| GND   | 12  | GND      |                   |\n| 4     | 13  | TP_SCL   | I2C0_SCL          |\n| 15    | 14  | TP_SDA   | I2C0_SDA          |\n| 5     | 15  | TP_RST   | Touch_RST         |\n| 34    | 16  | TP_INT   | Touch_INT         |\n| 3V3   | 17  | VDD      |                   |\n| GND   | 18  | GND      |                   |\n\n## 6.ä½¿ç”¨è‡ªå·±è®¾è®¡çš„PCBæ¿\n\nControler_ESP32_V0.1ï¼ˆPFCåº§æ–¹å‘åäº†ï¼‰\n\n| ESP32        | FPC | Function | Other               |\n| ------------ | --- | -------- | ------------------- |\n| GND          | 1   | GND      |                     |\n| GND          | 2   | LED_K    | å¯é€šè¿‡PWMè°ƒæ•´äº®åº¦   |\n| 3V3          | 3   | VDD      | ä¾›ç”µ                |\n| 3V3          | 4   | VDD      |                     |\n| GND          | 5   | GND      |                     |\n| GND          | 6   | GND      |                     |\n| 2            | 7   | D/C      |                     |\n| 32           | 8   | CS       |                     |\n| 18           | 9   | SCL      | SPI_SCL             |\n| 23           | 10  | SDA      | SPI_MOSI            |\n| PCA9535 IO10 | 11  | REST     | IOæ‰©å±•èŠ¯ç‰‡ I2C0æ§åˆ¶ |\n| GND          | 12  | GND      |                     |\n| 4            | 13  | TP_SCL   | I2C0_SCL            |\n| 15           | 14  | TP_SDA   | I2C0_SDA            |\n| PCA9535 IO11 | 15  | TP_RST   | IOæ‰©å±•èŠ¯ç‰‡ I2C0æ§åˆ¶ |\n| 34           | 16  | TP_INT   | Touch_INT           |\n| 3V3          | 17  | VDD      |                     |\n| GND          | 18  | GND      |                     |\n\n\n\n","tags":["ESP32"]},{"title":"å±€åŸŸç½‘å†…Raspberryä¸ŠæŠ¥IPåœ°å€è„šæœ¬ç¼–å†™åŠéƒ¨ç½²","url":"/2023/08/06/å±€åŸŸç½‘å†…Raspberryä¸ŠæŠ¥IPåœ°å€è„šæœ¬ç¼–å†™åŠéƒ¨ç½²/","content":"\nIP UDP Python Shell\n\n## 1.å®‰è£…pythonåŒ…\n\n```bash\nsudo pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple netifaces\n```\n\n## 2.å°†è„šæœ¬å¤åˆ¶åˆ°æŒ‡å®šçš„ç›®å½•\n\n/usr/local/bin/send_ipaddr_broadcast.py\n\n```python\n#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\nimport socket\nimport netifaces\nimport signal\nimport sys\nimport time\n\ndef send_broadcast_message(sock):\n    # è·å–æ ‘è“æ´¾çš„IPåœ°å€\n    interfaces = netifaces.interfaces()\n    for iface in interfaces:\n        addrs = netifaces.ifaddresses(iface)\n        if netifaces.AF_INET in addrs:\n            ip = addrs[netifaces.AF_INET][0]['addr']\n            if ip.find('127.0.0.1') >= 0:\n                continue\n\n            # å‘é€UDPå¹¿æ’­æ¶ˆæ¯\n            broadcast_ip = '255.255.255.255'  # å¹¿æ’­åœ°å€\n            port = 7893  # è‡ªå®šä¹‰ç«¯å£å·\n\n            message = \"Raspberry IP address is {}\".format(ip)\n\n            try:\n                sock.sendto(message.encode(), (broadcast_ip, port))\n            except socket.error as e:\n                print(\"Failed to send broadcast message:\", str(e))\n\ndef sigterm_handler(signal, frame):\n    # æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œä¾‹å¦‚å…³é—­å¥—æ¥å­—ç­‰\n    if sock:\n        sock.close()\n    sys.exit(0)\n\n# åˆ›å»ºéé˜»å¡å¼å¥—æ¥å­—\nsock = None\ntry:\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)\n    sock.setblocking(0)  # è®¾ç½®ä¸ºéé˜»å¡å¼å¥—æ¥å­—\nexcept socket.error as e:\n    print(\"Failed to create socket:\", str(e))\n    sys.exit(1)\n\n# æ³¨å†ŒSIGTERMä¿¡å·å¤„ç†å‡½æ•°\nsignal.signal(signal.SIGTERM, sigterm_handler)\n\n# è®¾ç½®ç­‰å¾…æ—¶é—´é—´éš”\nwait_interval = 5  # 5ç§’\n\n# å¾ªç¯å‘é€UDPå¹¿æ’­æ¶ˆæ¯\nstart_time = time.time()\nwhile True:\n    try:\n        current_time = time.time()\n        if current_time - start_time >= wait_interval:\n            send_broadcast_message(sock)\n            start_time = current_time\n        time.sleep(1)  # ä¼‘çœ 1ç§’ï¼Œé™ä½CPUä½¿ç”¨ç‡\n    except KeyboardInterrupt:\n        # å¦‚æœæ”¶åˆ°é”®ç›˜ä¸­æ–­ä¿¡å·ï¼Œé€€å‡ºå¾ªç¯\n        break\n\n# å…³é—­å¥—æ¥å­—\nif sock:\n    sock.close()\n```\n\n\n## 3.æ–°å»ºç³»ç»ŸæœåŠ¡\n\n* å°†send_ipaddr_broadcast.pyå¤åˆ¶åˆ°/etc/systemd/system/\n\n```shell\n[Unit]\nDescription=Send UDP Broadcast Service\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/send_ipaddr_broadcast.py\n\n[Install]\nWantedBy=multi-user.target\n\n```\n\n* å¼€å¯æœåŠ¡\n```bash\nsudo systemctl start send_ipaddr_broadcast.service\n```\n\n* å¼€æœºè‡ªå¯\n```bash\nsudo systemctl enable send_ipaddr_broadcast.service\n```\n\n## 4.æµ‹è¯•\n\n* æ‰“å¼€ç½‘ç»œè°ƒè¯•åŠ©æ‰‹\n\n* é€‰æ‹©UDPæ¨¡å¼\n\n* é€‰æ‹©åˆé€‚çš„æœ¬åœ°ä¸»æœºåœ°å€ï¼ˆé127.0.0.1ï¼‰\n* è¾“å…¥æœ¬åœ°ä¸»æœºç«¯å£7893\n* ç‚¹å‡»å¼€å¯æŒ‰é’®\n* æ¥æ”¶è®¾ç½®é€‰æ‹©ï¼šASCIIæ¨¡å¼\n\n![test](test.png)","tags":["RaspberryPi"]},{"title":"Win10ç³»ç»Ÿä¸‹é…ç½®opencvåº“å¹¶åœ¨QTä¸­ä½¿ç”¨","url":"/2023/08/06/Win10ç³»ç»Ÿä¸‹é…ç½®opencvåº“å¹¶åœ¨QTä¸­ä½¿ç”¨/","content":"\nOpenCV Qt Windows10\n\n1. å®˜ç½‘ç»„è£…[https://opencv.org/releases/](https://opencv.org/releases/)ä¸‹è½½Windowsç¯å¢ƒæ‰€ä½¿ç”¨çš„å‹ç¼©åŒ…ï¼ˆåŒ…å«æºæ–‡ä»¶å’Œç¼–è¯‘å¥½çš„åº“æ–‡ä»¶ï¼‰\n\n2. å°†å‹ç¼©åŒ…è§£å‹åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ï¼Œå¦‚G:\\\n   \n   ![opencv_file_list](opencv_file_list.png)\n   \n3. ç¼–è¾‘WIndowç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå¢åŠ ï¼ˆG:\\opencv\\build\\x64\\vc15\\binï¼‰\n\n4. qtæ–°å»ºç•Œé¢åº”ç”¨å·¥ç¨‹ï¼Œä½¿ç”¨MSCVç¼–è¯‘å™¨ã€‚\n\n5. qté¡¹ç›®æ–‡ä»¶å¤¹å¤„å³å‡»ï¼Œé€‰æ‹©æ·»åŠ åº“ã€‚\n\n   ![qt_add_library](qt_add_library.png)\n\n6. å¤–éƒ¨åº“ï¼Œä¸‹ä¸€æ­¥ï¼›\n\n7. åº“æ–‡ä»¶ï¼šG:/opencv/build/x64/vc15/lib/opencv_world345.libï¼›åŒ…å«è·¯å¾„ï¼šG:/opencv/build/includeï¼›å‹¾é€‰debugç‰ˆæ·»åŠ 'd'ï¼›ä¸‹ä¸€æ­¥ï¼Œå®Œæˆï¼›è½¯ä»¶ä¼šå°†é…ç½®ä¿¡æ¯æ·»åŠ åˆ°.Proå·¥ç¨‹æ–‡ä»¶ä¸­ï¼›\n\n   ![qt_set_project](qt_set_project.png)\n\n8. å‡†å¤‡ä¸€å¼ å›¾ç‰‡ï¼Œæ³¨æ„å›¾ç‰‡ååŠè·¯å¾„ä»…å¯ä½¿ç”¨è‹±æ–‡å­—ç¬¦ã€‚å¦‚G:\\opencv\\demo.png\n\n9. ä¿®æ”¹ä»£ç mainwindow.cppï¼Œæ³¨æ„æ–‡ä»¶è·¯å¾„\n\n```c++\n#include \"mainwindow.h\"\n#include \"ui_mainwindow.h\"\n\n#include <opencv2/highgui/highgui.hpp>\n#include <opencv2/core/core.hpp>\n\nMainWindow::MainWindow(QWidget *parent) :\n    QMainWindow(parent),\n    ui(new Ui::MainWindow)\n{\n    ui->setupUi(this);\n\n    cv::Mat image = cv::imread(\"G:/opencv/demo.png\");\n    cv::namedWindow(\"My Image\");\n    cv::imshow(\"window\", image);\n//    cv::waitKey(-1);\n}\n\nMainWindow::~MainWindow()\n{\n    delete ui;\n}\n```\n\n10. æ–­ç‚¹è°ƒè¯•\n\nç‚¹å‡»DebugæŒ‰é’®å¼€å§‹è°ƒè¯•ï¼Œä¼šæœ‰å›¾ç‰‡åŠç•Œé¢å¼¹å‡ºã€‚å¢åŠ æ–­ç‚¹éªŒè¯è°ƒè¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚\n","tags":["OpenCV"]},{"title":"pyqtæ•°å€¼è¾“å…¥æ¡†ä¸è¿›åº¦æ¡è”åŠ¨","url":"/2023/08/06/pyqtæ•°å€¼è¾“å…¥æ¡†ä¸è¿›åº¦æ¡è”åŠ¨/","content":"\nQSlider QSpinBox QDoubleSpinBox\n\n## 1.èƒŒæ™¯\n\n1. QSpinBox/QDoubleSpinBoxï¼ˆæ•°å€¼è¾“å…¥æ¡†ï¼‰ï¼š\n\n   ä½¿ç”¨`valuechange`ä¿¡å·ï¼Œåœ¨ä¿®æ”¹æ•°å€¼çš„è¿‡ç¨‹ä¸­ä¼šå‘é€ä¿¡å·ï¼Œå¦‚è¾“å…¥123ï¼Œåˆ™ä¼šè§¦å‘1ã€12ã€123ä¸‰æ¡ä¿¡å·ã€‚è‹¥æ˜¯åˆ é™¤åŸæœ‰æ•°æ®ï¼Œäº§ç”Ÿçš„ä¿¡å·ä¼šæ›´å¤šã€‚`editingFinished`åœ¨è¾“å…¥å®Œæˆåé¼ æ ‡ç¦»å¼€æ§ä»¶ï¼ˆå¤±å»ç„¦ç‚¹ï¼‰æˆ–æŒ‰ä¸‹å›è½¦æ‰ä¼šè§¦å‘ä¿¡å·ã€‚\n\n2. QSlider ï¼ˆè¿›åº¦æ¡ï¼‰ï¼š\n\n   ä½¿ç”¨`valuechange`ä¿¡å·ï¼Œåœ¨æ»‘å—æ‹–åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¿¡å·å°†ä¼šè¢«é¢‘ç¹å‘é€ã€‚ å¦‚æœæ˜¯ä¸Šä½æœºé€šè¿‡ä¸²å£å‘ä¸‹ä½æœºå‘é€æŒ‡ä»¤ï¼Œä¸€èˆ¬ä¸‹ä½æœºï¼ˆç®€å•MCUåšä¸»æ§ï¼‰æ— æ³•å“åº”é«˜é¢‘ç‡çš„æŒ‡ä»¤ã€‚\t`released`ä¿¡å·åªæœ‰åœ¨é‡Šæ”¾æ»‘å—æ—¶æ‰ä¼šå‘é€ï¼Œä½†ç‚¹å‡»slideréƒ¨ä»¶é€ æˆçš„æ»‘å—ç§»åŠ¨ï¼Œå¹¶ä¸ä¼šå‘é€releasedä¿¡å·ï¼Œå°±é€ æˆå½“å‰æ»‘å—ä½ç½®ä¸å®é™…å‚æ•°ä¸ä¸€è‡´çš„BUGã€‚\n\n\n\n## 2.æ§ä»¶è”åŠ¨å’Œä¿¡å·çš„äº§ç”Ÿ\n\n1. åˆ›å»ºæ§ä»¶\n\n```python\n# æ•´æ•°\nself.d_slider = QtWidgets.QSlider(self.xxx)\nself.d_spin_box = QtWidgets.QSpinBox(self.xxx)\n# å°æ•°\nself.f_slider = QtWidgets.QSlider(self.xxx)\nself.f_slider = QtWidgets.QDoubleSpinBox(self.xxx)\n```\n\n\n\n2. doubleæ•°å€¼è¾“å…¥å’Œæ•´æ•°è¿›åº¦æ¡æ§ä»¶ç›¸äº’è½¬æ¢éœ€ç‰¹æ®Šå¤„ç†ï¼ˆæ­¤å¤„å›ºå®šä¸º1ä¸ªå°æ•°ç‚¹ï¼‰\n\n```python\ndef xx_sTb\n\tself.f_spin_box.setValue(self.f_slider.value() / 10)\n    \ndef xx_bTs\n\tself.f_slider.setValue(self.f_spin_box.value() * 10)\n```\n\n\n\n3. å®ç°è¾“å…¥æ¡†å’Œè¿›åº¦æ¡è”åŠ¨ï¼ˆä¿¡å·å’Œæ§½ï¼‰\n\n```python\n# æ•´æ•°ç›´æ¥ç›¸äº’è®¾ç½®\nself.d_slider.valueChanged.connect(self.d_spin_box.setValue)\nself.d_spin_box.valueChanged.connect(self.d_slider.setValue)\n\n#å°æ•°éœ€é€šè¿‡å‡½æ•°è½¬æ¢\nself.f_slider.valueChanged.connect(self.xx_sTb)\nself.f_spin_box.valueChanged.connect(self.xx_bTs)\n```\n\n\n\n4. æ§½å‡½æ•°\n\n```python\n# æ§½å‡½æ•°\nself.event_list = [\n\tlambda: self._send_message(0), lambda: self._send_message(1)\n]\n\n# å…·ä½“æ“ä½œå†…å®¹\ndef _send_message(self, id: int):\n    if id == 0:\n        print(\"send0\")\n        buf = self.d_spin_box.value()  # æ•°å€¼è¾“å…¥æ¡†çš„å€¼ è¿›åº¦æ¡ä»…ä¸ºæ•´æ•°éœ€æ”¾å¤§å’Œç¼©å°\n    if id == 1:\n        print(\"send1\")\n        buf = self.f_spin_box.value()\n```\n\n\n\n5. å®ç°ä¿¡å·å‘å‡ºï¼ˆä¿¡å·å’Œæ§½ï¼‰\n\n```\n# \nself.d_slider.sliderReleased.connect(self.event_list[0])\nself.d_spin_box.editingFinished.connect(self.event_list[0])\n\nself.f_slider.sliderReleased.connect(self.event_list[1])\nself.f_spin_box.editingFinished.connect(self.event_list[1])\n\n```\n\n\n\n6. ä»¥ä¸Šå®ç°äº†æ§ä»¶è”åŠ¨å’Œä¿¡å·çš„äº§ç”Ÿå‘é€ï¼Œä½†æ˜¯å¼€å¤´æåˆ°çš„**æ»‘å—ä½ç½®ä¸å®é™…å‚æ•°ä¸ä¸€è‡´çš„BUG**æ²¡æœ‰è§£å†³\n\n\n\n## 3.è§£å†³æ»‘å—å•æœºæ— ä¿¡å·çš„é—®é¢˜\n\n1. å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨\n\n```python\n# ä¸ºæ»‘å—å®‰è£…è¿‡æ»¤å™¨\nself.d_slider.installEventFilter(self)\nself.f_slider.installEventFilter(self)\n```\n\n\n\n2. é‡å†™äº‹ä»¶è¿‡æ»¤æ–¹æ³•ã€‚å°†æ»‘å—çš„å·¦é”®å•å‡»ï¼Œä¿®æ”¹ä¸ºæ»‘å—é‡Šæ”¾ä¿¡å·\n\n```python\ndef eventFilter(self, a0: 'QObject', a1: 'QEvent') -> bool:\n    name = a0.objectName()\n    # åˆ¤æ–­æ§ä»¶åç§° é˜²æ­¢ä¸å…¶ä»–å®‰è£…äº†è¿‡æ»¤å™¨çš„æ§ä»¶ç›¸äº’å½±å“\n    if name.endswith(\"_slider\") or name.endswith(\"_dslider\"):\n        if a1.type() == a1.MouseButtonRelease and a1.button() == 1: # åˆ¤æ–­å·¦é”®\n            0.setSliderDown(True)  #æ¨¡æ‹Ÿæ»‘å—çš„ç‚¹å‡»\n            a0.setSliderDown(False) #æ¨¡æ‹Ÿæ»‘å—çš„ç‚¹å‡»\n            # å¿…éœ€å…ˆæŒ‰ä¸‹åé‡Šæ”¾ï¼Œæ‰èƒ½è§¦å‘sliderReleasedä¿¡å·\n    return False\n```\n","tags":["PyQt"]},{"title":"TheengsGatewayåº”ç”¨æŒ‡å—","url":"/2023/08/06/TheengsGatewayåº”ç”¨æŒ‡å—/","content":"\nTheengs Gateway Python\n\n## 1.Advanced users - Build and install\n\n1. å‚è€ƒhttps://gateway.theengs.io/install/install.html#install-theengs-gateway-as-a-docker\n2. è‹¥ä½¿ç”¨è‡ªå·±ä¿®æ”¹çš„TheengsDecoderï¼Œæ³¨æ„åœ¨setup.pyæ–‡ä»¶ä¸­ä¿®æ”¹ä¾èµ–åŒ…çš„ç‰ˆæœ¬ã€‚\n3. setup.pyä¿®æ”¹versionç‰ˆæœ¬å·ï¼Œä¾‹å¦‚`version=\"1.1.0\"`\n4. `__main__.py`è°ƒè¯•é¡¹ç›®ï¼Œæç¤ºimportå¤±è´¥ï¼Œéœ€å°†`from . import main`æ”¹ä¸º`from TheengsGateway import main`\n\nå¢åŠ å¯¹ä¸²å£çš„æ”¯æŒ\n\n```python\n    async def serial_wr_loop(self) -> None:\n        async def read_from_serial(reader):\n            count = 0\n            self.running = True\n            while not self.stopped:\n                data = await reader.read(1000)\n                count += 1\n\n                logger.info(\n                    \"Received at `%s` from Serial: `%s`\",\n                    count,\n                    data,\n                )\n\n                data_json = {}\n                if 'None' in gw.serial_device:\n                    logger.error(\"gw.serial_device is None, please check\")\n                    self.stopped = True\n                elif 'YE600X' in gw.serial_device:\n                    # YE600X è®¾å¤‡è°ƒè¯• ä½¿ç”¨ä¸²å£åŠ©æ‰‹ä»¥åå…­è¿›åˆ¶æ–¹å¼å‘é€æµ‹è¯•æ•°æ® 1e 5f 00 41 00 4b 00 e1 07 07 0c 08 0a 19 40 00 00 04 00\n                    try:\n                        data_str = bytes.decode(data, encoding='utf8')\n                        if data_str.find(\"CONNECTED\") >= 0:\n                            self.serial_mac = bytes.decode(data[data_str.find(\",\")+1:], encoding='utf8')\n                            self.serial_connect_status = \"online\"\n                            logger.info(\"serial device connected, mac: %s\", self.serial_mac)\n                        if data_str.find(\"DISCONN\") >= 0:\n                            self.serial_mac = bytes.decode(data[data_str.find(\",\")+1:], encoding='utf8')\n                            self.serial_connect_status = \"offline\"\n                            logger.info(\"serial device disconnected, mac: %s\", self.serial_mac)\n                    except:\n                        logger.info(\"serial read ascii data\")\n                    data_json[\"name\"] = \"YE600X\"\n                    data_json[\"mac\"] = self.serial_mac\n                    data_json[\"connect_status\"] = self.serial_connect_status\n                    data_json[\"manufacturerdata\"] = ''.join(['%02X' % b for b in data])\n                elif 'sps' in gw.serial_device:\n                    # sps è®¾å¤‡è°ƒè¯• ä½¿ç”¨ä¸²å£åŠ©æ‰‹ä»¥åå…­è¿›åˆ¶æ–¹å¼å‘é€æµ‹è¯•æ•°æ® af 09 7C 18 01 f9 9c 44 08\n                    data_json[\"manufacturerdata\"] = ''.join(['%02X' % b for b in data])\n                    data_json[\"id\"] = \"88:33:22:FF:44:77\"\n                    data_json[\"name\"] = \"sps\"\n                    data_json[\"rssi\"] = -15\n                else:\n                    logger.error(\"gw.serial_device is not defined, please check\")\n                    self.stopped = True\n\n                decoded_json = decodeBLE(json.dumps(data_json))  # å°†pythonå¯¹è±¡ç¼–ç æˆJsonå­—ç¬¦ä¸²\n                if decoded_json is None:\n                    logger.info(\"serial decodeBLE return None\")\n                else:\n                    msg = decoded_json\n                    gw.publish(\n                        msg,\n                        gw.presence_topic,\n                    )\n            logger.error(\"serial read loop stopped\")\n            self.running = False\n\n        async def write_to_serial(writer):\n            self.running = True\n            while not self.stopped:\n                writer.write(b'off\\n')\n                await writer.drain()\n                await asyncio.sleep(2)\n            logger.error(\"serial write loop stopped\")\n            self.running = False\n        try:\n            reader, writer = await serial_asyncio.open_serial_connection(url=gw.serial_port, baudrate=115200)\n            task_1 = asyncio.create_task(read_from_serial(reader))\n            task_2 = asyncio.create_task(write_to_serial(writer))\n            await task_1\n            await task_2\n        except:\n            self.running = False\n            self.stopped = True\n            logger.error(\"serial %s port open failed, please check\", gw.serial_port)\n            \n            \ndef run(arg: str) -> None:\n    # ä¿®æ”¹\n    thread = Thread(target=loop.run_forever, daemon=True)\n    thread.start()\n    asyncio.run_coroutine_threadsafe(gw.serial_wr_loop(), loop)\n```\n\n```python\ndef main() -> None:\n    # å¢åŠ ä¸²å£ç«¯å£å·å’Œç›®æ ‡è®¾å¤‡ç±»å‹çš„é€‰é¡¹\n    parser.add_argument(\n        \"-sp\", \"--serial_port\", dest=\"serial_port\", type=str, help=\"Serial port\"\n    )\n    parser.add_argument(\n        \"-si\", \"--serial_device_id\", dest=\"serial_device\", type=str, help=\"Serial device id, need check <TheengsDecoder/src/devices/list>\"\n    )\n    # å°† serial_port  serial_device åŠ å…¥é…ç½®æ–‡ä»¶çš„è¯»å†™ï¼Œå¹¶ä¼ é€’ç»™ Gateway\n```\n\n","tags":["IoT"]},{"title":"TheengsDecoderåº”ç”¨æŒ‡å—","url":"/2023/08/06/TheengsDecoderåº”ç”¨æŒ‡å—/","content":"\nTheengs Decoder Python\n\n## 1.é¡¹ç›®æ­å»º\n\n1. cloneå·¥ç¨‹\n2. å°†ä¸‹è½½arduino_jsoné¡¹ç›®å¹¶å¤åˆ¶åˆ°src\\arduino_jsonæ–‡ä»¶å¤¹ä¸­\n3. å¦‚æœæ˜¯pythonä½¿ç”¨ï¼ŒæŸ¥çœ‹https://decoder.theengs.io/use/python.html#dependencies (windows ä¸‹ä¸ç”¨apt-get install cmakeæŒ‡ä»¤ï¼Œåœ¨pip install . æŒ‡ä»¤è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–)\n4. åœ¨src\\device\\ä¸­å¢åŠ æ–°çš„ç¡¬ä»¶è§£ç è§„åˆ™ï¼Œdevice.hä¸­å¢åŠ å¤´æ–‡ä»¶ï¼Œå¹¶åŠ å…¥åˆ—è¡¨\n5. decoder.hä¸­å°†æ–°ç¡¬ä»¶åŠ å…¥åˆ—è¡¨ï¼ˆBLE_ID_MAXçš„å‰é¢ï¼‰\n6. æ³¨æ„æ¯æ¬¡ä¿®æ”¹å®Œè§£ç è§„åˆ™æ–‡ä»¶ï¼Œå¿…é¡»é‡æ–°ç¼–è¯‘(ä¾‹å¦‚pythonä¸‹ä½¿ç”¨pip install .)ç”Ÿæ•ˆåæ–¹å¯æµ‹è¯•\n\n## 2.æµ‹è¯•è„šæœ¬\n\n```python\nimport json\nfrom TheengsDecoder import decodeBLE as dble\n\ndata_json = {\"manufacturerdata\": \"1E5F0041004B00E107070C080A194000000400\", \"name\": \"YE600X\"}\n# data_json = {\"manufacturerdata\": \"af097C1801f99c4408\", \"name\": \"sps\"}\ndata = dble(json.dumps(data_json))\nprint(data)\n```\n\n## 3.æ–°å¢è§£ç è§„åˆ™\n\nYE600X_json.h\n\nè¢«`/*R\"\"\"\"(`æ³¨é‡Šçš„ä»£ç è¦ç¬¦åˆjsonæ ¼å¼\n\nåˆ é™¤ç©ºæ ¼å›è½¦ï¼Œå°†`\"`å‰å¢åŠ è½¬ä¹‰ç¬¦`\\`\n\nç´¢å¼•ç¼–å·ä»0å¼€å§‹ï¼Œæ¯ä¸ªå­—ç¬¦å ä¸€ä¸ªï¼›å› ä¸ºæ¯ä¸ªå­—ç¬¦éƒ½æ˜¯åˆ†å¼€è®¡ç®—çš„ï¼Œæ•…ä½ç¼–å·èŒƒå›´0-3\n\n```\nconst char* _YE600X_json = \"{\\\"brand\\\":\\\"YUWELL\\\",\n/*R\"\"\"\"(            //è¡€å‹\n{\n   \"brand\":\"YUWELL\",                   //å“ç‰Œï¼šé±¼è·ƒ\n   \"model\":\"BloodPressureMeters\",      //å‹å·ï¼šè¡€å‹ä»ª\n   \"model_id\":\"YE600X\",                //å‹å·IDï¼šYE600X\n   \"cidc\":false,                       //èµ·å§‹å­—èŠ‚ä¸ç¬¦åˆBluetoothæ ‡å‡†\n   \"condition\":[\"manufacturerdata\", \"=\", 38, \"&\", \"name\", \"index\", 0, \"YE600X\"],  //æ¡ä»¶ï¼šname = YE600X\n   \"properties\":{\n      \"pressure_unit\":{\n         \"decoder\":[\"bit_static_value\", \"manufacturerdata\", 1, 0, \"mmHg\", \"kPa\"]  //è¡€å‹å•ä½ï¼š ç¬¬0å­—èŠ‚ ç¬¬0ä½  trueï¼šmmHg falseï¼škpa\n      },\n      \"systolic_pressure\":{\n         \"decoder\":[\"value_from_hex_data\", \"manufacturerdata\", 2, 4, true]\n      }\n    }\n}\n\nconst char* _YE600X_json_props = \"{\\\"properties\\\":\n/*R\"\"\"\"(\n{\n   \"properties\":{\n      \"pressure_unit\":{\n         \"unit\":\"string\",\n         \"name\":\"contact\"\n      },\n      \"systolic_pressure\":{\n         \"unit\":\"string\",\n         \"name\":\"contact\"\n      }\n    }\n}\n```\n","tags":["IoT"]},{"title":"Qtåˆ›å»ºC++åŠ¨æ€åº“DLL","url":"/2023/08/06/Qtåˆ›å»ºCPPåŠ¨æ€åº“DLL/","content":"\n## 1.åˆ›å»ºC++åŠ¨æ€åº“DLL\n\nä¸ºäº†æé«˜ä»£ç å¤ç”¨æ€§ï¼Œå®ç°æ¨¡å—åŒ–å¼€å‘ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¯¹ä¸€äº›å¸¸ç”¨å‡½æ•°è¿›è¡Œå°è£…ï¼Œé€šè¿‡è°ƒç”¨åŠ¨æ€é“¾æ¥åº“çš„æ–¹æ³•å®ç°ï¼ŒQtè‡ªç”Ÿä¾¿èƒ½æ„å»ºå…±äº«åº“ã€‚\n\n## 1.1æ–°å»ºå…±äº«åº“å·¥ç¨‹\n\n* æ–°å»ºå·¥ç¨‹ï¼Œé€‰æ‹©åŠ¨æ€åº“ï¼Œå‘½åä¸ºDynamicLibraryï¼Œå®ç°ä¸€ä¸ªç®€å•çš„æ–¹æ³•(method) : int test()\n\nDynamicLibrary_global.h\n\n```C++\n#ifndef DYNAMICLIBRARY_GLOBAL_H\n#define DYNAMICLIBRARY_GLOBAL_H\n\n#include <QtCore/qglobal.h>\n\n#if defined(DYNAMICLIBRARY_LIBRARY)\n#  define DYNAMICLIBRARY_EXPORT Q_DECL_EXPORT\n#else\n#  define DYNAMICLIBRARY_EXPORT Q_DECL_IMPORT\n#endif\n\n#endif // DYNAMICLIBRARY_GLOBAL_H\n```\n\n\n\ndynamiclibrary.h\n\n```c++\n#ifndef DYNAMICLIBRARY_H\n#define DYNAMICLIBRARY_H\n\n#include \"DynamicLibrary_global.h\"\n\nclass DYNAMICLIBRARY_EXPORT DynamicLibrary\n{\npublic:\n    DynamicLibrary();\n    int test();\n};\n\n#endif // DYNAMICLIBRARY_H\n```\n\ndynamiclibrary.cpp\n\n```C++\n#include \"dynamiclibrary.h\"\n#include <QDebug>\n\nDynamicLibrary::DynamicLibrary()\n{\n}\n\nint DynamicLibrary::test()\n{\n    qDebug() << \"Hello Qt5\";\n    int sum = 0;\n    for (int i=1; i<=100; i++) {\n        sum = sum + i;\n    }\n    qDebug() << sum;\n    return sum;\n}\n```\n\n* Build(Debug) å¾—åˆ°åŠ¨æ€åº“`DynamicLibrary.dll`\n\n## 1.2è°ƒç”¨åŠ¨æ€åº“\n\n* æ–°å»ºä¸€ä¸ªæ§åˆ¶å°å·¥ç¨‹LoadDynamicï¼Œç”¨äºæµ‹è¯•è°ƒç”¨å‰é¢æ„å»ºçš„åŠ¨æ€åº“dll\n* å¯¼å…¥ç›¸å…³å¤´æ–‡ä»¶ï¼Œå…ˆå¤åˆ¶å¤´æ–‡ä»¶è‡³å·¥ç¨‹è·¯å¾„ä¸‹(DynamicLibrary_global.h  dynamiclibrary.h)ï¼Œç„¶åé¡¹ç›®å•å‡»å³é”®æ·»åŠ ç°æœ‰æ–‡ä»¶ã€‚\n* é“¾æ¥åº“ï¼Œé…ç½®proæ–‡ä»¶ï¼Œå¢åŠ åŠ¨æ€é“¾æ¥åº“çš„è·¯å¾„`LIBS += xxx\\debug\\DynamicLibrary.dll`\n* Build(Debug) å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶\n* è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶éœ€è¦ç³»ç»Ÿæ‰¾åˆ°å¯¹åº”çš„åŠ¨æ€é“¾æ¥åº“ï¼Œå¯ä»¥å°†åŸæ¥ç”Ÿæˆçš„åŠ¨æ€é“¾æ¥åº“æ‹·è´è‡³å¯æ‰§è¡Œæ–‡ä»¶åŒçº§ç›®å½•ä¸‹\n* å…¶ä»–ä¾èµ–æ–‡ä»¶ï¼šå¼€å§‹-Qt-Qtå‘½ä»¤è¡Œï¼Œè¾“å…¥windeployqt xxx\\debug\\LoadDynamic.exe\n* å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å¤„è¾“å…¥cmdï¼Œæ‰“å¼€å‘½ä»¤è¡Œè¾“å…¥LoadDynamic.exeè¿è¡Œ\n* lddæˆ–dependsæ£€æŸ¥ä¾èµ–åº“æƒ…å†µ","tags":["Qt"]},{"title":"ESP-USB-Bridge-JTAG-Debug","url":"/2022/05/08/ESP-USB-Bridge-JTAG-Debug/","content":"\n## 1.Create Project\n\nOpen VSCode\n\n<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>    `ESP-IDF: Show Examples Projects`  `hello_world`\n\n**Create project using example hello_world**\n\n## 2.Setup\n\nSelect port to use (COMx)\n\nset device targete\n\nBuild project\n\nSelect flash method (JTAG)\n\n![image-20220508171334927](image-20220508171334927.png)\n\n![image-20220508171702904](image-20220508171702904.png)\n\nedit file: `.vscode/settings.json`  (æ³¨æ„ä¿®æ”¹**COMx**)\n\n``` json\n{\n  \"C_Cpp.intelliSenseEngine\": \"Tag Parser\",\n  \"idf.portWin\": \"COMx\",\n  \"idf.openOcdConfigs\": [\n    \"interface/esp_usb_bridge.cfg\",\n    \"target/esp32.cfg\"\n  ],\n  \"idf.flashType\": \"JTAG\"\n}\n```\n\n<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>  `ESP-IDF: OpenOCD Manager`  `start openocd`\n\n![image-20220508173310006](image-20220508173310006.png)\n\n[.vscode/settings.json](https://github.com/espressif/vscode-esp-idf-extension/blob/master/docs/DEBUGGING.md)\n\n``` c\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"GDB\",\n      \"type\": \"cppdbg\",\n      \"request\": \"launch\",\n      \"MIMode\": \"gdb\",\n      \"miDebuggerPath\": \"${command:espIdf.getXtensaGdb}\",\n      \"program\": \"${workspaceFolder}/build/${command:espIdf.getProjectName}.elf\",\n      \"windows\": {\n        \"program\": \"${workspaceFolder}\\\\build\\\\${command:espIdf.getProjectName}.elf\"\n      },\n      \"cwd\": \"${workspaceFolder}\",\n      \"environment\": [{ \"name\": \"PATH\", \"value\": \"${config:idf.customExtraPaths}\" }],\n      \"setupCommands\": [\n        { \"text\": \"target remote :3333\" },\n        { \"text\": \"set remote hardware-watchpoint-limit 2\"},\n        { \"text\": \"mon reset halt\" },\n        { \"text\": \"thb app_main\" },\n        { \"text\": \"flushregs\" }\n      ],\n      \"externalConsole\": false,\n      \"logging\": {\n        \"engineLogging\": true\n      }\n    }\n  ]\n}\n```\n\n## 3.Flash And Debug\n\nflash\n\n![image-20220508174242796](image-20220508174242796.png)\n\n<kbd>F5</kbd>  \n\n   *Try more times*\n\n![image-20220508174435026](image-20220508174435026.png)\n\nOther\n\n  [https://github.com/espressif/vscode-esp-idf-extension/blob/master/docs/tutorial/debugging.md](https://github.com/espressif/vscode-esp-idf-extension/blob/master/docs/tutorial/debugging.md)\n\n\n","tags":["ESP32"]},{"title":"ESP-USB-Bridge","url":"/2022/05/02/ESP-USB-Bridge/","content":"\n[https://github.com/espressif/esp-usb-bridge](https://github.com/espressif/esp-usb-bridge)\n\n## 1.Clone\n\n``` sh\ngit clone --depth 1 https://github.com/espressif/esp-usb-bridge.git\n```\n\n## 2.VSCode\n\n<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>P</kbd> `ESP-IDF: Open ESP-IDF Terminal`\n\n1. Config\n\n``` sh\nidf.py menuconfig\n```\n\ndown: <kbd>J</kbd>   up:<kbd>K</kbd> \n\nsettings are in the \"Bridge Configuration\" sub-menu, swap  TDO/TDI target pin num.\n\n2. Build\n\n``` sh\nidf.py build\n```\n\n3. Flash\n\n``` sh\nidf.py -p PORT flash monitor\n```\n\nPORT is the serial port created by an USB-to-UART chip\n\nTips: set boot load mode\n\n![Step](set-boot-step.png)\n\n4. Reboot\n\n## 3.Install Driver\n\nWindows Device manager\n\n![device manager 0](device-manager-0.png)\n\ninstall driver\n\n[UsbDriverTool](https://visualgdb.com/UsbDriverTool/)\n\n![install driver.png](install-driver.png)\n\ninstall success\n\n![device manager 1](device-manager-1.png)\n\n## 4.Connect Target\n\n1. connect target mcu\n\n![concept](concept.png)\n\n2. set target mcu download mode\n\n![target mcu download mode](target-mcu-download-mode.png)\n\n3. OpenOCD connect ESP32-WROVER-E\n\n<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>P</kbd> ESP-IDF: Open ESP-IDF Terminal\n\n``` sh\nopenocd.exe -f interface/esp_usb_bridge.cfg -f target/esp32.cfg\n```\n\n![connect esp32 wrover](connect-esp32-wrover.png)\n\n3. use jtag flash\n\n![use jtag flash](use-jtag-flash.png)\n\n4. use serial\n\n   * Select Port  (COMx)\n\n   * ESP-IDF Monitor device\n\n   * reboot target mcu\n\n![serial test](serial-test.png)\n\n\n","tags":["ESP32"]},{"title":"ESP32 Windows VSCode IDE","url":"/2022/05/02/ESP32-Window-VSCode/","content":"\n[ESP-IDF Document](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/index.html)\n\n##  1.VSCode\n\n[Download](https://code.visualstudio.com/download) and install  Visual Studio Code\n\n## 2.VSCode Extension\n\n1. [Espressif IDF](https://marketplace.visualstudio.com/items?itemName=espressif.esp-idf-extension)\n2. [C/C++](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools)\n3. [Native Debug](https://marketplace.visualstudio.com/items?itemName=webfreak.debug)\n\n## 3.Install ESP-IDF\n\n<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>P</kbd>  ESP-IDF: Configure ESP-IDF extension\n\nChoose installation method (EXPRESS / ADVANCED / USE EXISTING SETUP)\n\n## 4.Creat Project\n\n<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>P</kbd> ESP-IDF: Show Examples Projects\n\nget-started >hello_world > Create project using example hello_world\n\n1. Select Port\n2. Set Espressif device target\n3. Build\n4. Select flash method\n5. flash device\n6. Monitor device\n","tags":["ESP32"]},{"title":"FR-CS80 FVD Modbus Communication","url":"/2022/04/03/FR-CS80-VFD-Modbus/","content":"\nMITSUBISHI ä¸‰è± VFD å˜é¢‘å™¨ Modbus é€šè®¯ RS485\n\n## 1.ä¾›ç”µ\n\n![image-20220329235106376](image-20220329235106376.png)\n\n## 2.é€šè®¯æ¥çº¿\n\n![image-20220329235152416](image-20220329235152416.png)\n\n![image-20220329235832966](image-20220329235832966.png)\n\n![image-20220330000913954](image-20220330000913954.png)\n\n| USB-RS422 | T-568B | VFD     |\n| --------- | ------ | ------- |\n| T+        | G/   3 | RDA(R+) |\n| T-        | G    6 | RDB(R-) |\n| R+        | B/   5 | SDA(T+) |\n| R-        | B    4 | SDB(T-) |\n\n## 3.å˜é¢‘å™¨å‚æ•°è®¾ç½®\n\né¦–å…ˆæ¢å¤å‡ºå‚è®¾ç½®\n\n![image-20220330001346543](image-20220330001346543.png)\n\n\n\næŒ‰ç…§è¡¨æ ¼ä¾æ¬¡è®¾ç½®\n\n| Pr.  | åç§°                 | è®¾å®šå€¼ | å†…å®¹                                        |\n| ---- | -------------------- | ------ | ------------------------------------------- |\n| 117  | PU é€šè®¯ç«™å·          | 1      | ä»æœºåœ°å€                                    |\n| 118  | PU é€šè®¯é€Ÿåº¦          | 192    | 19200pbs                                    |\n| 120  | PU é€šè®¯å¥‡å¶æ ¡éªŒ      | 2      | å¶æ•°æ ¡éªŒ                                    |\n| 122  | PU é€šè®¯æ ¡éªŒæ—¶é—´é—´éš”  | 9999   | ä¸è¿›è¡Œé€šè®¯æ–­çº¿æ£€æµ‹                          |\n| 79   | è¿è¡Œæ¨¡å¼é€‰æ‹©         | 0      | ç½‘ç»œè¿è¡Œæ¨¡å¼ï¼ˆå¯åˆ‡æ¢PU/ç½‘ç»œï¼‰               |\n| 340  | é€šè®¯å¯åŠ¨æ¨¡å¼é€‰æ‹©     | 10     | ç½‘ç»œè¿è¡Œæ¨¡å¼ï¼ˆå¯åˆ‡æ¢PU/ç½‘ç»œï¼‰               |\n| 342  | é€šè®¯ EEPROM å†™å…¥é€‰æ‹© | 1      | PUæ¥å£å†™å…¥å‚æ•°ä»…é™RAMï¼ˆé˜²æ­¢é¢‘ç¹å†™å…¥EEPROMï¼‰ |\n| 549  | åè®®é€‰æ‹©             | 1      | MODBUS RTU åè®®                             |\n\nè¯´æ˜ï¼š\n\nmodbusé€šè®¯å˜é¢‘å™¨å¿…é¡»å·¥ä½œåœ¨**ç½‘ç»œè¿è¡Œæ¨¡å¼**ä¸‹ï¼ˆPUæ¨¡å¼ä¸‹æ•°æ®å¯è¯»å–ä½†æ— æ³•å†™å…¥ï¼‰\n\né€šè®¯è°ƒè¯•é˜¶æ®µå»ºè®®å¢åŠ å¥‡/å¶æ ¡éªŒï¼ˆæµ‹è¯•ä¸­é‡åˆ°USB-422è½¬æ¢æ¨¡å—åœ¨æ— æ ¡éªŒæƒ…å†µä¸‹é€šè®¯å¤±è´¥çš„æƒ…å†µï¼‰\n\né‡å¯å˜é¢‘å™¨\n\nPUã€EXT é—ªçƒï¼šç½‘ç»œè¿è¡Œæ¨¡å¼æ—¶é—ªçƒ\n\n## 4.ä¸Šä½æœºè½¯ä»¶ï¼ˆModbus Pollï¼‰è®¾ç½®\n\né€šè®¯æ¥å£ï¼ˆF3ï¼‰\n\n![image-20220330003925711](image-20220330003925711.png)\n\nå¯„å­˜å™¨è¯»å–ï¼ˆF8ï¼‰\n\n40009\n\n![image-20220402212121666](image-20220402212121666.png)\n\nå¤šæ®µå¯„å­˜å™¨è¯»å– File New\n\n20201\n\n![image-20220402212313037](image-20220402212313037.png)\n\nå¯„å­˜å™¨å†™å…¥\n\n![image-20220402212557637](image-20220402212557637.png)\n\næ­£è½¬ï¼š0x0002\n\nåè½¬ï¼š0x0004\n\nè½¯ä»¶æ”¯æŒæŒ‰ä½æ”¹å˜\n\n![image-20220402212806410](image-20220402212806410.png)\n\næŸ¥çœ‹é€šè®¯logæ•°æ®\n\n![image-20220402213119377](image-20220402213119377.png)\n","tags":["å˜é¢‘å™¨"]},{"title":"Stm32F407vet6_qboot_Ymodem","url":"/2022/03/05/Stm32F407vet6-qboot-Ymodem/","content":"\nstm32f407vet6 qboot Ymodem PuTTY\n\n## 1.qboot project\n\n---\n\n1. enable onchip and w25qxx flash\n\n2. add qboot package\n\n![image-20220305212321866](image-20220305212321866.png)\n\n3. build download\n\n![image-20220305212353411](image-20220305212353411.png)\n\n\n\n## 2.app project\n\n---\n\n1. enable onchip and w25qxx flash\n\n2. add ota_downloader\n\n   ![image-20220305213051752](image-20220305213051752.png)\n\n3. edit link.lds\n\n   0x20000 = 128k          384 = 512-128\n\n   ![image-20220305213650986](image-20220305213650986.png)\n\n3. build and download\n\n   qboot jump app\n\n   ![image-20220305214540437](image-20220305214540437.png)\n\n4. change main.c\n\n```c\n#include <rtthread.h>\n#include <board.h>\n\n#define DBG_TAG \"main\"\n#define DBG_LVL DBG_LOG\n#include <rtdbg.h>\n\nint main(void)\n{\n    int count = 1;\n\n    while (count++)\n    {\n        //LOG_D(\"Hello RT-Thread!\");\n        rt_thread_mdelay(1000);\n    }\n\n    return RT_EOK;\n}\n\n#define RT_APP_PART_ADDR    0x08020000\n#define NVIC_VTOR_MASK      0xFFFFFF80\nstatic int app_vtor__reconfig(void)\n{\n    SCB->VTOR = RT_APP_PART_ADDR & NVIC_VTOR_MASK;\n\n    return 0;\n}\nINIT_BOARD_EXPORT(app_vtor__reconfig);\n\n```\n\n6. build download\n\n   qboot jump app success\n\n   ![image-20220305215300979](image-20220305215300979.png)\n\n7. **\\packages\\ota_downloader-latest\\tools\\ota_packager\\rt_ota_packaging_tool.exe**\n\n   ![image-20220305215722299](image-20220305215722299.png)\n\n8. ExtraPuTTY (PuTTY Session Manager)\n\n   ![image-20220305220535007](image-20220305220535007.png)\n\n9. Ymodem Send\n\n   ![image-20220305220451993](image-20220305220451993.png)\n\n10. System restart\n\n    Qboot erase partition app\n\n    Release firmware from download to app\n\n    Jump to applicaton \n\n    ![image-20220305220906216](image-20220305220906216.png)\n","tags":["STM32"]},{"title":"Stm32F407vet6-onchip-w25qxx-flash","url":"/2022/03/05/Stm32F407vet6-onchip-w25qxx-flash/","content":"\nä½¿ç”¨w25qxx flash\n\n## 1.CubeMx\n\n1. new project\n\nchange **drivers/board.h**\n\n```c\n/*#define BSP_USING_ON_CHIP_FLASH*/\n#define BSP_USING_ON_CHIP_FLASH\n```\n\n2. RT-Thread Setting\n\nadd packages\n\n![image-20220304203615948](image-20220304203615948.png)\n\n3. onchip flash *Tisp*\n\n![stm32f4_onchip_flash_map](stm32f4_onchip_flash_map.png)\n\n4. generated by rt-rhread **drivers/drv_flash_f4.c**\n\n![image-20220304205249004](image-20220304205249004.png)\n\n5. new source file **applications/fal_cfg.h**\n\n```c\n#ifndef _FAL_CFG_H_\n#define _FAL_CFG_H_\n\n#include <rtconfig.h>\n#include <board.h>\n\n//#define NOR_FLASH_DEV_NAME             FAL_USING_NOR_FLASH_DEV_NAME\n\n//STM32F4VET6 512K FLASH\n#define FLASH_SIZE_GRANULARITY_16K      (4*16*1024)\n#define FLASH_SIZE_GRANULARITY_64K      (1*64*1024)\n#define FLASH_SIZE_GRANULARITY_128K     (3*128*1024)\n/*STM32F4xxx  1024K FLASH\n#define FLASH_SIZE_GRANULARITY_16K      (4*16*1024)\n#define FLASH_SIZE_GRANULARITY_64K      (1*64*1024)\n#define FLASH_SIZE_GRANULARITY_128K     (7*128*1024)\n */\n\n#define STM32_FLASH_START_ADRESS_16K    (STM32_FLASH_START_ADRESS)\n#define STM32_FLASH_START_ADRESS_64K    (STM32_FLASH_START_ADRESS_16K+FLASH_SIZE_GRANULARITY_16K)\n#define STM32_FLASH_START_ADRESS_128K   (STM32_FLASH_START_ADRESS_64K+FLASH_SIZE_GRANULARITY_64K)\n\n/* ===================== Flash device Configuration ========================= */\nextern const struct fal_flash_dev stm32_onchip_flash_16k;\nextern const struct fal_flash_dev stm32_onchip_flash_64k;\nextern const struct fal_flash_dev stm32_onchip_flash_128k;\nextern struct fal_flash_dev nor_flash0;\n\n/* flash device table */\n#define FAL_FLASH_DEV_TABLE                                          \\\n{                                                                    \\\n    &stm32_onchip_flash_16k,                                         \\\n    &stm32_onchip_flash_64k,                                         \\\n    &stm32_onchip_flash_128k,                                        \\\n    /*&nor_flash0,       */                                          \\\n}\n/* ====================== Partition Configuration ========================== */\n#ifdef FAL_PART_HAS_TABLE_CFG\n//boot = (onchip_flash_16k + onchip_flash_64k) = 128k\n//dev name ===>> stm32_onchip_flash_16k\n/* partition table */\n#define FAL_PART_TABLE                                                               \\\n{                                                                                    \\\n    {FAL_PART_MAGIC_WORD,        \"bl\", \"onchip_flash_16k\",  0,  FLASH_SIZE_GRANULARITY_16K,  0}, \\\n    {FAL_PART_MAGIC_WORD,      \"bl64\", \"onchip_flash_64k\",  0,  FLASH_SIZE_GRANULARITY_64K,  0}, \\\n    {FAL_PART_MAGIC_WORD,       \"app\", \"onchip_flash_128k\", 0,  FLASH_SIZE_GRANULARITY_128K, 0}, \\\n/*    {FAL_PART_MAGIC_WORD, \"easyflash\", NOR_FLASH_DEV_NAME,          0,    512*1024, 0},*/ \\\n/*    {FAL_PART_MAGIC_WORD, \"download\", NOR_FLASH_DEV_NAME,    512*1024,    512*1024, 0},*/ \\\n/*    {FAL_PART_MAGIC_WORD,     \"file\", NOR_FLASH_DEV_NAME, 1*1024*1024, 7*1024*1024, 0},*/ \\\n}\n#endif /* FAL_PART_HAS_TABLE_CFG */\n\n#endif /* _FAL_CFG_H_ */\n```\n\n\n\n6. new  source file **applications/usr_flash.c**\n\n```c\n#include <rtthread.h>\n#include \"fal.h\"\n\nstatic int usr_flash_init(void)\n{\n    fal_init();\n    return RT_EOK;\n}\n\nINIT_ENV_EXPORT(usr_flash_init);\n```\n\n7. Build + Download\n\nPuTTY\n\n![image-20220304213533067](image-20220304213533067.png)\n\n8. debug\n\n![image-20220304214034449](image-20220304214034449.png)\n\n\n\n## 2.W25Q64\n\n---\n\n1. change **drivers/board.h**\n\n```c\n/*#define BSP_USING_SPI1*/\n#define BSP_USING_SPI2\n/*#define BSP_USING_SPI3*/\n```\n\n2. RT-Thread Setting\n\n![image-20220304214418575](image-20220304214418575.png)\n\n![image-20220304223001519](image-20220304223001519.png)\n\n3. CubeMX Setting\n\nenable spi bus\n\n4. change **applications/usr_flash.c**\n\n```c\n#include <rtthread.h>\n#include \"drv_spi.h\"\n#include \"spi_flash_sfud.h\"\n#include \"fal.h\"\n\nstatic int usr_flash_init(void)\n{\n    rt_hw_spi_device_attach(\"spi2\", \"spi20\", GPIOE, GPIO_PIN_3);\n    if (RT_NULL == rt_sfud_flash_probe(\"norflash0\", \"spi20\")) {\n        return RT_ERROR;\n    }\n\n    fal_init();\n\n    return RT_EOK;\n}\n\nINIT_ENV_EXPORT(usr_flash_init);\n```\n\n5. copy file from **packages/fal-v0.5.0/samples/porting/fal_flash_sfud_port.c** to **applications/fal_flash_sfud_port.c**\n\n6. change fal_cfg.h\n\n```c\n#ifndef _FAL_CFG_H_\n#define _FAL_CFG_H_\n\n#include <rtconfig.h>\n#include <board.h>\n\n#define NOR_FLASH_DEV_NAME             FAL_USING_NOR_FLASH_DEV_NAME\n\n//STM32F4VET6 512K FLASH\n#define FLASH_SIZE_GRANULARITY_16K      (4*16*1024)\n#define FLASH_SIZE_GRANULARITY_64K      (1*64*1024)\n#define FLASH_SIZE_GRANULARITY_128K     (3*128*1024)\n/*STM32F4xxx  1024K FLASH\n#define FLASH_SIZE_GRANULARITY_16K      (4*16*1024)\n#define FLASH_SIZE_GRANULARITY_64K      (1*64*1024)\n#define FLASH_SIZE_GRANULARITY_128K     (7*128*1024)\n */\n\n#define STM32_FLASH_START_ADRESS_16K    (STM32_FLASH_START_ADRESS)\n#define STM32_FLASH_START_ADRESS_64K    (STM32_FLASH_START_ADRESS_16K+FLASH_SIZE_GRANULARITY_16K)\n#define STM32_FLASH_START_ADRESS_128K   (STM32_FLASH_START_ADRESS_64K+FLASH_SIZE_GRANULARITY_64K)\n\n/* ===================== Flash device Configuration ========================= */\nextern const struct fal_flash_dev stm32_onchip_flash_16k;\nextern const struct fal_flash_dev stm32_onchip_flash_64k;\nextern const struct fal_flash_dev stm32_onchip_flash_128k;\nextern struct fal_flash_dev nor_flash0;\n\n/* flash device table */\n#define FAL_FLASH_DEV_TABLE                                          \\\n{                                                                    \\\n    &stm32_onchip_flash_16k,                                         \\\n    &stm32_onchip_flash_64k,                                         \\\n    &stm32_onchip_flash_128k,                                        \\\n    &nor_flash0,                                                     \\\n}\n/* ====================== Partition Configuration ========================== */\n#ifdef FAL_PART_HAS_TABLE_CFG\n//boot = (onchip_flash_16k + onchip_flash_64k) = 128k\n//dev name ==>> stm32_onchip_flash_16k\n/* partition table */\n#define FAL_PART_TABLE                                                               \\\n{                                                                                    \\\n    {FAL_PART_MAGIC_WORD,        \"bl\", \"onchip_flash_16k\",  0,  FLASH_SIZE_GRANULARITY_16K,  0}, \\\n    {FAL_PART_MAGIC_WORD,      \"bl64\", \"onchip_flash_64k\",  0,  FLASH_SIZE_GRANULARITY_64K,  0}, \\\n    {FAL_PART_MAGIC_WORD,       \"app\", \"onchip_flash_128k\", 0,  FLASH_SIZE_GRANULARITY_128K, 0}, \\\n    {FAL_PART_MAGIC_WORD, \"easyflash\", NOR_FLASH_DEV_NAME,          0,     512*1024, 0}, \\\n    {FAL_PART_MAGIC_WORD,  \"download\", NOR_FLASH_DEV_NAME,    512*1024,    512*1024, 0}, \\\n    {FAL_PART_MAGIC_WORD,      \"file\", NOR_FLASH_DEV_NAME, 1*1024*1024, 7*1024*1024, 0}, \\\n}\n#endif /* FAL_PART_HAS_TABLE_CFG */\n\n#endif /* _FAL_CFG_H_ */\n```\n\n7. Build + Download\n\n8. debug\n\n## 3.fal test\n\n![image-20220304225042638](image-20220304225042638.png)","tags":["STM32"]},{"title":"Stm32F407_PWM_External_Sync","url":"/2022/01/18/Stm32F407-PWM-External-Sync/","content":"\n## 1.PWMä¸å¤–éƒ¨è§¦å‘ä¿¡å·åŒæ­¥\n\n---\n\n1. new progect\n\n2. CubeMX Setting\n\n   * RCC->Cystal\n\n   * SYS->Serial Wire\n\n   * Clock Configuration->168\n\n   * TIM1\n\n     ![image-20220118205730219](image-20220118205730219.png)\n\n     ![image-20220118205737972](image-20220118205737972.png)\n\n     ![image-20220118205747601](image-20220118205747601.png)\n\n     ![image-20220118205752456](image-20220118205752456.png)\n\n     ![image-20220118205757553](image-20220118205757553.png)\n\n   * Save\n\n## 2.Code\n\n---\n\n```c\nint main(void)\n{\n  /* USER CODE BEGIN 1 */\n\n  /* USER CODE END 1 */\n\n  /* MCU Configuration--------------------------------------------------------*/\n\n  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */\n  HAL_Init();\n\n  /* USER CODE BEGIN Init */\n\n  /* USER CODE END Init */\n\n  /* Configure the system clock */\n  SystemClock_Config();\n\n  /* USER CODE BEGIN SysInit */\n\n  /* USER CODE END SysInit */\n\n  /* Initialize all configured peripherals */\n  MX_GPIO_Init();\n  MX_TIM1_Init();\n  /* USER CODE BEGIN 2 */\n  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1);\n  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_2);\n  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3);\n  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_4);\n  /* USER CODE END 2 */\n\n  /* Infinite loop */\n  /* USER CODE BEGIN WHILE */\n  while (1)\n  {\n    /* USER CODE END WHILE */\n\n    /* USER CODE BEGIN 3 */\n  }\n  /* USER CODE END 3 */\n}\n```\n\n\n## 3.Test\n\n---\n\n![image-20220118212029035](image-20220118212029035.png)\n\n![image-20220118212038552](image-20220118212038552.png)\n\n","tags":["STM32"]},{"title":"Stm32F407_PWM_Master_Slave","url":"/2022/01/18/Stm32F407-PWM-Master-Slave/","content":"\n## 1.æ¦‚è¿°\n\nä½¿ç”¨STM32ä¸»å®šæ—¶å™¨+ä»å®šæ—¶å™¨å®ç°äº§ç”Ÿå¯æ§æ•°é‡çš„PWMè„‰å†²\n\n## 2.åˆ›å»ºå·¥ç¨‹\n\n1. new progect \n\n2. CubeMX Setting\n\n  * RCC->Crystal\n\n  * SYS->Serial Wire\n\n  * Clock Configuration->168\n\n  * TIM4\n\n    ![image-20220118201958020](image-20220118201958020.png)\n\n    ![image-20220118202025867](image-20220118202025867.png)\n\n    ![image-20220118202048425](image-20220118202048425.png)\n\n  * TIM2\n\n    ![image-20220118202135289](image-20220118202135289.png)\n\n    ![image-20220118202142804](image-20220118202142804.png)\n\n    ![image-20220118202148330](image-20220118202148330.png)\n\n    ![image-20220118203457549](image-20220118203457549.png)\n\n  * Save\n\n## 3.Code\n\n---\n\n1. main.c\n\n   ```c\n   /* USER CODE BEGIN 0 */\n   void generate_pulse(uint32_t value)\n   {\n   \tif(!value)\n   \t\treturn;\n   \t__HAL_TIM_SET_AUTORELOAD(&htim2,value-1); //è®¾ç½®è¦è¾“å‡ºçš„PWMè„‰å†²\n   \tHAL_TIM_Base_Start_IT(&htim2);             //å¯åŠ¨ä»å®šæ—¶å™¨\n   \t__HAL_TIM_SET_COUNTER(&htim4, 0);\n   \tHAL_TIM_PWM_Start(&htim4, TIM_CHANNEL_2);  //å¯åŠ¨ä¸»å®šæ—¶å™¨PWMè¾“å‡º\n   }\n   \n   void  HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)\n   {\n       if(htim == &htim2)\n       {\n           if(__HAL_TIM_GET_FLAG(&htim2, TIM_FLAG_CC2) != RESET)  //åˆ¤æ–­æ˜¯å¦è§¦å‘ä¸­æ–­\n           {\n               __HAL_TIM_CLEAR_FLAG(&htim2, TIM_FLAG_CC2);      //æ¸…é™¤ä¸­æ–­æ ‡å¿—\n               HAL_TIM_PWM_Stop(&htim4, TIM_CHANNEL_2);   //å…³é—­ä¸»å®šæ—¶å™¨\n               HAL_TIM_Base_Stop_IT(&htim2);         //å…³é—­ä»å®šæ—¶å™¨\n           }\n       }\n   }\n   /* USER CODE END 0 */\n   \n   int main(void)\n   {\n     /* USER CODE BEGIN 1 */\n   \n     /* USER CODE END 1 */\n   \n     /* MCU Configuration--------------------------------------------------------*/\n   \n     /* Reset of all peripherals, Initializes the Flash interface and the Systick. */\n     HAL_Init();\n   \n     /* USER CODE BEGIN Init */\n   \n     /* USER CODE END Init */\n   \n     /* Configure the system clock */\n     SystemClock_Config();\n   \n     /* USER CODE BEGIN SysInit */\n   \n     /* USER CODE END SysInit */\n   \n     /* Initialize all configured peripherals */\n     MX_GPIO_Init();\n     MX_TIM2_Init();\n     MX_TIM4_Init();\n     /* USER CODE BEGIN 2 */\n   \n     /* USER CODE END 2 */\n   \n     /* Infinite loop */\n     /* USER CODE BEGIN WHILE */\n     while (1)\n     {\n       /* USER CODE END WHILE */\n   \n       /* USER CODE BEGIN 3 */\n   \tgenerate_pulse(10);\n   \tHAL_Delay(1000);\n     }\n     /* USER CODE END 3 */\n   }\n   ```\n\n   ## 4.Test\n\n   ![image-20220118202840364](image-20220118202840364.png)","tags":["STM32"]},{"title":"Stm32F407-ADC-DMA","url":"/2021/11/12/Stm32F407-ADC-DMA/","content":"\nstm32 ADC DMA rt-thread studio\n\n## 1.Rt-Thrad Studio\n\n---\n\n![image-20211112222940162](image-20211112222940162.png)\n\n## 2.CubeMX Settings\n\n---\n\n1. System Core >> RCC >> HSE >> Crystal(å¤–éƒ¨æ™¶æŒ¯)\n2. System Core >> SYS >> Debug(é€‰æ‹©è°ƒè¯•æ¥å£)\n3. Connectivity >> USART3 >> Asynchronous(ç”¨äºfinshå‘½ä»¤è¡Œ)\n4. Analog >> ADC1 >>\n\nParameter Settings\n\n![image-20211112224235969](image-20211112224235969.png)\n\n![image-20211112224811725](image-20211112224811725.png)\n\n5. Analog >> ADC1 >> DMA Settings\n\n![image-20211112233043884](image-20211112233043884.png)\n\n6. Clock Configuration(é…ç½®æ—¶é’Ÿ)  HCLK >> 168 >> Enter\n\n![image-20211111212633234](image-20211111212633234.png)\n\n7. GENERATE COED (default seting)\n\n![image-20211112225130880](image-20211112225130880.png)\n\n## Code\n\n---\n\n1. applications/main.c\n\n```c\n#include <rtthread.h>\n\n#define DBG_TAG \"main\"\n#define DBG_LVL DBG_LOG\n#include <rtdbg.h>\n\nextern void usr_board_init(void);\nextern uint16_t read_adc_value(uint8_t channel);\n\nint main(void)\n{\n    int count = 1;\n\n    usr_board_init();\n\n    while (count++)\n    {\n        LOG_D(\"Hello RT-Thread!\");\n        rt_kprintf(\"PA3_adc = %d   \", read_adc_value(0));\n        rt_kprintf(\"PA4_adc = %d   \", read_adc_value(1));\n        rt_kprintf(\"PA5_adc = %d   \", read_adc_value(2));\n        rt_kprintf(\"PA6_adc = %d   \", read_adc_value(3));\n        rt_kprintf(\"\\n\");\n        rt_thread_mdelay(1000);\n    }\n\n    return RT_EOK;\n}\n```\n\n2. cubemx/Src/main.c\n\n```c\n/* USER CODE BEGIN 0 */\n\n#define ADC_CHANNEL_SUM         4\n#define ADC_BUFF_LOOP           30\nuint16_t adc_dma_value[ADC_CHANNEL_SUM * ADC_BUFF_LOOP];\n\nvoid usr_board_init(void)\n{\n    MX_DMA_Init();\n    MX_ADC1_Init();\n    HAL_ADC_Start_DMA(&hadc1, (uint32_t*)&adc_dma_value, ADC_CHANNEL_SUM * ADC_BUFF_LOOP);\n}\n\nuint16_t read_adc_value(uint8_t channel)\n{\n    if (channel < ADC_CHANNEL_SUM) {\n        return adc_dma_value[channel];\n    }\n    return 0;\n}\n/* USER CODE END 0 */\n\n/**\n  * Enable DMA controller clock\n  */\nstatic void MX_DMA_Init(void)\n{\n\n  /* DMA controller clock enable */\n  __HAL_RCC_DMA2_CLK_ENABLE();\n\n  /* DMA interrupt init */\n  /* DMA2_Stream0_IRQn interrupt configuration */\n  //HAL_NVIC_SetPriority(DMA2_Stream0_IRQn, 0, 0);\n  //HAL_NVIC_EnableIRQ(DMA2_Stream0_IRQn);\n\n}\n```\n\n## 3.Build && Test\n\nPA3_adc\n\n![image-20211112233634255](image-20211112233634255.png)\n\n---\n","tags":["STM32"]},{"title":"Stm32F407_W25Q64_easyFlash","url":"/2021/11/11/Stm32F407-W25Q64-easyFlash/","content":"\nstm32 flash w25q64 easyFlash rt-thread studio\n\n## 1.RT-Thread Studio\n\n1. new project\n\n![image-20211111213804740](image-20211111213804740.png)\n\n## 2.CubeMX Settings\n\n1. System Core >> RCC >> HSE >> Crystal(å¤–éƒ¨æ™¶æŒ¯)  \n2. System Core >> SYS >> Debug(é€‰æ‹©è°ƒè¯•æ¥å£)   \n3. Connectivity >> USART3 >> Asynchronous(ç”¨äºfinshå‘½ä»¤è¡Œ)  \n4. Connectivity >> SPI2 >> Full-Dupex Master(Flash W25Q64)\n\n![image-20211111212434054](image-20211111212434054.png)\n\n5. Clock Configuration(é…ç½®æ—¶é’Ÿ)\n\n   HCLK >> 168  >> Enter\n\n![image-20211111212633234](image-20211111212633234.png)\n\n6. GENERATE COED (default seting)\n\n![image-20211111212753066](image-20211111212753066.png)\n\n![image-20210630224307585](image-20210630224307585.png)\n\n## 3.RT-Thread Setting\n\n1. Packages >> add >> EasyFlash\n\n![image-20211111234323900](image-20211111234323900.png)\n\n2. Drivers >> SPI\n\n3. Drivers >> SPI >> SFUD\n\n   ![image-20211111234429187](image-20211111234429187.png)\n\n## 4.Code\n\n1. *drivers/board.h*\n\n```c\n#define BSP_USING_UART3\n#define BSP_UART3_TX_PIN       \"PD8\"\n#define BSP_UART3_RX_PIN       \"PD9\"\n\n#define BSP_USING_SPI2\n```\n\n2. *new source file*\n\n   applications/usr_flash.c   (change cs pin and bus name)\n\n```c\n#include <rtthread.h>\n#include <drv_spi.h>\n#include \"spi_flash.h\"\n#include \"spi_flash_sfud.h\"\n\nrt_spi_flash_device_t w25q64;\n\nstatic int rt_hw_spi_flash_with_sfud_init(void)\n{\n    rt_hw_spi_device_attach(\"spi2\", \"spi20\", GPIOE, GPIO_PIN_3);\n\n    /* init w25q64 */\n    if (w25q64 == rt_sfud_flash_probe(\"w25q64\", \"spi20\"))\n    {\n        return -RT_ERROR;\n    }\n\n    return RT_EOK;\n}\nINIT_COMPONENT_EXPORT(rt_hw_spi_flash_with_sfud_init);\n```\n\n3. copy file \n\n   packages\\EasyFlash-v4.1.0\\ports\\ef_sfud_port.c  >>  applications/usr_flash.c\n\n## 5.Build && Test\n\n   ![image-20211112221002533](image-20211112221002533.png)\n\n","tags":["STM32"]},{"title":"Stm32F407_USB_OTG_HS","url":"/2021/07/01/Stm32F407-USB-OTG-HS/","content":"\nusb-otg-hs u-disk rt-thread studio\n\n[github progect](https://github.com/abcyixyz/Stm32F407_USB_OTG_HS)\n\n## 1.RT-Thread Studio\n\nNew >> RT-Thread Protect  \n\n![image-20210630223400016](image-20210630223400016.png)\n\n\n\n## 2.CubeMX Settings\n\n---\n\n1. System Core >> RCC >> HSE >> Crystal(å¤–éƒ¨æ™¶æŒ¯)  \n2. System Core >> SYS >> Debug(é€‰æ‹©è°ƒè¯•æ¥å£)   \n3. Connectivity >> USART1 >> Asynchronous(ç”¨äºfinshå‘½ä»¤è¡Œ)  \n4. Connectivity >> USB_OTG_HS >> Host_Only(å¼€å‘æ¿æ— ä¾›ç”µæ§åˆ¶æ•…æœªå‹¾é€‰VBUS)  \n\n![image-20210630223923547](image-20210630223923547.png)\n\n1. Enable HS global interrupt\n\n![image-20210630223948843](image-20210630223948843.png)\n\n6. Clock Configuration(é…ç½®æ—¶é’Ÿ)\n\n   HCLK >> 168  >> Enter\n\n![image-20210630224636418](image-20210630224636418.png)\n\n7. GENERATE COED (default seting)\n\n![image-20210630224256382](image-20210630224256382.png)\n\n![image-20210630224307585](image-20210630224307585.png)\n\n\n\n## 3.Code\n\n---\n\n1. *applications/main.c*\n\n```c\n#define DBG_TAG \"main\"\n//#define DBG_LVL DBG_INFO\n#define DBG_LVL DBG_INFO\n#include <rtdbg.h>\n```\n\n2. *drivers/board.h*\n\n```c\n#define BSP_USING_UART1\n#define BSP_UART1_TX_PIN       \"PA9\"\n#define BSP_UART1_RX_PIN       \"PA10\"\n\n#define BSP_USING_USBHOST\n#define BSP_USBD_TYPE_HS\n```\n\n3. *drivers/drv_clk.c* (copy from *cubemx/Src/main.c*)\n\n```c\nvoid SystemClock_Config(void)\n{\n  RCC_OscInitTypeDef RCC_OscInitStruct = {0};\n  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};\n\n  /** Configure the main internal regulator output voltage\n  */\n  __HAL_RCC_PWR_CLK_ENABLE();\n  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);\n  /** Initializes the RCC Oscillators according to the specified parameters\n  * in the RCC_OscInitTypeDef structure.\n  */\n  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;\n  RCC_OscInitStruct.HSEState = RCC_HSE_ON;\n  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;\n  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;\n  RCC_OscInitStruct.PLL.PLLM = 25;\n  RCC_OscInitStruct.PLL.PLLN = 336;\n  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;\n  RCC_OscInitStruct.PLL.PLLQ = 7;\n  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  /** Initializes the CPU, AHB and APB buses clocks\n  */\n  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK\n                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;\n  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;\n  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;\n  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;\n  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;\n\n  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_5) != HAL_OK)\n  {\n    Error_Handler();\n  }\n}\n\n//void system_clock_config(int target_freq_mhz)\n//{\n//...\n//}\n```\n\n4. new source file  \n\n![image-20210630224927209](image-20210630224927209.png)\n\n5. `applications/filesystem.c`\n\n```C\n#include <rtthread.h>\n#include <dfs_fs.h>\n#include \"dfs_romfs.h\"\n\n#define DBG_TAG \"app.filesystem\"\n#define DBG_LVL DBG_INFO\n#include <rtdbg.h>\n\nstatic const struct romfs_dirent _romfs_root[] = {\n    {ROMFS_DIRENT_DIR, \"udisk\", RT_NULL, 0}\n};\n\nconst struct romfs_dirent romfs_root = {\n    ROMFS_DIRENT_DIR, \"/\", (rt_uint8_t *)_romfs_root, sizeof(_romfs_root) / sizeof(_romfs_root[0])\n};\n\nint mount_init(void)\n{\n    if (dfs_mount(RT_NULL, \"/\", \"rom\", 0, &(romfs_root)) != 0)\n    {\n        LOG_E(\"rom mount to '/' failed!\");\n        return RT_ERROR;\n    }\n    return RT_EOK;\n}\nINIT_APP_EXPORT(mount_init); \n```\n\n6. drivers/drv_common.c\n\n[STM32F407é‡åˆ°USBè¯»å–Uç›˜æ— æ³•è¯»å–é—®é¢˜](https://club.rt-thread.org/ask/question/427531.html)\n\n```C\nvoid HAL_Delay(__IO uint32_t Delay)\n{\n    rt_thread_mdelay(Delay);\n}\n```\n\n7. drivers/drv_usbh.c\n\n```c\n#define DBG_TAG \"drv_usbh\"\n#define DBG_LVL DBG_LOG\n#include <rtdbg.h>\n\n/* add OTG_HS_IRQ */\nvoid OTG_HS_IRQHandler(void)\n{\n    rt_interrupt_enter();\n    HAL_HCD_IRQHandler(&stm32_hhcd_fs);\n    rt_interrupt_leave();\n}\n\n/* cubemx/Src/main.c >> static void MX_USB_OTG_HS_HCD_Init(void) */\n#ifdef BSP_USBD_TYPE_HS\nstatic rt_err_t stm32_hcd_init(rt_device_t device)\n{\n    HCD_HandleTypeDef *hhcd = (HCD_HandleTypeDef *)device->user_data;\n    hhcd->Instance = USB_OTG_HS;\n    hhcd->Init.Host_channels = 12;\n    hhcd->Init.speed = HCD_SPEED_FULL;\n    hhcd->Init.dma_enable = DISABLE;\n    hhcd->Init.phy_itface = USB_OTG_EMBEDDED_PHY;\n    hhcd->Init.Sof_enable = DISABLE;\n    hhcd->Init.low_power_enable = DISABLE;\n    hhcd->Init.vbus_sensing_enable = DISABLE;\n    hhcd->Init.use_external_vbus = DISABLE;\n    RT_ASSERT(HAL_HCD_Init(hhcd) == HAL_OK);\n    HAL_HCD_Start(hhcd);\n#ifdef USBH_USING_CONTROLLABLE_POWER\n    rt_pin_mode(USBH_POWER_PIN, PIN_MODE_OUTPUT);\n    rt_pin_write(USBH_POWER_PIN, PIN_LOW);\n#endif\n    return RT_EOK;\n}\n\n#else\n\nstatic rt_err_t stm32_hcd_init(rt_device_t device)\n{\n    HCD_HandleTypeDef *hhcd = (HCD_HandleTypeDef *)device->user_data;\n    hhcd->Instance = USB_OTG_FS;\n    hhcd->Init.Host_channels = 8;\n    hhcd->Init.speed = HCD_SPEED_FULL;\n    hhcd->Init.dma_enable = DISABLE;\n    hhcd->Init.phy_itface = HCD_PHY_EMBEDDED;\n    hhcd->Init.Sof_enable = DISABLE;\n    RT_ASSERT(HAL_HCD_Init(hhcd) == HAL_OK);\n    HAL_HCD_Start(hhcd);\n#ifdef USBH_USING_CONTROLLABLE_POWER\n    rt_pin_mode(USBH_POWER_PIN, PIN_MODE_OUTPUT);\n    rt_pin_write(USBH_POWER_PIN, PIN_LOW);\n#endif\n    return RT_EOK;\n}\n#endif\n```\n\n\n\n## RT-Thread Settings\n---\n\n1. Exclude from Build\n\n~~cubemx/Src/main.c~~  \n~~cubemx/Src/stm32f4xx_it.c~~  \n\n![image-20210630224537429](image-20210630224537429.png)\n\n![image-20210630225754496](image-20210630225754496.png)\n\n2. Components >> Device Drivers >> Using USB >> Using USB host >> Enable Udisk Drivers >> Udisk mount dir >> /udisk\n\n![image-20210630225432224](image-20210630225432224.png)\n\n3. Components >> Device virtual file system >> Using device virtual file system >> Enable elm-chan fatfs  /  Enable ReadOnlay file system on flash\n\n![image-20210630225517213](image-20210630225517213.png)\n\n## 4.Test\n\n---\n1. Build and Flash download\n2. Terminal\n\n<kbd>Ctrl</kbd>+<kbd>Atl</kbd>+<kbd>Shift</kbd> +<kbd>T</kbd>\n\n![image-20210630225624874](image-20210630225624874.png)\n\n3. Insert the u-disk(æ’å…¥Uç›˜)\n\n![image-20210630225644852](image-20210630225644852.png)\n\n","tags":["STM32"]},{"title":"Archlinuxä¸‹rCore å®éªŒç¯å¢ƒé…ç½®","url":"/2021/03/21/Archlinuxä¸‹rCore-å®éªŒç¯å¢ƒé…ç½®/","content":"\n## 1.Archlinuxä¸‹rCore å®éªŒç¯å¢ƒé…ç½®\n\nåŸæ–‡ï¼š[rCore-Tutorial-Book ç¬¬ä¸‰ç‰ˆ å®éªŒç¯å¢ƒé…ç½®](https://rcore-os.github.io/rCore-Tutorial-Book-v3/chapter0/5setup-devel-env.html#rust)\n\n+ ç³»ç»Ÿç¯å¢ƒé…ç½®ï¼ˆä½¿ç”¨Archlinuxï¼‰\n+ Rustå¼€å‘ç¯å¢ƒé…ç½®\n+ Qemuæ¨¡æ‹Ÿå™¨å®‰è£…\n+ GDB è°ƒè¯•æ”¯æŒ\n\n## 2.Rust å¼€å‘ç¯å¢ƒé…ç½®\n\né¦–å…ˆå®‰è£…RuståŒ…ç®¡ç†å™¨cargoå’ŒRustç‰ˆæœ¬ç®¡ç†å™¨rustup\n\n```bash\nsudo pacman -S cargo\nsudo pacman -S rustup\n```\n\nä¿®æ”¹Rust Cratesæº [ustc](https://mirrors.ustc.edu.cn/help/crates.io-index.html)ï¼Œåœ¨ `$HOME/.cargo/config` ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\n\n```bash\n[source.crates-io]\nreplace-with = 'ustc'\n\n[source.ustc]\nregistry = \"git://mirrors.ustc.edu.cn/crates.io-index\"\n```\n\nå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£…rustcçš„nightlyç‰ˆæœ¬ï¼ˆrCoreè¦æ±‚ç”¨rustcçš„nightlyç‰ˆæœ¬ï¼‰ï¼Œå¹¶æŠŠè¯¥ç‰ˆæœ¬è®¾ç½®ä¸ºrustcçš„ç¼ºçœç‰ˆæœ¬\n\n```bash\nrustup install nightly\nrustup default nightly\n```\n\næ¥ä¸‹æ¥å®‰è£…ä¸€äº›Rustç›¸å…³çš„è½¯ä»¶åŒ…\n\n```bash\nrustup target add riscv64gc-unknown-none-elf\ncargo install cargo-binutils\nrustup component add llvm-tools-preview\nrustup component add rust-src\n```\n\n## 3.Qemu æ¨¡æ‹Ÿå™¨å®‰è£…\n\n```bash\nsudo pacman -S qemu-emulators-full\n```\n\néšåå³å¯åœ¨å½“å‰ç»ˆç«¯ `source ~/.bashrc` æ›´æ–°ç³»ç»Ÿè·¯å¾„ï¼Œæˆ–è€…ç›´æ¥é‡å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç¡®è®¤ Qemu çš„ç‰ˆæœ¬\n\n```bash\nqemu-system-riscv64 --version\nqemu-riscv64 --version\n```\n\n## 4.GDB è°ƒè¯•æ”¯æŒ\n\nåœ¨ `os` ç›®å½•ä¸‹ `make debug` å¯ä»¥è°ƒè¯•æˆ‘ä»¬çš„å†…æ ¸ï¼Œè¿™éœ€è¦å®‰è£…ç»ˆç«¯å¤ç”¨å·¥å…· `tmux` ï¼Œè¿˜éœ€è¦åŸºäº riscv64 å¹³å°çš„ gdb è°ƒè¯•å™¨ `riscv64-unknown-elf-gdb` ã€‚è¯¥è°ƒè¯•å™¨åŒ…å«åœ¨ riscv64 gcc å·¥å…·é“¾ä¸­ã€‚\n\n```bash\nyay -S riscv64-unknown-elf-gdb\n```\n\n## 5.è¿è¡Œ rCore-Tutorial-v3\n\nå¦‚æœæ˜¯åœ¨ Qemu å¹³å°ä¸Šè¿è¡Œï¼Œåªéœ€åœ¨`os`ç›®å½•ä¸‹ `make run` å³å¯ã€‚åœ¨å†…æ ¸åŠ è½½å®Œæ¯•ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰å¯ä»¥ç”¨çš„ åº”ç”¨ç¨‹åºã€‚ `usertests` æ‰“åŒ…äº†å…¶ä¸­çš„å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿è¡Œå®ƒï¼Œåªéœ€è¾“å…¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥å®ƒçš„åå­—å³å¯ã€‚è¿è¡Œåï¼Œå¯ä»¥å…ˆæŒ‰ä¸‹ `Ctrl+A` ï¼Œå†æŒ‰ä¸‹ `X` æ¥é€€å‡º Qemuã€‚","tags":["Rust"]},{"title":"Mosquitto æ­å»ºåŠé…ç½®","url":"/2021/03/21/Mosquitto-æ­å»ºåŠé…ç½®/","content":"\n## 1.æ¦‚è¿°\n\nEclipse Mosquittoæ˜¯ä¸€ä¸ªå¼€æºæ¶ˆæ¯ä»£ç†ï¼Œå®ç°äº†MQTTåè®®ç‰ˆæœ¬3.1å’Œ3.1.1ã€‚Mosquittoè½»é‡ï¼Œé€‚ç”¨äºä½åŠŸè€—å•æ¿è®¡ç®—æœºåˆ°å®Œæ•´æœåŠ¡å™¨çš„æ‰€æœ‰è®¾å¤‡ã€‚Mosquittoé¡¹ç›®è¿˜æä¾›äº†ç”¨äºå®ç°MQTTå®¢æˆ·ç«¯çš„Cåº“ä»¥åŠéå¸¸å—æ¬¢è¿çš„mosquitto_pubå’Œmosquitto_subå‘½ä»¤è¡ŒMQTTå®¢æˆ·ç«¯ã€‚\n\nå…¶ä»–æœåŠ¡å™¨ä»£ç†å®ç°:https://github.com/mqtt/mqtt.github.io/wiki/servers\n å„æ“ä½œç³»ç»Ÿå®‰è£…æŒ‡å¼•:https://mosquitto.org/download/\n\n## 2.ä¸‹è½½å®‰è£…\n\nä»¥Ubuntuä¸ºä¾‹\n\n- æ›´æ–°æº\n\n```bash\nsudo apt-get update\n```\n\n- å®‰è£…æœåŠ¡å™¨ç«¯\n\n```bash\nsudo apt-get install mosquitto\n```\n\n+ å®‰è£…å®¢æˆ·ç«¯\n\n```bash\nsudo apt-get install mosquitto-clients\n```\n\n## 3.é…ç½®\n\n### 3.1ä¸»é…ç½®æ–‡ä»¶mosquitto.conf\n\n```nginx\nid_file /var/run/mosquitto.pid\n\n# æ¶ˆæ¯æŒä¹…å­˜å‚¨\npersistence true\npersistence_location /var/lib/mosquitto/\n\n# æ—¥å¿—æ–‡ä»¶\nlog_dest file /var/log/mosquitto/mosquitto.log\n\n# å…¶ä»–é…ç½®\ninclude_dir /etc/mosquitto/conf.d\n\n# ç¦æ­¢åŒ¿åè®¿é—®\nallow_anonymous false\n# è®¤è¯é…ç½®\npassword_file /etc/mosquitto/pwfile\n# æƒé™é…ç½®\nacl_file /etc/mosquitto/aclfile\n```\n\n### 3.2è®¤è¯é…ç½®pwfile\n\n- åˆ›å»ºå¯†ç å­˜å‚¨æ–‡ä»¶\n\n```bash\nsudo touch /etc/mosquitto/pwfile\n```\n\n- æœåŠ¡å¼€å¯å,è¾“å…¥å¦‚ä¸‹å‘½ä»¤,æ ¹æ®æç¤ºè¾“å…¥ä¸¤éå¯†ç \n\n```bash\nmosquitto_passwd /etc/mosquitto/pwfile ç”¨æˆ·å\n```\n\n### 3.3æƒé™é…ç½®aclfile\n\n- æ‰“å¼€æ–‡ä»¶\n\n```bash\nvim /etc/mosquitto/aclfile\n```\n\n- ç¼–è¾‘å†…å®¹\n\n```nginx\n# æé›·åªèƒ½å‘å¸ƒä»¥testä¸ºå‰ç¼€çš„ä¸»é¢˜,è®¢é˜…ä»¥$SYSå¼€å¤´çš„ä¸»é¢˜å³ç³»ç»Ÿä¸»é¢˜\nuser lilei\ntopic write test/#\ntopic read $SYS/#\n\n# éŸ©æ¢…æ¢…åªèƒ½è®¢é˜…ä»¥testä¸ºå‰ç¼€çš„ä¸»é¢˜\nuser hanmeimei\ntopic read test/#\n```\n\n## 4.å¯åŠ¨\n\n-cï¼šæŒ‡å®šç‰¹å®šé…ç½®æ–‡ä»¶å¯åŠ¨\n-dï¼šåå°è¿è¡Œ\n\n```bash\nmosquitto -c /etc/mosquitto/mosquitto.conf -d\n```\n\n### 4.1æµ‹è¯•\n\nå‘å¸ƒä½¿ç”¨mosquitto_pubå‘½ä»¤ï¼Œè®¢é˜…ä½¿ç”¨mosquitto_subå‘½ä»¤ã€‚å¸¸ç”¨å‚æ•°ä»‹ç»ï¼š\n\n| å‚æ•° | æè¿°                      |\n| ---- | ------------------------- |\n| -h   | æœåŠ¡å™¨ä¸»æœºï¼Œé»˜è®¤localhost |\n| -t   | æŒ‡å®šä¸»é¢˜                  |\n| -u   | ç”¨æˆ·å                    |\n| -P   | å¯†ç                       |\n| -i   | å®¢æˆ·ç«¯idï¼Œå”¯ä¸€            |\n| -m   | å‘å¸ƒçš„æ¶ˆæ¯å†…å®¹            |\n\nè®¢é˜…\n\n```bash\nmosquitto_sub -h localhost -t \"test/#\" -u hanmeimei -P 123456 -i \"client1\"\n```\n\nè®¢é˜…ç³»ç»Ÿä¸»é¢˜\n\n```bash\n# è®¢é˜…å®¢æˆ·ç«¯å­˜æ´»è¿æ¥æ•°\nmosquitto_sub -h localhost â€“t '$SYS/broker/clients/active' -u lilei -P 123456 -i \"client2\"\n```\n\nå‘å¸ƒ\n\n```bash\nmosquitto_pub -h localhost -t \"test/abc\" -u lilei -P 123456 -i \"client3\" -m \"How are you?\"\n```\n\n## 5.å‚è€ƒé“¾æ¥\n\n- é¡¹ç›®ç½‘ç«™ï¼šhttps://www.eclipse.org/paho\n- Eclipseé¡¹ç›®ä¿¡æ¯ï¼šhttps://projects.eclipse.org/projects/iot.paho\n- GitHubï¼šhttps://github.com/eclipse/paho.mqtt.java\n- MQTT Javaå®¢æˆ·ç«¯çš„ä½¿ç”¨ï¼šhttps://www.jianshu.com/p/65e1748a930c\n- Springæ”¯æŒï¼šhttps://www.jianshu.com/p/6b60858b7d44","tags":["IoT"]},{"title":"Gitblit å®‰è£…ä½¿ç”¨","url":"/2020/11/22/Gitblit-å®‰è£…ä½¿ç”¨/","content":"\nGitblitæ˜¯ä¸€ä¸ªåœ¨Javaç¯å¢ƒä¸­è¿è¡Œçš„GitæœåŠ¡å™¨ã€‚åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹åœ¨Windowsä¸Šæ­å»ºGitblitæœåŠ¡çš„è¿‡ç¨‹ã€‚\n\n[Gitblit](https://gitblit.github.io/gitblit/) is an open-source, pure Java stack for managing, viewing, and serving Git repositories.\nIt's designed primarily as a tool for small workgroups who want to host centralized repositories.\n\n## 1.å‡†å¤‡æ–‡ä»¶\n\n* jdk-11.0.2_windows-x64_bin.zip[åä¸ºæº](https://repo.huaweicloud.com/java/jdk/)\n* gitblitå®‰è£…åŒ…[Gitblit](https://gitblit.github.io/gitblit/)\n\n## 2.å®‰è£…Java\n\nè¯·å‚è€ƒ[èœé¸Ÿæ•™ç¨‹](https://www.runoob.com/java/java-environment-setup.html)\n\n## 3.é…ç½®Gitblit\n1. ä¸‹è½½çš„zipæ–‡ä»¶åªè¦è§£å‹ç¼©å³å¯ï¼Œä¸ç”¨å®‰è£…ã€‚å»ºè®®æ”¾åˆ°D:\\Program Files\\gitblit-xxxç›®å½•ä¸­ï¼ˆxxxæŒ‡ç‰ˆæœ¬å·ï¼‰\n2. æ–°å»ºä¸€ä¸ªç”¨äºå­˜æ”¾gitæœåŠ¡å™¨æ•°æ®çš„æ–‡ä»¶å¤¹ï¼Œå¦‚D:\\GitBlit_repository\n3. é…ç½®gitblit.properties æ–‡ä»¶ã€‚  \n    * åœ¨D:\\Program Files\\gitblit-xxx\\dataç›®å½•ä¸­å°†defaults.propertiesæ–‡ä»¶å¤åˆ¶ä¸€ä»½ï¼Œæ”¹åä¸ºmy.properties  \n    * ä¿®æ”¹gitblit.propertiesæ–‡ä»¶ï¼Œç„¶åå°† `include = defaults.properties` æ³¨é‡Šæ‰  \n    * æ·»åŠ ä¸€ä»£ç `include = my.properties`è¡¨ç¤ºä½¿ç”¨my.propertiesè¿™ä¸ªé…ç½®ã€‚  \n4. ä¿®æ”¹my.propertiesæ–‡ä»¶ä¸­çš„ç«¯å£å’ŒæœåŠ¡å™¨IPåœ°å€ï¼š  \n    * ä¿®æ”¹git.repositoriesFolder = D:/Gitblit_repositoryï¼ˆæ³¨æ„å…¶ä¸­çš„D:\\Gitblit_repository ä¸­çš„\"\\\"ä¸€å®šè¦ç”¨\"/\"ã€‚ï¼‰  \n    * ä¿®æ”¹server.httpPort = 10101  \n    * ä¿®æ”¹server.httpBindInterface = 192.168123.15ï¼ˆæˆ‘è‡ªå·±çš„æœåŠ¡å™¨IPåœ°å€ä¸º192.168.123.15ï¼‰  \n    * ä¿®æ”¹server.httpsBindInterface = localhost  \n    * æœ€åä¿®æ”¹server.certificateAlias = localhost\n5. è¿è¡ŒGitblitæœåŠ¡ã€‚åœ¨D:\\Program Files\\gitblit-xxxç›®å½•ä¸‹è¿è¡Œgitblit.cmdå‘½ä»¤ã€‚æ³¨æ„çœ‹å‘½ä»¤è¡Œä¸­çš„æç¤ºï¼Œæ£€æŸ¥ç¨‹åºæ˜¯å¦è¿è¡Œæ­£å¸¸ã€‚\n6. å‘½ä»¤è¡Œä¸­ä¼šæœ‰æœåŠ¡å™¨ipå’Œç«¯å£å·è¯·æ³¨æ„æŸ¥çœ‹ã€‚\n\n## 4.ç®¡ç†GitBlit\n\nåœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥å‘½ä»¤è¡Œä¸­æç¤ºçš„æœåŠ¡å™¨ipå’Œç«¯å£å·\n\nå¦‚æœæˆåŠŸåŠ è½½ï¼Œè¯´æ˜æœåŠ¡å™¨æ­å»ºå®Œæ¯•ã€‚é»˜è®¤è´¦å·å¯†ç å‡ä¸ºadmin\n\n## 5.è®¾ç½®å¼€å¯è‡ªå¯åŠ¨\n\nè®¾ç½®ä»¥Windows Serviceæ–¹å¼å¯åŠ¨Gitblit.  \n1. åœ¨Gitblitç›®å½•ä¸‹ï¼Œæ‰¾åˆ°installService.cmdæ–‡ä»¶ã€‚é¼ æ ‡å³é”®ä½¿ç”¨è®°äº‹æœ¬æ‰“å¼€ã€‚  \n2. è®¾ç½® CD ä¸ºç¨‹åºç›®å½• `SET CD=D:\\Program Files\\gitblit-xxx(xxxä¿®æ”¹ä¸ºä½ è‡ªå·±çš„ç›®å½•)`  \n3. ä¿å­˜ï¼Œå…³é—­æ–‡ä»¶\n4. å³é”®installService.cmdæ–‡ä»¶ï¼Œé€‰æ‹©ä»¥ç®¡ç†å‘˜çš„èº«ä»½è¿è¡Œ  \n5. ç‚¹å‡»å¼€å§‹èœå•è¾“å…¥services.msc æ‰“å¼€WindowsæœåŠ¡æŸ¥æ‰¾gitblitï¼Œå¦‚æœæœªå¯åŠ¨ï¼Œè¯·æ‰‹åŠ¨å¯åŠ¨ã€‚æ³¨æ„ç¡®ä¿ä¸ºè‡ªåŠ¨æ¨¡å¼ï¼Œè¿™æ ·æ¯æ¬¡windowså¯åŠ¨åéƒ½è‡ªåŠ¨å¯åŠ¨æ­¤é¡¹æœåŠ¡ã€‚","tags":["Gitblit"]},{"title":"Hello World","url":"/2020/05/24/hello-world/","content":"\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n"}]